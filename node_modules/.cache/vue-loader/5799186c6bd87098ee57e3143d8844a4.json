{"remainingRequest":"D:\\epub_\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\epub_\\src\\views\\book.vue?vue&type=style&index=0&id=2fe7a0bb&scoped=true&lang=css&","dependencies":[{"path":"D:\\epub_\\src\\views\\book.vue","mtime":1597737086485},{"path":"D:\\epub_\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\epub_\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\epub_\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\epub_\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\epub_\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLmZhZGVvdXQgewogIC13ZWJraXQtYW5pbWF0aW9uOiBmYWRlb3V0IDAuNnMgbGluZWFyIDBzIG5vcm1hbCAxIGZvcndhcmRzOwogIGFuaW1hdGlvbjogZmFkZW91dCAwLjZzIGxpbmVhciAwcyBub3JtYWwgMSBmb3J3YXJkczsKfQoKQC13ZWJraXQta2V5ZnJhbWVzIGZhZGVvdXQgewogIDAlIHsKICAgIG9wYWNpdHk6IDE7CiAgfQogIDEwMCUgewogICAgb3BhY2l0eTogMDsKICB9Cn0KQGtleWZyYW1lcyBmYWRlb3V0IHsKICAwJSB7CiAgICBvcGFjaXR5OiAxOwogIH0KICAxMDAlIHsKICAgIG9wYWNpdHk6IDA7CiAgfQp9CgojcGFnZS1vdmVybGF5IHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgYm90dG9tOiA2cHg7CiAgdGV4dC1hbGlnbjogcmlnaHQ7CiAgaGVpZ2h0OiAxMnB4OwogIGxlZnQ6IDA7CiAgcmlnaHQ6IDVweDsKICB6LWluZGV4OiAxMDAwOwogIGZvbnQtc2l6ZTogMTBweDsKfQojcGFnZS1vdmVybGF5LWJhciB7CiAgcG9zaXRpb246IGFic29sdXRlOwogIGJvdHRvbTogM3B4OwogIGhlaWdodDogMnB4OwogIGxlZnQ6IDA7CiAgcmlnaHQ6IDA7CiAgei1pbmRleDogMTAwMDsKICBiYWNrZ3JvdW5kLWNvbG9yOiBncmF5Owp9CgojQ292ZXJJbWcgewogIHdpZHRoOiA5MCU7CiAgcGFkZGluZy10b3A6IDUlOwp9Ci5sb2FkaW5nLW92ZXJsYXkgewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB0b3A6IDBweDsKICBib3R0b206IDBweDsKICBsZWZ0OiAwOwogIHJpZ2h0OiAwOwogIHotaW5kZXg6IDEwMDAwOwoKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7Cn0KLnRvb2wtcm93IHsKICAvKmhlaWdodDogNDBweDsqLwogIHRleHQtYWxpZ246IGNlbnRlcjsKICBsaW5lLWhlaWdodDogNDBweDsKfQoudmFuLXBvcHVwID4gZGl2IHsKICBwYWRkaW5nOiAxMHB4Owp9Ci52YW4tc2xpZGVyIHsKICBtYXJnaW46IDIwcHg7Cn0KI3JlYWRlci1vdmVybGF5IHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdG9wOiAwOwogIGJvdHRvbTogMDsKICByaWdodDogMDsKICBsZWZ0OiAwOwogIHotaW5kZXg6IDEwMDAwOwogIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMCwgMCwgMCwgMCk7CiAgcG9pbnRlci1ldmVudHM6IG5vbmU7Cn0KLmJhY2tJbWFnZSB7CiAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIHdpZHRoOiAzMHB4OwogIGhlaWdodDogMzBweDsKICBib3JkZXItcmFkaXVzOiAzMHB4OwogIG1hcmdpbi10b3A6IDVweDsKICBib3JkZXI6IDFweCBzb2xpZCAjZGZkZmRmOwp9Ci5iZy10aW1nNCB7CiAgYmFja2dyb3VuZDogdXJsKCIvcmVhZGVySW1hZ2VzL2Nzc19zcHJpdGVzLnBuZyIpIC0xMHB4IC0xMHB4Owp9Ci5iZy10aW1nMyB7CiAgYmFja2dyb3VuZDogdXJsKCIvcmVhZGVySW1hZ2VzL2Nzc19zcHJpdGVzLnBuZyIpIC03MHB4IC0xMHB4Owp9Ci5iZy10aW1nMSB7CiAgYmFja2dyb3VuZDogdXJsKCIvcmVhZGVySW1hZ2VzL2Nzc19zcHJpdGVzLnBuZyIpIC0xMHB4IC03MHB4Owp9Ci5iZy10aW1nIHsKICBiYWNrZ3JvdW5kOiB1cmwoIi9yZWFkZXJJbWFnZXMvY3NzX3Nwcml0ZXMucG5nIikgLTcwcHggLTcwcHg7Cn0K"},{"version":3,"sources":["book.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4DA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"book.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div>\n    <div id=\"reader-overlay\"></div>\n\n    <van-popup v-model=\"showLeftDrawer\" position=\"left\" :style=\"{ width: '80%',height:'100%' }\">\n      <van-tabs type=\"card\">\n        <van-tab title=\"目录\">\n          <bookmenu v-bind:menuList=\"toc\" v-bind:currentMenu=\"chapter\" @change=\"changeChapter\"></bookmenu>\n        </van-tab>\n        <!--    <van-tab title=\"书签\">内容 2</van-tab>\n              <van-tab title=\"笔记\">内容 3</van-tab>\n              -->\n      </van-tabs>\n\n    </van-popup>\n\n    <van-popup v-model=\"popupShow\" position=\"top\" :style=\"{ height: '30%' }\" class=\"reader-tool\">\n      <div>\n        <van-row class=\"tool-row\">\n          <van-col span=\"4\">亮度</van-col>\n          <van-col span=\"16\">\n            <van-slider v-model=\"light\" @change=\"onLightChange\" />\n          </van-col>\n        </van-row>\n        <van-row class=\"tool-row\">\n          <van-col span=\"4\">字号</van-col>\n          <van-col span=\"16\">\n            <van-stepper v-model=\"fontSize\" @change=\"onFontSizeChange\" min=\"10\" max=\"24\" input-width=\"40px\" button-size=\"32px\" step=\"2\" disable-input />\n          </van-col>\n        </van-row>\n\n      </div>\n\n    </van-popup>\n\n    <div v-if=\"loading\" class=\"loading-overlay\">\n      <img v-if=\"firstLoading\" id=\"CoverImg\" :src=\"coverimg\" />\n      <div v-if=\"firstLoading\" style=\"color:gray;position:absolute;bottom:12px;width:100%;text-align:center;height:20px;\">加载中...</div>\n      <van-loading color=\"#1989fa\" />\n    </div>\n\n    <div style=\"height: 100vh\">\n      <van-nav-bar v-bind:title=\"chapter.label\" left-text=\"\" right-text=\"章节\" @click-right=\"onClickRight\"></van-nav-bar>\n      <div id=\"viewer\">\n        <div style=\"position: absolute;left:0;font-size: 50px;z-index: 1234;top: 50%;width:50px;height:50px\" @click=\"prevPage()\" v-if=\"mql==1 || mqlFlage== true\">\n          <img src=\"../assets/left.png\" alt=\"\" style=\"width:100%;height:100%\">\n        </div>\n        <div style=\"position: absolute;right:0;font-size: 50px;z-index: 1234;top: 50%;width:50px;height:50px\" @click=\"nextPage()\" v-if=\"mql==1 || mqlFlage==true\"><img src=\"../assets/right.png\" alt=\"\" style=\"width:100%;height:100%\"></div>\n      </div>\n    </div>\n\n    <div id=\"page-overlay\" :class=\"pageAnimationClass\">{{ pageText }}</div>\n    <div id=\"page-overlay-bar\">\n      <div id=\"page-overlay-process\" :style=\"{ height:'3px', backgroundColor:'red' ,width : pageProcess + '%'}\">\n      </div>\n    </div>\n  </div>\n\n</template>\n<style scoped>\n.fadeout {\n  -webkit-animation: fadeout 0.6s linear 0s normal 1 forwards;\n  animation: fadeout 0.6s linear 0s normal 1 forwards;\n}\n\n@-webkit-keyframes fadeout {\n  0% {\n    opacity: 1;\n  }\n  100% {\n    opacity: 0;\n  }\n}\n@keyframes fadeout {\n  0% {\n    opacity: 1;\n  }\n  100% {\n    opacity: 0;\n  }\n}\n\n#page-overlay {\n  position: absolute;\n  bottom: 6px;\n  text-align: right;\n  height: 12px;\n  left: 0;\n  right: 5px;\n  z-index: 1000;\n  font-size: 10px;\n}\n#page-overlay-bar {\n  position: absolute;\n  bottom: 3px;\n  height: 2px;\n  left: 0;\n  right: 0;\n  z-index: 1000;\n  background-color: gray;\n}\n\n#CoverImg {\n  width: 90%;\n  padding-top: 5%;\n}\n.loading-overlay {\n  position: absolute;\n  top: 0px;\n  bottom: 0px;\n  left: 0;\n  right: 0;\n  z-index: 10000;\n\n  text-align: center;\n  background-color: white;\n}\n.tool-row {\n  /*height: 40px;*/\n  text-align: center;\n  line-height: 40px;\n}\n.van-popup > div {\n  padding: 10px;\n}\n.van-slider {\n  margin: 20px;\n}\n#reader-overlay {\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  right: 0;\n  left: 0;\n  z-index: 10000;\n  background-color: rgba(0, 0, 0, 0);\n  pointer-events: none;\n}\n.backImage {\n  display: inline-block;\n  width: 30px;\n  height: 30px;\n  border-radius: 30px;\n  margin-top: 5px;\n  border: 1px solid #dfdfdf;\n}\n.bg-timg4 {\n  background: url(\"/readerImages/css_sprites.png\") -10px -10px;\n}\n.bg-timg3 {\n  background: url(\"/readerImages/css_sprites.png\") -70px -10px;\n}\n.bg-timg1 {\n  background: url(\"/readerImages/css_sprites.png\") -10px -70px;\n}\n.bg-timg {\n  background: url(\"/readerImages/css_sprites.png\") -70px -70px;\n}\n</style>\n<script>\nimport { Image, Tab, Tabs, Loading, NavBar, CellGroup, Cell, Card, RadioGroup, Radio, Popup, Progress, Row, Col, Slider, Stepper } from 'vant';\nimport bookmenu from '@/components/bookmenu';\nimport Vue from 'vue';\nimport Epub from 'epubjs';\nVue.use(NavBar).use(Loading).use(Card)\n  .use(RadioGroup).use(Radio).use(CellGroup)\n  .use(Cell).use(Tabs).use(Tab).use(Popup).use(Progress)\n  .use(Row).use(Col).use(Slider).use(Stepper).use(Image);\nvar book, rendition;\nexport default {\n  name: 'book',\n  components: {\n    bookmenu: bookmenu\n  },\n  data() {\n    return {\n      publicPath: process.env.BASE_URL,\n      book: null,\n      beginBasePage: 2,\n      pageText: \"\",\n      pageProcess: 0,\n      currentPage: 1,\n      currentChaperIdx: 2,\n      rendition: null,\n      chapter: {},\n      changeType: \"menu\",\n      firstLoad: true,\n      loading: true,\n      popupShow: false,\n      showLeftDrawer: false,\n      light: 100,\n      locationLoading: true,\n      firstLoading: true,\n      fontSize: 14,\n      backImage: \"\",\n      toc: [],\n      backImageList: [\n        { class: \"bg-timg\", backImagesrc: \"readerImages/timg_big.jpg\" },\n        { class: \"bg-timg1\", backImagesrc: \"readerImages/timg1_big.jpg\" },\n        { class: \"bg-timg3\", backImagesrc: \"readerImages/timg3_big.jpg\" },\n        { class: \"bg-timg4\", backImagesrc: \"\" },\n      ],\n      readerStyle: {\n        light: 100,\n        fontSize: 14,\n        backImage: \"\"\n      },\n      pageAnimationClass: \"\",\n      coverimg: \"\",\n      mql: \"\",\n      mqlFlage: false\n    }\n  },\n  watch: {\n    toc: {\n      handler: function (oldVal, newVal) {\n        // console.log(newVal)\n      },\n      deep: true\n    },\n    chapter: function (val) {\n      if (this.changeType == \"menu\")\n        rendition.display(val.href);\n    },\n    fontSize: function (val) {\n      this.onFontSizeChange(val);\n    },\n    light: function (val) {\n      this.onLightChange(val);\n    },\n    backImage: function (val) {\n      this.onBackImageChange(val);\n    },\n    mql: function (val) {\n      this.mql = val;\n      localStorage.setItem(\"mql\", this.mql)\n    }\n  },\n  methods: {\n    // 点击下一页\n    nextPage() {\n      rendition.next();\n    },\n    // 点击上一页\n    prevPage() {\n      if (this.currentPage == 1 && book.package.metadata.direction != \"rtl\" && this.currentChaperIdx <= 2) return; //第一页禁止继续向前\n      rendition.prev();\n    },\n    onClickLeft() {\n      window.history.back(-1);\n      // book\n    },\n    onClickRight() {\n      this.showLeftDrawer = true;\n    },\n    onLightChange(val) {\n      var overlay = document.getElementById(\"reader-overlay\");\n      overlay.style.backgroundColor = \"rgba(0,0,0,\" + (0.5 - val / 200) + \")\";\n      this.readerStyle.light = val;\n    },\n    onFontSizeChange(val) {\n      // 判断横屏竖屏展示不同字体大小\n      var mql = window.matchMedia(\"(orientation: portrait)\");\n      if (mql.matches) {\n        // 竖屏\n        // this.fontSize = 15;\n        // this.readerStyle.fontSize = 15;\n        this.mql = \"0\";\n      } else {\n        // 横屏\n        // this.fontSize = 22;\n        // this.readerStyle.fontSize = 22;\n        this.mql = \"1\";\n      }\n      var iframeDoc = document.getElementsByTagName(\"iframe\")[0].contentWindow.document;\n      var fontSizeStyle = iframeDoc.getElementById(\"fontSize\");\n      if (!fontSizeStyle) {\n        fontSizeStyle = iframeDoc.createElement('style');\n        fontSizeStyle.id = \"fontSize\";\n        fontSizeStyle.type = 'text/css';\n        fontSizeStyle.innerHTML = \"p,div{ font-size:\" + val + \"px }\";\n        iframeDoc.getElementsByTagName('HEAD').item(0).appendChild(fontSizeStyle);\n      } else {\n        fontSizeStyle.innerHTML = \"p,div{ font-size:\" + val + \"px }\";\n      }\n      if (this.readerStyle.fontSize != val) {\n        this.readerStyle.fontSize = val;\n        // this.locationLoading = true;\n        // let that = this;\n        // book.locations.generate(666).then(function(location) { // This promise will take a little while to return (About 20 seconds or so for Moby Dick)\n        //     that.locationLoading = false;\n        //     that.pageText = (that.beginBasePage + that.currentPage) + \"/\" + book.locations.total;\n        // });\n      }\n    },\n    onBackImageChange(val) {\n      var iframeDoc = document.getElementsByTagName(\"iframe\")[0].contentWindow.document;\n      var bdoy = iframeDoc.getElementsByTagName(\"body\")[0];\n      bdoy.style.backgroundImage = val;\n      this.readerStyle.backImage = val;\n    },\n    changeBackImage(value) {\n      if (value.backImagesrc)\n        this.backImage = \"url('\" + this.publicPath + value.backImagesrc + \"')\";\n      else\n        this.backImage = \"\";\n    },\n    updateStyle() {\n      this.onLightChange(this.readerStyle.light);\n      this.onBackImageChange(this.readerStyle.backImage);\n      this.onFontSizeChange(this.readerStyle.fontSize);\n    },\n    changeChapter(chapter) {\n      this.changeType = \"menu\";\n      this.showLeftDrawer = false;\n      this.chapter = chapter;\n    },\n  },\n  beforeCreate: function () {\n    document.title = \"图书阅读\";\n    var that = this;\n    var bookfile = this.$route.params.pathMatch;\n    var bookoption = {\n    };\n    if (!/.epub$/.test(bookfile) && bookfile != undefined) {\n      bookoption.openAs = 'directory';\n    }\n    if (bookfile.split(\"/\")[2].indexOf(\"t\") > -1) {\n      book = new Epub(bookfile, bookoption);\n    }\n\n    rendition = book.renderTo(\"viewer\", {\n      width: \"100%\"\n    });\n    book.ready.then(function () {\n      that.coverimg = book.cover;\n      return book.locations.generate(719); // Generates CFI for every X characters (Characters per/page)\n      // }\n    }).then(function (locations) { // This promise will take a little while to return (About 20 seconds or so for Moby Dick)\n      that.locationLoading = false;\n      let location = viewManager.currentLocation();\n      let p = location[0].pages[0];\n      that.pageText = that.beginBasePage;\n      that.pageAnimationClass = \"\";\n      that.beginBasePage = that.beginBasePage - p;\n    });\n    var viewManager;\n    rendition.on(\"started\", function () {\n      viewManager = rendition.manager;\n      viewManager.on(\"beforeCreateView\", function (section) {\n        that.loading = true;\n      })\n      viewManager.on(\"afterCreateView\", function (view) {\n        view.hooks.content.register(function (iframe) {\n          that.updateStyle();\n        })\n      })\n    })\n    rendition.on(\"rendered\", function (section) {\n      if (viewManager.currentLocation()[0].pages.length >= 2) {\n        that.mqlFlage = !that.mqlFlage\n        localStorage.setItem(\"mql\", \"1\")\n      } else {\n        that.mqlFlage = false\n        localStorage.setItem(\"mql\", \"0\")\n      }\n      // mqlFlage\n      if (!that.locationLoading) {\n        let location = viewManager.currentLocation();\n        let p = location[0].pages[0];\n        that.beginBasePage = book.locations.locationFromCfi(rendition.currentLocation().start.cfi) - p;\n      }\n      if (that.firstLoading) {\n        //location（为了分页的页码计算） 还在计算中的话，稍等一会儿在关闭loading页面\n        setTimeout(function () { that.loading = false; that.firstLoading = false }, 4500);\n      } else {\n        that.loading = false;\n      }\n      let current = book.navigation && book.navigation.get(section.href);\n      that.currentChaperIdx = section.index;\n      if (that.chapter.href != current.href) {\n        that.changeType = \"turnPage\";\n        that.chapter = current;\n      }\n\n      var mql = window.matchMedia(\"(orientation: portrait)\");\n      var iframe = document.getElementsByTagName(\"iframe\")[0].contentWindow.document;\n      var viewport = iframe.getElementsByTagName(\"html\")[0];\n      var container = document.getElementById(\"viewer\").firstElementChild;\n      var startScrollLeft;\n      var pageWidth = window.innerWidth; // 页面宽度\n      var maxWidth = pageWidth / 2;\n      var startX, startY;\n      var initialPos = 0;  // 手指按下的屏幕位置\n      var moveLength = 0;  // 手指当前滑动的距离\n      var direction = 'left'; // 滑动的方向\n      var isMove = false; // 是否发生左右滑动\n      var startT = 0; // 记录手指按下去的时间\n      var isTouchEnd = true; // 标记当前滑动是否结束(手指已离开屏幕)\n      var throttleTime = 0;\n      var lastScroll, totalPages;\n      that.currentPage = 0;\n      // let location = viewManager.currentLocation();\n      // that.currentPage = location[0].pages[0]; \n      if (mql.matches) {\n        this.mql = \"0\"\n      } else {\n        this.mql = \"1\"\n      }\n      if (mql.matches) {\n        // 手指放在屏幕上\n        viewport.addEventListener('touchstart', function (e) {\n          startScrollLeft = container.scrollLeft;\n          let location = viewManager.currentLocation();\n          totalPages = location[0].totalPages;\n          //that.currentPage = location[0].pages[0];  \n          //touchstart与touchend的浏览器默认行为不能阻止，\n          // 如果阻止的话则浏览器无法计算该节点内的点击等其他事件\n          //e.preventDefault();\n          // 单手指触摸或者多手指同时触摸，禁止第二个手指延迟操作事件\n          if (e.touches.length === 1 || isTouchEnd) {\n            var touch = e.touches[0];\n            startX = touch.pageX;\n            startY = touch.pageY;\n            lastScroll = 0;\n            startT = + new Date(); // 记录手指按下的开始时间\n            isMove = false; // 是否产生滑动\n            isTouchEnd = false; // 当前滑动开始\n          }\n        }, { passive: false });\n        // 手指在屏幕上滑动，页面跟随手指移动\n        viewport.addEventListener('touchmove', function (e) {\n          e.preventDefault();\n          //用于频繁滑动防抖\n          // var now = new Date().getTime();\n          // if(!throttleTime) throttleTime=now;\n          // if(now-throttleTime<20) return;\n          // throttleTime = now;\n          // 如果当前滑动已结束，不管其他手指是否在屏幕上都禁止该事件\n          if (isTouchEnd) return;\n          var touch = e.touches[0];\n          //container scroll改变时touch.pageX也会跟着变，所以需要减掉容器滚动的距离获取真正的手指移动距离。\n          var scrolltemp = container.scrollLeft - startScrollLeft;\n          var deltaX = touch.pageX - startX - scrolltemp;\n\n          direction = deltaX > 0 ? 'right' : 'left'; // 判断手指滑动的方向\n          // if(that.chapter.href==that.toc[0].href&&direction=='right'&&currentPage==1) return;\n          isMove = true;\n          moveLength = deltaX;\n          scrollPage.call(viewport, moveLength, e);\n          //如果滑动距离超过最大距离则翻页\n          if (Math.abs(moveLength) >= maxWidth) {\n            throttleTime = 0;\n            turnPage.call(viewport, moveLength);\n          }\n        }, { passive: false });\n\n        // 手指离开屏幕时，计算最终需要停留在哪一页\n        viewport.addEventListener('touchend', function (e) {\n          if (!isMove) {\n            isTouchEnd = true;\n            if (e.target.tagName == \"A\" || e.target.parentNode.tagName == \"A\") return;\n            e.preventDefault();\n            that.popupShow = true;\n            return;\n          }\n          throttleTime = 0;\n          var translate = 0;\n          // 计算手指在屏幕上停留的时间\n          var deltaT = + new Date() - startT;\n          // 发生了滑动，并且当前滑动事件未结束\n          if (isMove && !isTouchEnd) {\n            isTouchEnd = true; // 标记当前完整的滑动事件已经结束\n            // 使用动画过渡让页面滑动到最终的位置\n            if (deltaT < 300) { // 如果停留时间小于300ms,则认为是快速滑动，无论滑动距离是多少，都停留到下一页\n              turnPage.call(viewport, moveLength);\n            } else {\n              // 如果滑动距离小于屏幕的50%，则退回到上一页\n              if (Math.abs(moveLength) < maxWidth) {\n                // 执行滑动，让页面恢复\n                scrollPage.call(viewport, 0);\n                isTouchEnd = true;\n              } else {\n                // 如果滑动距离大于屏幕的50%，则翻页\n                turnPage.call(viewport, moveLength);\n              }\n            }\n          }\n        }, { passive: false });\n      }\n      function turnPage(moveLength) {\n        isTouchEnd = true;\n        this.style.webkitTransform = 'translate3d(0, 0, 0)';\n        if (direction === \"left\") {\n          if (book.package.metadata.direction === \"rtl\") {\n            rendition.prev(moveLength);\n            //that.currentPage--;\n          } else {\n            rendition.next(moveLength);\n            //that.currentPage++;\n          }\n        } else {\n          if (that.currentPage == 1 && book.package.metadata.direction != \"rtl\" && that.currentChaperIdx <= 2) return; //第一页禁止继续向前\n          if (book.package.metadata.direction === \"rtl\") {\n            rendition.next(moveLength);\n            //that.currentPage++;\n          } else {\n            rendition.prev(moveLength);\n            //that.currentPage--;\n          }\n        }\n      }\n      // 页面平移\n      function scrollPage(translate, type) {\n        if (that.currentPage == 1 && direction === \"right\" || that.currentPage == totalPages && direction === \"left\") {\n          this.style.webkitTransform = 'translate3d(' + translate + 'px, 0, 0)';\n        } else {\n          container.scrollLeft = startScrollLeft - translate;\n        }\n      }\n    });\n    rendition.on(\"relocated\", function (locations) {\n      //console.log(\"relocated location\",locations);\n      // When navigating to the next/previous page\n      //let progress = book.locations.percentageFromCfi(locations.start.cfi);\n      // console.log('Progress:', progress); // The % of how far along in the book you are\n      // console.log('Current Page:',book.locations.locationFromCfi(locations.start.cfi));\n      // console.log('Total Pages:',book.locations.total);\n      that.pageAnimationClass = \"fadeout\";\n      setTimeout(\n        function () {\n          let location = viewManager.currentLocation();\n          that.currentPage = location[0].pages[0];\n          // that.currentPage - 1;\n          let total = book.locations.total;\n          if (that.locationLoading && total < 70) { //加载中，且刚开始加载的时候，如果估算已经大于70页了，也尝试一下\n            that.pageText = \"\";\n            that.pageProcess = 0;\n            that.pageAnimationClass = \"\";\n            return;\n          }\n          let progress = book.locations.percentageFromCfi(locations.start.cfi);\n          that.pageProcess = parseInt(progress * 100);\n          if (total < that.beginBasePage + location[0].totalPages) total = that.beginBasePage + location[0].totalPages;\n          // let showpage = that.beginBasePage + that.currentPage;\n          // let calpage = book.locations.locationFromCfi(locations.start.cfi);\n          // console.log('showpage:', showpage);  \n          // console.log('calpage:', calpage); \n          //if (calpage>total) total=calpage;\n          //有链接跳转的时候，这是currentPage是不对的\n          // if ( Math.abs(calpage - showpage)>1 ){\n          //     that.currentPage = calpage - showpage;\n          //     showpage = calpage;\n          // }\n          let showpage = that.beginBasePage + that.currentPage;\n          //if (showpage>total) showpage=total;\n          //that.pageText = showpage  +  \"/\" + total;\n          that.pageText = showpage;\n          that.pageAnimationClass = \"\";\n        }, 400);\n    });\n    rendition.on(\"layout\", function (layout) {\n      //   console.log(\"layout\", layout);\n    });\n    rendition.on(\"locationChanged\", function (obj) {\n      // index (number)\n      // href (string)\n      // start (EpubCFI)\n      // end (EpubCFI)\n      // percentage (number)\n      //   console.log(\"locationChanged\", obj);\n    });\n    book.loaded.navigation.then(function (toc) {\n      that.chapter = toc.toc[0];\n      that.toc = toc.toc;\n    });\n  },\n  destroyed: function () {\n    book.destroy();\n  },\n  mounted() {\n\n  },\n  created() {\n\n  }\n}\n</script>\n\n<style>\n.van-stepper__input[disabled] {\n  color: black;\n}\n</style>"]}]}