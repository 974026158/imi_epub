{"remainingRequest":"D:\\epub_\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\epub_\\src\\views\\book.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\epub_\\src\\views\\book.vue","mtime":1597750304057},{"path":"D:\\epub_\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\epub_\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\epub_\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IEltYWdlLCBUYWIsIFRhYnMsIExvYWRpbmcsIE5hdkJhciwgQ2VsbEdyb3VwLCBDZWxsLCBDYXJkLCBSYWRpb0dyb3VwLCBSYWRpbywgUG9wdXAsIFByb2dyZXNzLCBSb3csIENvbCwgU2xpZGVyLCBTdGVwcGVyIH0gZnJvbSAndmFudCc7CmltcG9ydCBib29rbWVudSBmcm9tICdAL2NvbXBvbmVudHMvYm9va21lbnUnOwppbXBvcnQgVnVlIGZyb20gJ3Z1ZSc7CmltcG9ydCBFcHViIGZyb20gJ2VwdWJqcyc7CmltcG9ydCBodHRwIGZyb20gIi4vaHR0cC5qcyI7ClZ1ZS51c2UoTmF2QmFyKS51c2UoTG9hZGluZykudXNlKENhcmQpCiAgLnVzZShSYWRpb0dyb3VwKS51c2UoUmFkaW8pLnVzZShDZWxsR3JvdXApCiAgLnVzZShDZWxsKS51c2UoVGFicykudXNlKFRhYikudXNlKFBvcHVwKS51c2UoUHJvZ3Jlc3MpCiAgLnVzZShSb3cpLnVzZShDb2wpLnVzZShTbGlkZXIpLnVzZShTdGVwcGVyKS51c2UoSW1hZ2UpOwp2YXIgYm9vaywgcmVuZGl0aW9uOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ2Jvb2snLAogIGNvbXBvbmVudHM6IHsKICAgIGJvb2ttZW51OiBib29rbWVudQogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHB1YmxpY1BhdGg6IHByb2Nlc3MuZW52LkJBU0VfVVJMLAogICAgICBib29rOiBudWxsLAogICAgICBiZWdpbkJhc2VQYWdlOiAyLAogICAgICBwYWdlVGV4dDogIiIsCiAgICAgIHBhZ2VQcm9jZXNzOiAwLAogICAgICBjdXJyZW50UGFnZTogMSwKICAgICAgY3VycmVudENoYXBlcklkeDogMiwKICAgICAgcmVuZGl0aW9uOiBudWxsLAogICAgICBjaGFwdGVyOiB7fSwKICAgICAgY2hhbmdlVHlwZTogIm1lbnUiLAogICAgICBmaXJzdExvYWQ6IHRydWUsCiAgICAgIGxvYWRpbmc6IHRydWUsCiAgICAgIHBvcHVwU2hvdzogZmFsc2UsCiAgICAgIHNob3dMZWZ0RHJhd2VyOiBmYWxzZSwKICAgICAgbGlnaHQ6IDEwMCwKICAgICAgbG9jYXRpb25Mb2FkaW5nOiB0cnVlLAogICAgICBmaXJzdExvYWRpbmc6IHRydWUsCiAgICAgIG1hc2tGbGFnOiBmYWxzZSwKICAgICAgZXJyb3JNYXNrVGV4dDogIiIsCiAgICAgIGZvbnRTaXplOiAxNCwKICAgICAgYmFja0ltYWdlOiAiIiwKICAgICAgdG9jOiBbXSwKICAgICAgYmFja0ltYWdlTGlzdDogWwogICAgICAgIHsgY2xhc3M6ICJiZy10aW1nIiwgYmFja0ltYWdlc3JjOiAicmVhZGVySW1hZ2VzL3RpbWdfYmlnLmpwZyIgfSwKICAgICAgICB7IGNsYXNzOiAiYmctdGltZzEiLCBiYWNrSW1hZ2VzcmM6ICJyZWFkZXJJbWFnZXMvdGltZzFfYmlnLmpwZyIgfSwKICAgICAgICB7IGNsYXNzOiAiYmctdGltZzMiLCBiYWNrSW1hZ2VzcmM6ICJyZWFkZXJJbWFnZXMvdGltZzNfYmlnLmpwZyIgfSwKICAgICAgICB7IGNsYXNzOiAiYmctdGltZzQiLCBiYWNrSW1hZ2VzcmM6ICIiIH0sCiAgICAgIF0sCiAgICAgIHJlYWRlclN0eWxlOiB7CiAgICAgICAgbGlnaHQ6IDEwMCwKICAgICAgICBmb250U2l6ZTogMTQsCiAgICAgICAgYmFja0ltYWdlOiAiIgogICAgICB9LAogICAgICBwYWdlQW5pbWF0aW9uQ2xhc3M6ICIiLAogICAgICBjb3ZlcmltZzogIiIsCiAgICAgIG1xbDogIiIsCiAgICAgIG1xbEZsYWdlOiBmYWxzZQogICAgfQogIH0sCiAgd2F0Y2g6IHsKICAgIHRvYzogewogICAgICBoYW5kbGVyOiBmdW5jdGlvbiAob2xkVmFsLCBuZXdWYWwpIHsKICAgICAgICAvLyBjb25zb2xlLmxvZyhuZXdWYWwpCiAgICAgIH0sCiAgICAgIGRlZXA6IHRydWUKICAgIH0sCiAgICBjaGFwdGVyOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGlmICh0aGlzLmNoYW5nZVR5cGUgPT0gIm1lbnUiKQogICAgICAgIHJlbmRpdGlvbi5kaXNwbGF5KHZhbC5ocmVmKTsKICAgIH0sCiAgICBmb250U2l6ZTogZnVuY3Rpb24gKHZhbCkgewogICAgICB0aGlzLm9uRm9udFNpemVDaGFuZ2UodmFsKTsKICAgIH0sCiAgICBsaWdodDogZnVuY3Rpb24gKHZhbCkgewogICAgICB0aGlzLm9uTGlnaHRDaGFuZ2UodmFsKTsKICAgIH0sCiAgICBiYWNrSW1hZ2U6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgdGhpcy5vbkJhY2tJbWFnZUNoYW5nZSh2YWwpOwogICAgfSwKICAgIG1xbDogZnVuY3Rpb24gKHZhbCkgewogICAgICB0aGlzLm1xbCA9IHZhbDsKICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oIm1xbCIsIHRoaXMubXFsKQogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgLy8g54K55Ye75LiL5LiA6aG1CiAgICBuZXh0UGFnZSgpIHsKICAgICAgcmVuZGl0aW9uLm5leHQoKTsKICAgIH0sCiAgICAvLyDngrnlh7vkuIrkuIDpobUKICAgIHByZXZQYWdlKCkgewogICAgICBpZiAodGhpcy5jdXJyZW50UGFnZSA9PSAxICYmIGJvb2sucGFja2FnZS5tZXRhZGF0YS5kaXJlY3Rpb24gIT0gInJ0bCIgJiYgdGhpcy5jdXJyZW50Q2hhcGVySWR4IDw9IDIpIHJldHVybjsgLy/nrKzkuIDpobXnpoHmraLnu6fnu63lkJHliY0KICAgICAgcmVuZGl0aW9uLnByZXYoKTsKICAgIH0sCiAgICBvbkNsaWNrTGVmdCgpIHsKICAgICAgd2luZG93Lmhpc3RvcnkuYmFjaygtMSk7CiAgICAgIC8vIGJvb2sKICAgIH0sCiAgICBvbkNsaWNrUmlnaHQoKSB7CiAgICAgIHRoaXMuc2hvd0xlZnREcmF3ZXIgPSB0cnVlOwogICAgfSwKICAgIG9uTGlnaHRDaGFuZ2UodmFsKSB7CiAgICAgIHZhciBvdmVybGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJlYWRlci1vdmVybGF5Iik7CiAgICAgIG92ZXJsYXkuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gInJnYmEoMCwwLDAsIiArICgwLjUgLSB2YWwgLyAyMDApICsgIikiOwogICAgICB0aGlzLnJlYWRlclN0eWxlLmxpZ2h0ID0gdmFsOwogICAgfSwKICAgIG9uRm9udFNpemVDaGFuZ2UodmFsKSB7CiAgICAgIC8vIOWIpOaWreaoquWxj+erluWxj+WxleekuuS4jeWQjOWtl+S9k+Wkp+WwjwogICAgICB2YXIgbXFsID0gd2luZG93Lm1hdGNoTWVkaWEoIihvcmllbnRhdGlvbjogcG9ydHJhaXQpIik7CiAgICAgIGlmIChtcWwubWF0Y2hlcykgewogICAgICAgIC8vIOerluWxjwogICAgICAgIC8vIHRoaXMuZm9udFNpemUgPSAxNTsKICAgICAgICAvLyB0aGlzLnJlYWRlclN0eWxlLmZvbnRTaXplID0gMTU7CiAgICAgICAgdGhpcy5tcWwgPSAiMCI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8g5qiq5bGPCiAgICAgICAgLy8gdGhpcy5mb250U2l6ZSA9IDIyOwogICAgICAgIC8vIHRoaXMucmVhZGVyU3R5bGUuZm9udFNpemUgPSAyMjsKICAgICAgICB0aGlzLm1xbCA9ICIxIjsKICAgICAgfQogICAgICB2YXIgaWZyYW1lRG9jID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImlmcmFtZSIpWzBdLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQ7CiAgICAgIHZhciBmb250U2l6ZVN0eWxlID0gaWZyYW1lRG9jLmdldEVsZW1lbnRCeUlkKCJmb250U2l6ZSIpOwogICAgICBpZiAoIWZvbnRTaXplU3R5bGUpIHsKICAgICAgICBmb250U2l6ZVN0eWxlID0gaWZyYW1lRG9jLmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7CiAgICAgICAgZm9udFNpemVTdHlsZS5pZCA9ICJmb250U2l6ZSI7CiAgICAgICAgZm9udFNpemVTdHlsZS50eXBlID0gJ3RleHQvY3NzJzsKICAgICAgICBmb250U2l6ZVN0eWxlLmlubmVySFRNTCA9ICJwLGRpdnsgZm9udC1zaXplOiIgKyB2YWwgKyAicHggfSI7CiAgICAgICAgaWZyYW1lRG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdIRUFEJykuaXRlbSgwKS5hcHBlbmRDaGlsZChmb250U2l6ZVN0eWxlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmb250U2l6ZVN0eWxlLmlubmVySFRNTCA9ICJwLGRpdnsgZm9udC1zaXplOiIgKyB2YWwgKyAicHggfSI7CiAgICAgIH0KICAgICAgaWYgKHRoaXMucmVhZGVyU3R5bGUuZm9udFNpemUgIT0gdmFsKSB7CiAgICAgICAgdGhpcy5yZWFkZXJTdHlsZS5mb250U2l6ZSA9IHZhbDsKICAgICAgICAvLyB0aGlzLmxvY2F0aW9uTG9hZGluZyA9IHRydWU7CiAgICAgICAgLy8gbGV0IHRoYXQgPSB0aGlzOwogICAgICAgIC8vIGJvb2subG9jYXRpb25zLmdlbmVyYXRlKDY2NikudGhlbihmdW5jdGlvbihsb2NhdGlvbikgeyAvLyBUaGlzIHByb21pc2Ugd2lsbCB0YWtlIGEgbGl0dGxlIHdoaWxlIHRvIHJldHVybiAoQWJvdXQgMjAgc2Vjb25kcyBvciBzbyBmb3IgTW9ieSBEaWNrKQogICAgICAgIC8vICAgICB0aGF0LmxvY2F0aW9uTG9hZGluZyA9IGZhbHNlOwogICAgICAgIC8vICAgICB0aGF0LnBhZ2VUZXh0ID0gKHRoYXQuYmVnaW5CYXNlUGFnZSArIHRoYXQuY3VycmVudFBhZ2UpICsgIi8iICsgYm9vay5sb2NhdGlvbnMudG90YWw7CiAgICAgICAgLy8gfSk7CiAgICAgIH0KICAgIH0sCiAgICBvbkJhY2tJbWFnZUNoYW5nZSh2YWwpIHsKICAgICAgdmFyIGlmcmFtZURvYyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpZnJhbWUiKVswXS5jb250ZW50V2luZG93LmRvY3VtZW50OwogICAgICB2YXIgYmRveSA9IGlmcmFtZURvYy5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYm9keSIpWzBdOwogICAgICBiZG95LnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IHZhbDsKICAgICAgdGhpcy5yZWFkZXJTdHlsZS5iYWNrSW1hZ2UgPSB2YWw7CiAgICB9LAogICAgY2hhbmdlQmFja0ltYWdlKHZhbHVlKSB7CiAgICAgIGlmICh2YWx1ZS5iYWNrSW1hZ2VzcmMpCiAgICAgICAgdGhpcy5iYWNrSW1hZ2UgPSAidXJsKCciICsgdGhpcy5wdWJsaWNQYXRoICsgdmFsdWUuYmFja0ltYWdlc3JjICsgIicpIjsKICAgICAgZWxzZQogICAgICAgIHRoaXMuYmFja0ltYWdlID0gIiI7CiAgICB9LAogICAgdXBkYXRlU3R5bGUoKSB7CiAgICAgIHRoaXMub25MaWdodENoYW5nZSh0aGlzLnJlYWRlclN0eWxlLmxpZ2h0KTsKICAgICAgdGhpcy5vbkJhY2tJbWFnZUNoYW5nZSh0aGlzLnJlYWRlclN0eWxlLmJhY2tJbWFnZSk7CiAgICAgIHRoaXMub25Gb250U2l6ZUNoYW5nZSh0aGlzLnJlYWRlclN0eWxlLmZvbnRTaXplKTsKICAgIH0sCiAgICBjaGFuZ2VDaGFwdGVyKGNoYXB0ZXIpIHsKICAgICAgdGhpcy5jaGFuZ2VUeXBlID0gIm1lbnUiOwogICAgICB0aGlzLnNob3dMZWZ0RHJhd2VyID0gZmFsc2U7CiAgICAgIHRoaXMuY2hhcHRlciA9IGNoYXB0ZXI7CiAgICB9LAogIH0sCiAgYmVmb3JlQ3JlYXRlOiBmdW5jdGlvbiAoKSB7CiAgICBkb2N1bWVudC50aXRsZSA9ICLlm77kuabpmIXor7siOwogICAgdmFyIHRoYXQgPSB0aGlzOwogICAgdmFyIGJvb2tmaWxlID0gdGhpcy4kcm91dGUucGFyYW1zLnBhdGhNYXRjaDsKICAgIHZhciBwYXJhbVZhbHVlID0gYm9va2ZpbGUuc3BsaXQoIi8iKTsKICAgIGlmIChwYXJhbVZhbHVlLmxlbmd0aCA8IDMpIHsKICAgICAgLy90b2RvIOWPguaVsOmUmeivrwogICAgICB0aGF0Lm1hc2tGbGFnID0gdHJ1ZTsKICAgICAgdGhhdC5lcnJvck1hc2tUZXh0ID0gIuWPguaVsOmUmeivryI7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHZhciB0b2tlbiA9IHBhcmFtVmFsdWVbMl07CiAgICBpZiAodG9rZW4uaW5kZXhPZigidD0iKSA9PSAtMSkgewogICAgICAvL3RvZG8gICDmoKHpqowKICAgICAgaHR0cCh7CiAgICAgICAgbWV0aG9kOiAiR2V0IiwKICAgICAgICB1cmw6ICIiCiAgICAgIH0sIGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBpZiAocmVzLmRhdGEpIHsKICAgICAgICAgIGJvb2tmaWxlID0gcGFyYW1WYWx1ZVswXSArICIvIiArIHBhcmFtVmFsdWVbMV07CiAgICAgICAgICB2YXIgYm9va29wdGlvbiA9IHt9OwogICAgICAgICAgaWYgKCEvLmVwdWIkLy50ZXN0KGJvb2tmaWxlKSAmJiBib29rZmlsZSAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgYm9va29wdGlvbi5vcGVuQXMgPSAnZGlyZWN0b3J5JzsKICAgICAgICAgIH0KICAgICAgICAgIGJvb2sgPSBuZXcgRXB1Yihib29rZmlsZSwgYm9va29wdGlvbik7CiAgICAgICAgICByZW5kaXRpb24gPSBib29rLnJlbmRlclRvKCJ2aWV3ZXIiLCB7CiAgICAgICAgICAgIHdpZHRoOiAiMTAwJSIKICAgICAgICAgIH0pOwogICAgICAgICAgYm9vay5yZWFkeS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGhhdC5jb3ZlcmltZyA9IGJvb2suY292ZXI7CiAgICAgICAgICAgIHJldHVybiBib29rLmxvY2F0aW9ucy5nZW5lcmF0ZSg3MTkpOyAvLyBHZW5lcmF0ZXMgQ0ZJIGZvciBldmVyeSBYIGNoYXJhY3RlcnMgKENoYXJhY3RlcnMgcGVyL3BhZ2UpCiAgICAgICAgICAgIC8vIH0KICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGxvY2F0aW9ucykgeyAvLyBUaGlzIHByb21pc2Ugd2lsbCB0YWtlIGEgbGl0dGxlIHdoaWxlIHRvIHJldHVybiAoQWJvdXQgMjAgc2Vjb25kcyBvciBzbyBmb3IgTW9ieSBEaWNrKQogICAgICAgICAgICB0aGF0LmxvY2F0aW9uTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICBsZXQgbG9jYXRpb24gPSB2aWV3TWFuYWdlci5jdXJyZW50TG9jYXRpb24oKTsKICAgICAgICAgICAgbGV0IHAgPSBsb2NhdGlvblswXS5wYWdlc1swXTsKICAgICAgICAgICAgdGhhdC5wYWdlVGV4dCA9IHRoYXQuYmVnaW5CYXNlUGFnZTsKICAgICAgICAgICAgdGhhdC5wYWdlQW5pbWF0aW9uQ2xhc3MgPSAiIjsKICAgICAgICAgICAgdGhhdC5iZWdpbkJhc2VQYWdlID0gdGhhdC5iZWdpbkJhc2VQYWdlIC0gcDsKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIHZpZXdNYW5hZ2VyOwogICAgICAgICAgcmVuZGl0aW9uLm9uKCJzdGFydGVkIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2aWV3TWFuYWdlciA9IHJlbmRpdGlvbi5tYW5hZ2VyOwogICAgICAgICAgICB2aWV3TWFuYWdlci5vbigiYmVmb3JlQ3JlYXRlVmlldyIsIGZ1bmN0aW9uIChzZWN0aW9uKSB7CiAgICAgICAgICAgICAgdGhhdC5sb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgdmlld01hbmFnZXIub24oImFmdGVyQ3JlYXRlVmlldyIsIGZ1bmN0aW9uICh2aWV3KSB7CiAgICAgICAgICAgICAgdmlldy5ob29rcy5jb250ZW50LnJlZ2lzdGVyKGZ1bmN0aW9uIChpZnJhbWUpIHsKICAgICAgICAgICAgICAgIHRoYXQudXBkYXRlU3R5bGUoKTsKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KQogICAgICAgICAgfSkKICAgICAgICAgIHJlbmRpdGlvbi5vbigicmVuZGVyZWQiLCBmdW5jdGlvbiAoc2VjdGlvbikgewogICAgICAgICAgICBpZiAodmlld01hbmFnZXIuY3VycmVudExvY2F0aW9uKClbMF0ucGFnZXMubGVuZ3RoID49IDIpIHsKICAgICAgICAgICAgICB0aGF0Lm1xbEZsYWdlID0gIXRoYXQubXFsRmxhZ2UKICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgibXFsIiwgIjEiKQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoYXQubXFsRmxhZ2UgPSBmYWxzZQogICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJtcWwiLCAiMCIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gbXFsRmxhZ2UKICAgICAgICAgICAgaWYgKCF0aGF0LmxvY2F0aW9uTG9hZGluZykgewogICAgICAgICAgICAgIGxldCBsb2NhdGlvbiA9IHZpZXdNYW5hZ2VyLmN1cnJlbnRMb2NhdGlvbigpOwogICAgICAgICAgICAgIGxldCBwID0gbG9jYXRpb25bMF0ucGFnZXNbMF07CiAgICAgICAgICAgICAgdGhhdC5iZWdpbkJhc2VQYWdlID0gYm9vay5sb2NhdGlvbnMubG9jYXRpb25Gcm9tQ2ZpKHJlbmRpdGlvbi5jdXJyZW50TG9jYXRpb24oKS5zdGFydC5jZmkpIC0gcDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhhdC5maXJzdExvYWRpbmcpIHsKICAgICAgICAgICAgICAvL2xvY2F0aW9u77yI5Li65LqG5YiG6aG155qE6aG156CB6K6h566X77yJIOi/mOWcqOiuoeeul+S4reeahOivne+8jOeojeetieS4gOS8muWEv+WcqOWFs+mXrWxvYWRpbmfpobXpnaIKICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgdGhhdC5sb2FkaW5nID0gZmFsc2U7IHRoYXQuZmlyc3RMb2FkaW5nID0gZmFsc2UgfSwgNDUwMCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhhdC5sb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGV0IGN1cnJlbnQgPSBib29rLm5hdmlnYXRpb24gJiYgYm9vay5uYXZpZ2F0aW9uLmdldChzZWN0aW9uLmhyZWYpOwogICAgICAgICAgICB0aGF0LmN1cnJlbnRDaGFwZXJJZHggPSBzZWN0aW9uLmluZGV4OwogICAgICAgICAgICBpZiAodGhhdC5jaGFwdGVyLmhyZWYgIT0gY3VycmVudC5ocmVmKSB7CiAgICAgICAgICAgICAgdGhhdC5jaGFuZ2VUeXBlID0gInR1cm5QYWdlIjsKICAgICAgICAgICAgICB0aGF0LmNoYXB0ZXIgPSBjdXJyZW50OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgbXFsID0gd2luZG93Lm1hdGNoTWVkaWEoIihvcmllbnRhdGlvbjogcG9ydHJhaXQpIik7CiAgICAgICAgICAgIHZhciBpZnJhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaWZyYW1lIilbMF0uY29udGVudFdpbmRvdy5kb2N1bWVudDsKICAgICAgICAgICAgdmFyIHZpZXdwb3J0ID0gaWZyYW1lLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJodG1sIilbMF07CiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmlld2VyIikuZmlyc3RFbGVtZW50Q2hpbGQ7CiAgICAgICAgICAgIHZhciBzdGFydFNjcm9sbExlZnQ7CiAgICAgICAgICAgIHZhciBwYWdlV2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDsgLy8g6aG16Z2i5a695bqmCiAgICAgICAgICAgIHZhciBtYXhXaWR0aCA9IHBhZ2VXaWR0aCAvIDI7CiAgICAgICAgICAgIHZhciBzdGFydFgsIHN0YXJ0WTsKICAgICAgICAgICAgdmFyIGluaXRpYWxQb3MgPSAwOyAgLy8g5omL5oyH5oyJ5LiL55qE5bGP5bmV5L2N572uCiAgICAgICAgICAgIHZhciBtb3ZlTGVuZ3RoID0gMDsgIC8vIOaJi+aMh+W9k+WJjea7keWKqOeahOi3neemuwogICAgICAgICAgICB2YXIgZGlyZWN0aW9uID0gJ2xlZnQnOyAvLyDmu5HliqjnmoTmlrnlkJEKICAgICAgICAgICAgdmFyIGlzTW92ZSA9IGZhbHNlOyAvLyDmmK/lkKblj5HnlJ/lt6blj7Pmu5HliqgKICAgICAgICAgICAgdmFyIHN0YXJ0VCA9IDA7IC8vIOiusOW9leaJi+aMh+aMieS4i+WOu+eahOaXtumXtAogICAgICAgICAgICB2YXIgaXNUb3VjaEVuZCA9IHRydWU7IC8vIOagh+iusOW9k+WJjea7keWKqOaYr+WQpue7k+adnyjmiYvmjIflt7LnprvlvIDlsY/luZUpCiAgICAgICAgICAgIHZhciB0aHJvdHRsZVRpbWUgPSAwOwogICAgICAgICAgICB2YXIgbGFzdFNjcm9sbCwgdG90YWxQYWdlczsKICAgICAgICAgICAgdGhhdC5jdXJyZW50UGFnZSA9IDA7CiAgICAgICAgICAgIC8vIGxldCBsb2NhdGlvbiA9IHZpZXdNYW5hZ2VyLmN1cnJlbnRMb2NhdGlvbigpOwogICAgICAgICAgICAvLyB0aGF0LmN1cnJlbnRQYWdlID0gbG9jYXRpb25bMF0ucGFnZXNbMF07IAogICAgICAgICAgICBpZiAobXFsLm1hdGNoZXMpIHsKICAgICAgICAgICAgICB0aGlzLm1xbCA9ICIwIgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMubXFsID0gIjEiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1xbC5tYXRjaGVzKSB7CiAgICAgICAgICAgICAgLy8g5omL5oyH5pS+5Zyo5bGP5bmV5LiKCiAgICAgICAgICAgICAgdmlld3BvcnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICBzdGFydFNjcm9sbExlZnQgPSBjb250YWluZXIuc2Nyb2xsTGVmdDsKICAgICAgICAgICAgICAgIGxldCBsb2NhdGlvbiA9IHZpZXdNYW5hZ2VyLmN1cnJlbnRMb2NhdGlvbigpOwogICAgICAgICAgICAgICAgdG90YWxQYWdlcyA9IGxvY2F0aW9uWzBdLnRvdGFsUGFnZXM7CiAgICAgICAgICAgICAgICAvL3RoYXQuY3VycmVudFBhZ2UgPSBsb2NhdGlvblswXS5wYWdlc1swXTsgIAogICAgICAgICAgICAgICAgLy90b3VjaHN0YXJ05LiOdG91Y2hlbmTnmoTmtY/op4jlmajpu5jorqTooYzkuLrkuI3og73pmLvmraLvvIwKICAgICAgICAgICAgICAgIC8vIOWmguaenOmYu+atoueahOivneWImea1j+iniOWZqOaXoOazleiuoeeul+ivpeiKgueCueWGheeahOeCueWHu+etieWFtuS7luS6i+S7tgogICAgICAgICAgICAgICAgLy9lLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAvLyDljZXmiYvmjIfop6bmkbjmiJbogIXlpJrmiYvmjIflkIzml7bop6bmkbjvvIznpoHmraLnrKzkuozkuKrmiYvmjIflu7bov5/mk43kvZzkuovku7YKICAgICAgICAgICAgICAgIGlmIChlLnRvdWNoZXMubGVuZ3RoID09PSAxIHx8IGlzVG91Y2hFbmQpIHsKICAgICAgICAgICAgICAgICAgdmFyIHRvdWNoID0gZS50b3VjaGVzWzBdOwogICAgICAgICAgICAgICAgICBzdGFydFggPSB0b3VjaC5wYWdlWDsKICAgICAgICAgICAgICAgICAgc3RhcnRZID0gdG91Y2gucGFnZVk7CiAgICAgICAgICAgICAgICAgIGxhc3RTY3JvbGwgPSAwOwogICAgICAgICAgICAgICAgICBzdGFydFQgPSArIG5ldyBEYXRlKCk7IC8vIOiusOW9leaJi+aMh+aMieS4i+eahOW8gOWni+aXtumXtAogICAgICAgICAgICAgICAgICBpc01vdmUgPSBmYWxzZTsgLy8g5piv5ZCm5Lqn55Sf5ruR5YqoCiAgICAgICAgICAgICAgICAgIGlzVG91Y2hFbmQgPSBmYWxzZTsgLy8g5b2T5YmN5ruR5Yqo5byA5aeLCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwgeyBwYXNzaXZlOiBmYWxzZSB9KTsKICAgICAgICAgICAgICAvLyDmiYvmjIflnKjlsY/luZXkuIrmu5HliqjvvIzpobXpnaLot5/pmo/miYvmjIfnp7vliqgKICAgICAgICAgICAgICB2aWV3cG9ydC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgLy/nlKjkuo7popHnuYHmu5HliqjpmLLmipYKICAgICAgICAgICAgICAgIC8vIHZhciBub3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgICAgICAgICAgICAgIC8vIGlmKCF0aHJvdHRsZVRpbWUpIHRocm90dGxlVGltZT1ub3c7CiAgICAgICAgICAgICAgICAvLyBpZihub3ctdGhyb3R0bGVUaW1lPDIwKSByZXR1cm47CiAgICAgICAgICAgICAgICAvLyB0aHJvdHRsZVRpbWUgPSBub3c7CiAgICAgICAgICAgICAgICAvLyDlpoLmnpzlvZPliY3mu5Hliqjlt7Lnu5PmnZ/vvIzkuI3nrqHlhbbku5bmiYvmjIfmmK/lkKblnKjlsY/luZXkuIrpg73npoHmraLor6Xkuovku7YKICAgICAgICAgICAgICAgIGlmIChpc1RvdWNoRW5kKSByZXR1cm47CiAgICAgICAgICAgICAgICB2YXIgdG91Y2ggPSBlLnRvdWNoZXNbMF07CiAgICAgICAgICAgICAgICAvL2NvbnRhaW5lciBzY3JvbGzmlLnlj5jml7Z0b3VjaC5wYWdlWOS5n+S8mui3n+edgOWPmO+8jOaJgOS7pemcgOimgeWHj+aOieWuueWZqOa7muWKqOeahOi3neemu+iOt+WPluecn+ato+eahOaJi+aMh+enu+WKqOi3neemu+OAggogICAgICAgICAgICAgICAgdmFyIHNjcm9sbHRlbXAgPSBjb250YWluZXIuc2Nyb2xsTGVmdCAtIHN0YXJ0U2Nyb2xsTGVmdDsKICAgICAgICAgICAgICAgIHZhciBkZWx0YVggPSB0b3VjaC5wYWdlWCAtIHN0YXJ0WCAtIHNjcm9sbHRlbXA7CgogICAgICAgICAgICAgICAgZGlyZWN0aW9uID0gZGVsdGFYID4gMCA/ICdyaWdodCcgOiAnbGVmdCc7IC8vIOWIpOaWreaJi+aMh+a7keWKqOeahOaWueWQkQogICAgICAgICAgICAgICAgLy8gaWYodGhhdC5jaGFwdGVyLmhyZWY9PXRoYXQudG9jWzBdLmhyZWYmJmRpcmVjdGlvbj09J3JpZ2h0JyYmY3VycmVudFBhZ2U9PTEpIHJldHVybjsKICAgICAgICAgICAgICAgIGlzTW92ZSA9IHRydWU7CiAgICAgICAgICAgICAgICBtb3ZlTGVuZ3RoID0gZGVsdGFYOwogICAgICAgICAgICAgICAgc2Nyb2xsUGFnZS5jYWxsKHZpZXdwb3J0LCBtb3ZlTGVuZ3RoLCBlKTsKICAgICAgICAgICAgICAgIC8v5aaC5p6c5ruR5Yqo6Led56a76LaF6L+H5pyA5aSn6Led56a75YiZ57+76aG1CiAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMobW92ZUxlbmd0aCkgPj0gbWF4V2lkdGgpIHsKICAgICAgICAgICAgICAgICAgdGhyb3R0bGVUaW1lID0gMDsKICAgICAgICAgICAgICAgICAgdHVyblBhZ2UuY2FsbCh2aWV3cG9ydCwgbW92ZUxlbmd0aCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwgeyBwYXNzaXZlOiBmYWxzZSB9KTsKCiAgICAgICAgICAgICAgLy8g5omL5oyH56a75byA5bGP5bmV5pe277yM6K6h566X5pyA57uI6ZyA6KaB5YGc55WZ5Zyo5ZOq5LiA6aG1CiAgICAgICAgICAgICAgdmlld3BvcnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgaWYgKCFpc01vdmUpIHsKICAgICAgICAgICAgICAgICAgaXNUb3VjaEVuZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldC50YWdOYW1lID09ICJBIiB8fCBlLnRhcmdldC5wYXJlbnROb2RlLnRhZ05hbWUgPT0gIkEiKSByZXR1cm47CiAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgdGhhdC5wb3B1cFNob3cgPSB0cnVlOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aHJvdHRsZVRpbWUgPSAwOwogICAgICAgICAgICAgICAgdmFyIHRyYW5zbGF0ZSA9IDA7CiAgICAgICAgICAgICAgICAvLyDorqHnrpfmiYvmjIflnKjlsY/luZXkuIrlgZznlZnnmoTml7bpl7QKICAgICAgICAgICAgICAgIHZhciBkZWx0YVQgPSArIG5ldyBEYXRlKCkgLSBzdGFydFQ7CiAgICAgICAgICAgICAgICAvLyDlj5HnlJ/kuobmu5HliqjvvIzlubbkuJTlvZPliY3mu5Hliqjkuovku7bmnKrnu5PmnZ8KICAgICAgICAgICAgICAgIGlmIChpc01vdmUgJiYgIWlzVG91Y2hFbmQpIHsKICAgICAgICAgICAgICAgICAgaXNUb3VjaEVuZCA9IHRydWU7IC8vIOagh+iusOW9k+WJjeWujOaVtOeahOa7keWKqOS6i+S7tuW3sue7j+e7k+adnwogICAgICAgICAgICAgICAgICAvLyDkvb/nlKjliqjnlLvov4fmuKHorqnpobXpnaLmu5HliqjliLDmnIDnu4jnmoTkvY3nva4KICAgICAgICAgICAgICAgICAgaWYgKGRlbHRhVCA8IDMwMCkgeyAvLyDlpoLmnpzlgZznlZnml7bpl7TlsI/kuo4zMDBtcyzliJnorqTkuLrmmK/lv6vpgJ/mu5HliqjvvIzml6Dorrrmu5Hliqjot53nprvmmK/lpJrlsJHvvIzpg73lgZznlZnliLDkuIvkuIDpobUKICAgICAgICAgICAgICAgICAgICB0dXJuUGFnZS5jYWxsKHZpZXdwb3J0LCBtb3ZlTGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyDlpoLmnpzmu5Hliqjot53nprvlsI/kuo7lsY/luZXnmoQ1MCXvvIzliJnpgIDlm57liLDkuIrkuIDpobUKICAgICAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMobW92ZUxlbmd0aCkgPCBtYXhXaWR0aCkgewogICAgICAgICAgICAgICAgICAgICAgLy8g5omn6KGM5ruR5Yqo77yM6K6p6aG16Z2i5oGi5aSNCiAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxQYWdlLmNhbGwodmlld3BvcnQsIDApOwogICAgICAgICAgICAgICAgICAgICAgaXNUb3VjaEVuZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIC8vIOWmguaenOa7keWKqOi3neemu+Wkp+S6juWxj+W5leeahDUwJe+8jOWImee/u+mhtQogICAgICAgICAgICAgICAgICAgICAgdHVyblBhZ2UuY2FsbCh2aWV3cG9ydCwgbW92ZUxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwgeyBwYXNzaXZlOiBmYWxzZSB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiB0dXJuUGFnZShtb3ZlTGVuZ3RoKSB7CiAgICAgICAgICAgICAgaXNUb3VjaEVuZCA9IHRydWU7CiAgICAgICAgICAgICAgdGhpcy5zdHlsZS53ZWJraXRUcmFuc2Zvcm0gPSAndHJhbnNsYXRlM2QoMCwgMCwgMCknOwogICAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPT09ICJsZWZ0IikgewogICAgICAgICAgICAgICAgaWYgKGJvb2sucGFja2FnZS5tZXRhZGF0YS5kaXJlY3Rpb24gPT09ICJydGwiKSB7CiAgICAgICAgICAgICAgICAgIHJlbmRpdGlvbi5wcmV2KG1vdmVMZW5ndGgpOwogICAgICAgICAgICAgICAgICAvL3RoYXQuY3VycmVudFBhZ2UtLTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHJlbmRpdGlvbi5uZXh0KG1vdmVMZW5ndGgpOwogICAgICAgICAgICAgICAgICAvL3RoYXQuY3VycmVudFBhZ2UrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKHRoYXQuY3VycmVudFBhZ2UgPT0gMSAmJiBib29rLnBhY2thZ2UubWV0YWRhdGEuZGlyZWN0aW9uICE9ICJydGwiICYmIHRoYXQuY3VycmVudENoYXBlcklkeCA8PSAyKSByZXR1cm47IC8v56ys5LiA6aG156aB5q2i57un57ut5ZCR5YmNCiAgICAgICAgICAgICAgICBpZiAoYm9vay5wYWNrYWdlLm1ldGFkYXRhLmRpcmVjdGlvbiA9PT0gInJ0bCIpIHsKICAgICAgICAgICAgICAgICAgcmVuZGl0aW9uLm5leHQobW92ZUxlbmd0aCk7CiAgICAgICAgICAgICAgICAgIC8vdGhhdC5jdXJyZW50UGFnZSsrOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgcmVuZGl0aW9uLnByZXYobW92ZUxlbmd0aCk7CiAgICAgICAgICAgICAgICAgIC8vdGhhdC5jdXJyZW50UGFnZS0tOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvLyDpobXpnaLlubPnp7sKICAgICAgICAgICAgZnVuY3Rpb24gc2Nyb2xsUGFnZSh0cmFuc2xhdGUsIHR5cGUpIHsKICAgICAgICAgICAgICBpZiAodGhhdC5jdXJyZW50UGFnZSA9PSAxICYmIGRpcmVjdGlvbiA9PT0gInJpZ2h0IiB8fCB0aGF0LmN1cnJlbnRQYWdlID09IHRvdGFsUGFnZXMgJiYgZGlyZWN0aW9uID09PSAibGVmdCIpIHsKICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUud2Via2l0VHJhbnNmb3JtID0gJ3RyYW5zbGF0ZTNkKCcgKyB0cmFuc2xhdGUgKyAncHgsIDAsIDApJzsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29udGFpbmVyLnNjcm9sbExlZnQgPSBzdGFydFNjcm9sbExlZnQgLSB0cmFuc2xhdGU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIHJlbmRpdGlvbi5vbigicmVsb2NhdGVkIiwgZnVuY3Rpb24gKGxvY2F0aW9ucykgewogICAgICAgICAgICAvL2NvbnNvbGUubG9nKCJyZWxvY2F0ZWQgbG9jYXRpb24iLGxvY2F0aW9ucyk7CiAgICAgICAgICAgIC8vIFdoZW4gbmF2aWdhdGluZyB0byB0aGUgbmV4dC9wcmV2aW91cyBwYWdlCiAgICAgICAgICAgIC8vbGV0IHByb2dyZXNzID0gYm9vay5sb2NhdGlvbnMucGVyY2VudGFnZUZyb21DZmkobG9jYXRpb25zLnN0YXJ0LmNmaSk7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdQcm9ncmVzczonLCBwcm9ncmVzcyk7IC8vIFRoZSAlIG9mIGhvdyBmYXIgYWxvbmcgaW4gdGhlIGJvb2sgeW91IGFyZQogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnQ3VycmVudCBQYWdlOicsYm9vay5sb2NhdGlvbnMubG9jYXRpb25Gcm9tQ2ZpKGxvY2F0aW9ucy5zdGFydC5jZmkpKTsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ1RvdGFsIFBhZ2VzOicsYm9vay5sb2NhdGlvbnMudG90YWwpOwogICAgICAgICAgICB0aGF0LnBhZ2VBbmltYXRpb25DbGFzcyA9ICJmYWRlb3V0IjsKICAgICAgICAgICAgc2V0VGltZW91dCgKICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBsZXQgbG9jYXRpb24gPSB2aWV3TWFuYWdlci5jdXJyZW50TG9jYXRpb24oKTsKICAgICAgICAgICAgICAgIHRoYXQuY3VycmVudFBhZ2UgPSBsb2NhdGlvblswXS5wYWdlc1swXTsKICAgICAgICAgICAgICAgIC8vIHRoYXQuY3VycmVudFBhZ2UgLSAxOwogICAgICAgICAgICAgICAgbGV0IHRvdGFsID0gYm9vay5sb2NhdGlvbnMudG90YWw7CiAgICAgICAgICAgICAgICBpZiAodGhhdC5sb2NhdGlvbkxvYWRpbmcgJiYgdG90YWwgPCA3MCkgeyAvL+WKoOi9veS4re+8jOS4lOWImuW8gOWni+WKoOi9veeahOaXtuWAme+8jOWmguaenOS8sOeul+W3sue7j+Wkp+S6jjcw6aG15LqG77yM5Lmf5bCd6K+V5LiA5LiLCiAgICAgICAgICAgICAgICAgIHRoYXQucGFnZVRleHQgPSAiIjsKICAgICAgICAgICAgICAgICAgdGhhdC5wYWdlUHJvY2VzcyA9IDA7CiAgICAgICAgICAgICAgICAgIHRoYXQucGFnZUFuaW1hdGlvbkNsYXNzID0gIiI7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxldCBwcm9ncmVzcyA9IGJvb2subG9jYXRpb25zLnBlcmNlbnRhZ2VGcm9tQ2ZpKGxvY2F0aW9ucy5zdGFydC5jZmkpOwogICAgICAgICAgICAgICAgdGhhdC5wYWdlUHJvY2VzcyA9IHBhcnNlSW50KHByb2dyZXNzICogMTAwKTsKICAgICAgICAgICAgICAgIGlmICh0b3RhbCA8IHRoYXQuYmVnaW5CYXNlUGFnZSArIGxvY2F0aW9uWzBdLnRvdGFsUGFnZXMpIHRvdGFsID0gdGhhdC5iZWdpbkJhc2VQYWdlICsgbG9jYXRpb25bMF0udG90YWxQYWdlczsKICAgICAgICAgICAgICAgIC8vIGxldCBzaG93cGFnZSA9IHRoYXQuYmVnaW5CYXNlUGFnZSArIHRoYXQuY3VycmVudFBhZ2U7CiAgICAgICAgICAgICAgICAvLyBsZXQgY2FscGFnZSA9IGJvb2subG9jYXRpb25zLmxvY2F0aW9uRnJvbUNmaShsb2NhdGlvbnMuc3RhcnQuY2ZpKTsKICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdzaG93cGFnZTonLCBzaG93cGFnZSk7ICAKICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdjYWxwYWdlOicsIGNhbHBhZ2UpOyAKICAgICAgICAgICAgICAgIC8vaWYgKGNhbHBhZ2U+dG90YWwpIHRvdGFsPWNhbHBhZ2U7CiAgICAgICAgICAgICAgICAvL+aciemTvuaOpei3s+i9rOeahOaXtuWAme+8jOi/meaYr2N1cnJlbnRQYWdl5piv5LiN5a+555qECiAgICAgICAgICAgICAgICAvLyBpZiAoIE1hdGguYWJzKGNhbHBhZ2UgLSBzaG93cGFnZSk+MSApewogICAgICAgICAgICAgICAgLy8gICAgIHRoYXQuY3VycmVudFBhZ2UgPSBjYWxwYWdlIC0gc2hvd3BhZ2U7CiAgICAgICAgICAgICAgICAvLyAgICAgc2hvd3BhZ2UgPSBjYWxwYWdlOwogICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgICAgbGV0IHNob3dwYWdlID0gdGhhdC5iZWdpbkJhc2VQYWdlICsgdGhhdC5jdXJyZW50UGFnZTsKICAgICAgICAgICAgICAgIC8vaWYgKHNob3dwYWdlPnRvdGFsKSBzaG93cGFnZT10b3RhbDsKICAgICAgICAgICAgICAgIC8vdGhhdC5wYWdlVGV4dCA9IHNob3dwYWdlICArICAiLyIgKyB0b3RhbDsKICAgICAgICAgICAgICAgIHRoYXQucGFnZVRleHQgPSBzaG93cGFnZTsKICAgICAgICAgICAgICAgIHRoYXQucGFnZUFuaW1hdGlvbkNsYXNzID0gIiI7CiAgICAgICAgICAgICAgfSwgNDAwKTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmVuZGl0aW9uLm9uKCJsYXlvdXQiLCBmdW5jdGlvbiAobGF5b3V0KSB7CiAgICAgICAgICAgIC8vICAgY29uc29sZS5sb2coImxheW91dCIsIGxheW91dCk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJlbmRpdGlvbi5vbigibG9jYXRpb25DaGFuZ2VkIiwgZnVuY3Rpb24gKG9iaikgewogICAgICAgICAgICAvLyBpbmRleCAobnVtYmVyKQogICAgICAgICAgICAvLyBocmVmIChzdHJpbmcpCiAgICAgICAgICAgIC8vIHN0YXJ0IChFcHViQ0ZJKQogICAgICAgICAgICAvLyBlbmQgKEVwdWJDRkkpCiAgICAgICAgICAgIC8vIHBlcmNlbnRhZ2UgKG51bWJlcikKICAgICAgICAgICAgLy8gICBjb25zb2xlLmxvZygibG9jYXRpb25DaGFuZ2VkIiwgb2JqKTsKICAgICAgICAgIH0pOwogICAgICAgICAgYm9vay5sb2FkZWQubmF2aWdhdGlvbi50aGVuKGZ1bmN0aW9uICh0b2MpIHsKICAgICAgICAgICAgdGhhdC5jaGFwdGVyID0gdG9jLnRvY1swXTsKICAgICAgICAgICAgdGhhdC50b2MgPSB0b2MudG9jOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoYXQubWFza0ZsYWcgPSB0cnVlOwogICAgICAgICAgdGhhdC5lcnJvck1hc2tUZXh0ID0gInRva2Vu5peg5pWIIjsKICAgICAgICB9CiAgICAgICAgLy8gY29uc29sZS5sb2cocmVzKTsKICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgIGNvbnNvbGUubG9nKCLor7fmsYLlpLHotKUiKTsKICAgICAgfSk7CiAgICB9CgoKCiAgfSwKICBkZXN0cm95ZWQ6IGZ1bmN0aW9uICgpIHsKICAgIGJvb2suZGVzdHJveSgpOwogIH0sCiAgbW91bnRlZCgpIHsKCiAgfSwKICBjcmVhdGVkKCkgewoKICB9Cn0K"},{"version":3,"sources":["book.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA","file":"book.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div>\n    <div id=\"reader-overlay\"></div>\n\n    <van-popup v-model=\"showLeftDrawer\" position=\"left\" :style=\"{ width: '80%',height:'100%' }\">\n      <van-tabs type=\"card\">\n        <van-tab title=\"目录\">\n          <bookmenu v-bind:menuList=\"toc\" v-bind:currentMenu=\"chapter\" @change=\"changeChapter\"></bookmenu>\n        </van-tab>\n        <!--    <van-tab title=\"书签\">内容 2</van-tab>\n              <van-tab title=\"笔记\">内容 3</van-tab>\n              -->\n      </van-tabs>\n\n    </van-popup>\n\n    <van-popup v-model=\"popupShow\" position=\"top\" :style=\"{ height: '30%' }\" class=\"reader-tool\">\n      <div>\n        <van-row class=\"tool-row\">\n          <van-col span=\"4\">亮度</van-col>\n          <van-col span=\"16\">\n            <van-slider v-model=\"light\" @change=\"onLightChange\" />\n          </van-col>\n        </van-row>\n        <van-row class=\"tool-row\">\n          <van-col span=\"4\">字号</van-col>\n          <van-col span=\"16\">\n            <van-stepper v-model=\"fontSize\" @change=\"onFontSizeChange\" min=\"10\" max=\"24\" input-width=\"40px\" button-size=\"32px\" step=\"2\" disable-input />\n          </van-col>\n        </van-row>\n\n      </div>\n\n    </van-popup>\n\n    <div v-if=\"loading\" class=\"loading-overlay\">\n      <img v-if=\"firstLoading\" id=\"CoverImg\" :src=\"coverimg\" />\n      <div v-if=\"firstLoading\" style=\"color:gray;position:absolute;bottom:12px;width:100%;text-align:center;height:20px;\">加载中...</div>\n      <van-loading color=\"#1989fa\" />\n    </div>\n\n    <div style=\"height: 100vh\">\n      <van-nav-bar v-bind:title=\"chapter.label\" left-text=\"\" right-text=\"章节\" @click-right=\"onClickRight\"></van-nav-bar>\n      <div id=\"viewer\">\n        <div style=\"position: absolute;left:0;font-size: 50px;z-index: 1234;top: 50%;width:50px;height:50px\" @click=\"prevPage()\" v-if=\"mql==1 || mqlFlage== true\">\n          <img src=\"../assets/left.png\" alt=\"\" style=\"width:100%;height:100%\">\n        </div>\n        <div style=\"position: absolute;right:0;font-size: 50px;z-index: 1234;top: 50%;width:50px;height:50px\" @click=\"nextPage()\" v-if=\"mql==1 || mqlFlage==true\"><img src=\"../assets/right.png\" alt=\"\" style=\"width:100%;height:100%\"></div>\n      </div>\n    </div>\n\n    <div id=\"page-overlay\" :class=\"pageAnimationClass\">{{ pageText }}</div>\n    <div id=\"page-overlay-bar\">\n      <div id=\"page-overlay-process\" :style=\"{ height:'3px', backgroundColor:'red' ,width : pageProcess + '%'}\">\n      </div>\n    </div>\n    <div class=\"errorMask\" v-if=\"maskFlag\">{{errorMaskText}}</div>\n  </div>\n\n</template>\n<style scoped>\n.errorMask {\n  width: 100%;\n  height: 100%;\n  font-size: 40px;\n  font-weight: bold;\n  text-align: center;\n  padding-top: 20px;\n  position: fixed;\n  top: 0;\n  left: 0;\n  background: #fff;\n  z-index: 10000;\n  letter-spacing: 2px;\n}\n.fadeout {\n  -webkit-animation: fadeout 0.6s linear 0s normal 1 forwards;\n  animation: fadeout 0.6s linear 0s normal 1 forwards;\n}\n\n@-webkit-keyframes fadeout {\n  0% {\n    opacity: 1;\n  }\n  100% {\n    opacity: 0;\n  }\n}\n@keyframes fadeout {\n  0% {\n    opacity: 1;\n  }\n  100% {\n    opacity: 0;\n  }\n}\n\n#page-overlay {\n  position: absolute;\n  bottom: 6px;\n  text-align: right;\n  height: 12px;\n  left: 0;\n  right: 5px;\n  z-index: 1000;\n  font-size: 10px;\n}\n#page-overlay-bar {\n  position: absolute;\n  bottom: 3px;\n  height: 2px;\n  left: 0;\n  right: 0;\n  z-index: 1000;\n  background-color: gray;\n}\n\n#CoverImg {\n  width: 90%;\n  padding-top: 5%;\n}\n.loading-overlay {\n  position: absolute;\n  top: 0px;\n  bottom: 0px;\n  left: 0;\n  right: 0;\n  z-index: 10000;\n\n  text-align: center;\n  background-color: white;\n}\n.tool-row {\n  /*height: 40px;*/\n  text-align: center;\n  line-height: 40px;\n}\n.van-popup > div {\n  padding: 10px;\n}\n.van-slider {\n  margin: 20px;\n}\n#reader-overlay {\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  right: 0;\n  left: 0;\n  z-index: 10000;\n  background-color: rgba(0, 0, 0, 0);\n  pointer-events: none;\n}\n.backImage {\n  display: inline-block;\n  width: 30px;\n  height: 30px;\n  border-radius: 30px;\n  margin-top: 5px;\n  border: 1px solid #dfdfdf;\n}\n.bg-timg4 {\n  background: url(\"/readerImages/css_sprites.png\") -10px -10px;\n}\n.bg-timg3 {\n  background: url(\"/readerImages/css_sprites.png\") -70px -10px;\n}\n.bg-timg1 {\n  background: url(\"/readerImages/css_sprites.png\") -10px -70px;\n}\n.bg-timg {\n  background: url(\"/readerImages/css_sprites.png\") -70px -70px;\n}\n</style>\n<script>\nimport { Image, Tab, Tabs, Loading, NavBar, CellGroup, Cell, Card, RadioGroup, Radio, Popup, Progress, Row, Col, Slider, Stepper } from 'vant';\nimport bookmenu from '@/components/bookmenu';\nimport Vue from 'vue';\nimport Epub from 'epubjs';\nimport http from \"./http.js\";\nVue.use(NavBar).use(Loading).use(Card)\n  .use(RadioGroup).use(Radio).use(CellGroup)\n  .use(Cell).use(Tabs).use(Tab).use(Popup).use(Progress)\n  .use(Row).use(Col).use(Slider).use(Stepper).use(Image);\nvar book, rendition;\nexport default {\n  name: 'book',\n  components: {\n    bookmenu: bookmenu\n  },\n  data() {\n    return {\n      publicPath: process.env.BASE_URL,\n      book: null,\n      beginBasePage: 2,\n      pageText: \"\",\n      pageProcess: 0,\n      currentPage: 1,\n      currentChaperIdx: 2,\n      rendition: null,\n      chapter: {},\n      changeType: \"menu\",\n      firstLoad: true,\n      loading: true,\n      popupShow: false,\n      showLeftDrawer: false,\n      light: 100,\n      locationLoading: true,\n      firstLoading: true,\n      maskFlag: false,\n      errorMaskText: \"\",\n      fontSize: 14,\n      backImage: \"\",\n      toc: [],\n      backImageList: [\n        { class: \"bg-timg\", backImagesrc: \"readerImages/timg_big.jpg\" },\n        { class: \"bg-timg1\", backImagesrc: \"readerImages/timg1_big.jpg\" },\n        { class: \"bg-timg3\", backImagesrc: \"readerImages/timg3_big.jpg\" },\n        { class: \"bg-timg4\", backImagesrc: \"\" },\n      ],\n      readerStyle: {\n        light: 100,\n        fontSize: 14,\n        backImage: \"\"\n      },\n      pageAnimationClass: \"\",\n      coverimg: \"\",\n      mql: \"\",\n      mqlFlage: false\n    }\n  },\n  watch: {\n    toc: {\n      handler: function (oldVal, newVal) {\n        // console.log(newVal)\n      },\n      deep: true\n    },\n    chapter: function (val) {\n      if (this.changeType == \"menu\")\n        rendition.display(val.href);\n    },\n    fontSize: function (val) {\n      this.onFontSizeChange(val);\n    },\n    light: function (val) {\n      this.onLightChange(val);\n    },\n    backImage: function (val) {\n      this.onBackImageChange(val);\n    },\n    mql: function (val) {\n      this.mql = val;\n      localStorage.setItem(\"mql\", this.mql)\n    }\n  },\n  methods: {\n    // 点击下一页\n    nextPage() {\n      rendition.next();\n    },\n    // 点击上一页\n    prevPage() {\n      if (this.currentPage == 1 && book.package.metadata.direction != \"rtl\" && this.currentChaperIdx <= 2) return; //第一页禁止继续向前\n      rendition.prev();\n    },\n    onClickLeft() {\n      window.history.back(-1);\n      // book\n    },\n    onClickRight() {\n      this.showLeftDrawer = true;\n    },\n    onLightChange(val) {\n      var overlay = document.getElementById(\"reader-overlay\");\n      overlay.style.backgroundColor = \"rgba(0,0,0,\" + (0.5 - val / 200) + \")\";\n      this.readerStyle.light = val;\n    },\n    onFontSizeChange(val) {\n      // 判断横屏竖屏展示不同字体大小\n      var mql = window.matchMedia(\"(orientation: portrait)\");\n      if (mql.matches) {\n        // 竖屏\n        // this.fontSize = 15;\n        // this.readerStyle.fontSize = 15;\n        this.mql = \"0\";\n      } else {\n        // 横屏\n        // this.fontSize = 22;\n        // this.readerStyle.fontSize = 22;\n        this.mql = \"1\";\n      }\n      var iframeDoc = document.getElementsByTagName(\"iframe\")[0].contentWindow.document;\n      var fontSizeStyle = iframeDoc.getElementById(\"fontSize\");\n      if (!fontSizeStyle) {\n        fontSizeStyle = iframeDoc.createElement('style');\n        fontSizeStyle.id = \"fontSize\";\n        fontSizeStyle.type = 'text/css';\n        fontSizeStyle.innerHTML = \"p,div{ font-size:\" + val + \"px }\";\n        iframeDoc.getElementsByTagName('HEAD').item(0).appendChild(fontSizeStyle);\n      } else {\n        fontSizeStyle.innerHTML = \"p,div{ font-size:\" + val + \"px }\";\n      }\n      if (this.readerStyle.fontSize != val) {\n        this.readerStyle.fontSize = val;\n        // this.locationLoading = true;\n        // let that = this;\n        // book.locations.generate(666).then(function(location) { // This promise will take a little while to return (About 20 seconds or so for Moby Dick)\n        //     that.locationLoading = false;\n        //     that.pageText = (that.beginBasePage + that.currentPage) + \"/\" + book.locations.total;\n        // });\n      }\n    },\n    onBackImageChange(val) {\n      var iframeDoc = document.getElementsByTagName(\"iframe\")[0].contentWindow.document;\n      var bdoy = iframeDoc.getElementsByTagName(\"body\")[0];\n      bdoy.style.backgroundImage = val;\n      this.readerStyle.backImage = val;\n    },\n    changeBackImage(value) {\n      if (value.backImagesrc)\n        this.backImage = \"url('\" + this.publicPath + value.backImagesrc + \"')\";\n      else\n        this.backImage = \"\";\n    },\n    updateStyle() {\n      this.onLightChange(this.readerStyle.light);\n      this.onBackImageChange(this.readerStyle.backImage);\n      this.onFontSizeChange(this.readerStyle.fontSize);\n    },\n    changeChapter(chapter) {\n      this.changeType = \"menu\";\n      this.showLeftDrawer = false;\n      this.chapter = chapter;\n    },\n  },\n  beforeCreate: function () {\n    document.title = \"图书阅读\";\n    var that = this;\n    var bookfile = this.$route.params.pathMatch;\n    var paramValue = bookfile.split(\"/\");\n    if (paramValue.length < 3) {\n      //todo 参数错误\n      that.maskFlag = true;\n      that.errorMaskText = \"参数错误\";\n      return;\n    }\n    var token = paramValue[2];\n    if (token.indexOf(\"t=\") == -1) {\n      //todo   校验\n      http({\n        method: \"Get\",\n        url: \"\"\n      }, function (res) {\n        if (res.data) {\n          bookfile = paramValue[0] + \"/\" + paramValue[1];\n          var bookoption = {};\n          if (!/.epub$/.test(bookfile) && bookfile != undefined) {\n            bookoption.openAs = 'directory';\n          }\n          book = new Epub(bookfile, bookoption);\n          rendition = book.renderTo(\"viewer\", {\n            width: \"100%\"\n          });\n          book.ready.then(function () {\n            that.coverimg = book.cover;\n            return book.locations.generate(719); // Generates CFI for every X characters (Characters per/page)\n            // }\n          }).then(function (locations) { // This promise will take a little while to return (About 20 seconds or so for Moby Dick)\n            that.locationLoading = false;\n            let location = viewManager.currentLocation();\n            let p = location[0].pages[0];\n            that.pageText = that.beginBasePage;\n            that.pageAnimationClass = \"\";\n            that.beginBasePage = that.beginBasePage - p;\n          });\n          var viewManager;\n          rendition.on(\"started\", function () {\n            viewManager = rendition.manager;\n            viewManager.on(\"beforeCreateView\", function (section) {\n              that.loading = true;\n            })\n            viewManager.on(\"afterCreateView\", function (view) {\n              view.hooks.content.register(function (iframe) {\n                that.updateStyle();\n              })\n            })\n          })\n          rendition.on(\"rendered\", function (section) {\n            if (viewManager.currentLocation()[0].pages.length >= 2) {\n              that.mqlFlage = !that.mqlFlage\n              localStorage.setItem(\"mql\", \"1\")\n            } else {\n              that.mqlFlage = false\n              localStorage.setItem(\"mql\", \"0\")\n            }\n            // mqlFlage\n            if (!that.locationLoading) {\n              let location = viewManager.currentLocation();\n              let p = location[0].pages[0];\n              that.beginBasePage = book.locations.locationFromCfi(rendition.currentLocation().start.cfi) - p;\n            }\n            if (that.firstLoading) {\n              //location（为了分页的页码计算） 还在计算中的话，稍等一会儿在关闭loading页面\n              setTimeout(function () { that.loading = false; that.firstLoading = false }, 4500);\n            } else {\n              that.loading = false;\n            }\n            let current = book.navigation && book.navigation.get(section.href);\n            that.currentChaperIdx = section.index;\n            if (that.chapter.href != current.href) {\n              that.changeType = \"turnPage\";\n              that.chapter = current;\n            }\n\n            var mql = window.matchMedia(\"(orientation: portrait)\");\n            var iframe = document.getElementsByTagName(\"iframe\")[0].contentWindow.document;\n            var viewport = iframe.getElementsByTagName(\"html\")[0];\n            var container = document.getElementById(\"viewer\").firstElementChild;\n            var startScrollLeft;\n            var pageWidth = window.innerWidth; // 页面宽度\n            var maxWidth = pageWidth / 2;\n            var startX, startY;\n            var initialPos = 0;  // 手指按下的屏幕位置\n            var moveLength = 0;  // 手指当前滑动的距离\n            var direction = 'left'; // 滑动的方向\n            var isMove = false; // 是否发生左右滑动\n            var startT = 0; // 记录手指按下去的时间\n            var isTouchEnd = true; // 标记当前滑动是否结束(手指已离开屏幕)\n            var throttleTime = 0;\n            var lastScroll, totalPages;\n            that.currentPage = 0;\n            // let location = viewManager.currentLocation();\n            // that.currentPage = location[0].pages[0]; \n            if (mql.matches) {\n              this.mql = \"0\"\n            } else {\n              this.mql = \"1\"\n            }\n            if (mql.matches) {\n              // 手指放在屏幕上\n              viewport.addEventListener('touchstart', function (e) {\n                startScrollLeft = container.scrollLeft;\n                let location = viewManager.currentLocation();\n                totalPages = location[0].totalPages;\n                //that.currentPage = location[0].pages[0];  \n                //touchstart与touchend的浏览器默认行为不能阻止，\n                // 如果阻止的话则浏览器无法计算该节点内的点击等其他事件\n                //e.preventDefault();\n                // 单手指触摸或者多手指同时触摸，禁止第二个手指延迟操作事件\n                if (e.touches.length === 1 || isTouchEnd) {\n                  var touch = e.touches[0];\n                  startX = touch.pageX;\n                  startY = touch.pageY;\n                  lastScroll = 0;\n                  startT = + new Date(); // 记录手指按下的开始时间\n                  isMove = false; // 是否产生滑动\n                  isTouchEnd = false; // 当前滑动开始\n                }\n              }, { passive: false });\n              // 手指在屏幕上滑动，页面跟随手指移动\n              viewport.addEventListener('touchmove', function (e) {\n                e.preventDefault();\n                //用于频繁滑动防抖\n                // var now = new Date().getTime();\n                // if(!throttleTime) throttleTime=now;\n                // if(now-throttleTime<20) return;\n                // throttleTime = now;\n                // 如果当前滑动已结束，不管其他手指是否在屏幕上都禁止该事件\n                if (isTouchEnd) return;\n                var touch = e.touches[0];\n                //container scroll改变时touch.pageX也会跟着变，所以需要减掉容器滚动的距离获取真正的手指移动距离。\n                var scrolltemp = container.scrollLeft - startScrollLeft;\n                var deltaX = touch.pageX - startX - scrolltemp;\n\n                direction = deltaX > 0 ? 'right' : 'left'; // 判断手指滑动的方向\n                // if(that.chapter.href==that.toc[0].href&&direction=='right'&&currentPage==1) return;\n                isMove = true;\n                moveLength = deltaX;\n                scrollPage.call(viewport, moveLength, e);\n                //如果滑动距离超过最大距离则翻页\n                if (Math.abs(moveLength) >= maxWidth) {\n                  throttleTime = 0;\n                  turnPage.call(viewport, moveLength);\n                }\n              }, { passive: false });\n\n              // 手指离开屏幕时，计算最终需要停留在哪一页\n              viewport.addEventListener('touchend', function (e) {\n                if (!isMove) {\n                  isTouchEnd = true;\n                  if (e.target.tagName == \"A\" || e.target.parentNode.tagName == \"A\") return;\n                  e.preventDefault();\n                  that.popupShow = true;\n                  return;\n                }\n                throttleTime = 0;\n                var translate = 0;\n                // 计算手指在屏幕上停留的时间\n                var deltaT = + new Date() - startT;\n                // 发生了滑动，并且当前滑动事件未结束\n                if (isMove && !isTouchEnd) {\n                  isTouchEnd = true; // 标记当前完整的滑动事件已经结束\n                  // 使用动画过渡让页面滑动到最终的位置\n                  if (deltaT < 300) { // 如果停留时间小于300ms,则认为是快速滑动，无论滑动距离是多少，都停留到下一页\n                    turnPage.call(viewport, moveLength);\n                  } else {\n                    // 如果滑动距离小于屏幕的50%，则退回到上一页\n                    if (Math.abs(moveLength) < maxWidth) {\n                      // 执行滑动，让页面恢复\n                      scrollPage.call(viewport, 0);\n                      isTouchEnd = true;\n                    } else {\n                      // 如果滑动距离大于屏幕的50%，则翻页\n                      turnPage.call(viewport, moveLength);\n                    }\n                  }\n                }\n              }, { passive: false });\n            }\n            function turnPage(moveLength) {\n              isTouchEnd = true;\n              this.style.webkitTransform = 'translate3d(0, 0, 0)';\n              if (direction === \"left\") {\n                if (book.package.metadata.direction === \"rtl\") {\n                  rendition.prev(moveLength);\n                  //that.currentPage--;\n                } else {\n                  rendition.next(moveLength);\n                  //that.currentPage++;\n                }\n              } else {\n                if (that.currentPage == 1 && book.package.metadata.direction != \"rtl\" && that.currentChaperIdx <= 2) return; //第一页禁止继续向前\n                if (book.package.metadata.direction === \"rtl\") {\n                  rendition.next(moveLength);\n                  //that.currentPage++;\n                } else {\n                  rendition.prev(moveLength);\n                  //that.currentPage--;\n                }\n              }\n            }\n            // 页面平移\n            function scrollPage(translate, type) {\n              if (that.currentPage == 1 && direction === \"right\" || that.currentPage == totalPages && direction === \"left\") {\n                this.style.webkitTransform = 'translate3d(' + translate + 'px, 0, 0)';\n              } else {\n                container.scrollLeft = startScrollLeft - translate;\n              }\n            }\n          });\n          rendition.on(\"relocated\", function (locations) {\n            //console.log(\"relocated location\",locations);\n            // When navigating to the next/previous page\n            //let progress = book.locations.percentageFromCfi(locations.start.cfi);\n            // console.log('Progress:', progress); // The % of how far along in the book you are\n            // console.log('Current Page:',book.locations.locationFromCfi(locations.start.cfi));\n            // console.log('Total Pages:',book.locations.total);\n            that.pageAnimationClass = \"fadeout\";\n            setTimeout(\n              function () {\n                let location = viewManager.currentLocation();\n                that.currentPage = location[0].pages[0];\n                // that.currentPage - 1;\n                let total = book.locations.total;\n                if (that.locationLoading && total < 70) { //加载中，且刚开始加载的时候，如果估算已经大于70页了，也尝试一下\n                  that.pageText = \"\";\n                  that.pageProcess = 0;\n                  that.pageAnimationClass = \"\";\n                  return;\n                }\n                let progress = book.locations.percentageFromCfi(locations.start.cfi);\n                that.pageProcess = parseInt(progress * 100);\n                if (total < that.beginBasePage + location[0].totalPages) total = that.beginBasePage + location[0].totalPages;\n                // let showpage = that.beginBasePage + that.currentPage;\n                // let calpage = book.locations.locationFromCfi(locations.start.cfi);\n                // console.log('showpage:', showpage);  \n                // console.log('calpage:', calpage); \n                //if (calpage>total) total=calpage;\n                //有链接跳转的时候，这是currentPage是不对的\n                // if ( Math.abs(calpage - showpage)>1 ){\n                //     that.currentPage = calpage - showpage;\n                //     showpage = calpage;\n                // }\n                let showpage = that.beginBasePage + that.currentPage;\n                //if (showpage>total) showpage=total;\n                //that.pageText = showpage  +  \"/\" + total;\n                that.pageText = showpage;\n                that.pageAnimationClass = \"\";\n              }, 400);\n          });\n          rendition.on(\"layout\", function (layout) {\n            //   console.log(\"layout\", layout);\n          });\n          rendition.on(\"locationChanged\", function (obj) {\n            // index (number)\n            // href (string)\n            // start (EpubCFI)\n            // end (EpubCFI)\n            // percentage (number)\n            //   console.log(\"locationChanged\", obj);\n          });\n          book.loaded.navigation.then(function (toc) {\n            that.chapter = toc.toc[0];\n            that.toc = toc.toc;\n          });\n        } else {\n          that.maskFlag = true;\n          that.errorMaskText = \"token无效\";\n        }\n        // console.log(res);\n      }, function () {\n        console.log(\"请求失败\");\n      });\n    }\n\n\n\n  },\n  destroyed: function () {\n    book.destroy();\n  },\n  mounted() {\n\n  },\n  created() {\n\n  }\n}\n</script>\n\n<style>\n.van-stepper__input[disabled] {\n  color: black;\n}\n</style>"]}]}