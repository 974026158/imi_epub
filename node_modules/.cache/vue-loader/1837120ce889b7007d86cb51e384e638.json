{"remainingRequest":"/Users/zhangxinbo/Documents/epub-vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhangxinbo/Documents/epub-vue/src/views/book.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zhangxinbo/Documents/epub-vue/src/views/book.vue","mtime":1592918675064},{"path":"/Users/zhangxinbo/Documents/epub-vue/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/zhangxinbo/Documents/epub-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhangxinbo/Documents/epub-vue/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IEltYWdlICxUYWIsIFRhYnMsTG9hZGluZyxOYXZCYXIgLENlbGxHcm91cCxDZWxsLENhcmQsUmFkaW9Hcm91cCxSYWRpbyxQb3B1cCxQcm9ncmVzcywgUm93LCBDb2wsU2xpZGVyLFN0ZXBwZXIgICAgfSBmcm9tICd2YW50JzsKaW1wb3J0ICBib29rbWVudSBmcm9tICdAL2NvbXBvbmVudHMvYm9va21lbnUnOwppbXBvcnQgVnVlIGZyb20gJ3Z1ZSc7CmltcG9ydCBFcHViIGZyb20gJ2VwdWJqcyc7CgoKVnVlLnVzZShOYXZCYXIgKS51c2UoTG9hZGluZyApLnVzZShDYXJkKQogICAgLnVzZShSYWRpb0dyb3VwKS51c2UoUmFkaW8pLnVzZShDZWxsR3JvdXApCiAgICAudXNlKENlbGwpLnVzZShUYWJzKS51c2UoVGFiKS51c2UoUG9wdXAgKS51c2UoUHJvZ3Jlc3MpCiAgICAudXNlKCBSb3cpLnVzZSggQ29sICkudXNlKFNsaWRlcikudXNlKFN0ZXBwZXIpLnVzZShJbWFnZSk7Cgp2YXIgYm9vayxyZW5kaXRpb247CgpleHBvcnQgZGVmYXVsdCB7CiAgICBuYW1lOiAnYm9vaycsCiAgICBjb21wb25lbnRzOnsKICAgICAgICBib29rbWVudTpib29rbWVudQogICAgfSwKICAgIGRhdGEoKXsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBwdWJsaWNQYXRoOnByb2Nlc3MuZW52LkJBU0VfVVJMLAogICAgICAgICAgICBib29rOm51bGwsCiAgICAgICAgICAgIGJlZ2luQmFzZVBhZ2U6MiwKICAgICAgICAgICAgcGFnZVRleHQ6IiIsCiAgICAgICAgICAgIHBhZ2VQcm9jZXNzOjAsCiAgICAgICAgICAgIGN1cnJlbnRQYWdlOjEsCiAgICAgICAgICAgIGN1cnJlbnRDaGFwZXJJZHg6MiwKICAgICAgICAgICAgcmVuZGl0aW9uOm51bGwsCiAgICAgICAgICAgIGNoYXB0ZXI6e30sCiAgICAgICAgICAgIGNoYW5nZVR5cGU6Im1lbnUiLAogICAgICAgICAgICBmaXJzdExvYWQ6dHJ1ZSwKICAgICAgICAgICAgbG9hZGluZzp0cnVlLAogICAgICAgICAgICBwb3B1cFNob3c6ZmFsc2UsCiAgICAgICAgICAgIHNob3dMZWZ0RHJhd2VyOmZhbHNlLAogICAgICAgICAgICBsaWdodDoxMDAsCiAgICAgICAgICAgIGxvY2F0aW9uTG9hZGluZzp0cnVlLAogICAgICAgICAgICBmaXJzdExvYWRpbmc6dHJ1ZSwKICAgICAgICAgICAgZm9udFNpemU6MTQsCiAgICAgICAgICAgIGJhY2tJbWFnZToiIiwKICAgICAgICAgICAgdG9jOltdLAogICAgICAgICAgICBiYWNrSW1hZ2VMaXN0OlsKICAgICAgICAgICAgICAgIHtjbGFzczoiYmctdGltZyIsYmFja0ltYWdlc3JjOiJyZWFkZXJJbWFnZXMvdGltZ19iaWcuanBnIn0sCiAgICAgICAgICAgICAgICB7Y2xhc3M6ImJnLXRpbWcxIixiYWNrSW1hZ2VzcmM6InJlYWRlckltYWdlcy90aW1nMV9iaWcuanBnIn0sCiAgICAgICAgICAgICAgICB7Y2xhc3M6ImJnLXRpbWczIixiYWNrSW1hZ2VzcmM6InJlYWRlckltYWdlcy90aW1nM19iaWcuanBnIn0sCiAgICAgICAgICAgICAgICB7Y2xhc3M6ImJnLXRpbWc0IixiYWNrSW1hZ2VzcmM6IiJ9LAogICAgICAgICAgICBdLAogICAgICAgICAgICByZWFkZXJTdHlsZTp7CiAgICAgICAgICAgICAgICBsaWdodDoxMDAsCiAgICAgICAgICAgICAgICBmb250U2l6ZToxNCwKICAgICAgICAgICAgICAgIGJhY2tJbWFnZToiIgogICAgICAgICAgICB9LAogICAgICAgICAgICBwYWdlQW5pbWF0aW9uQ2xhc3M6IiIsCiAgICAgICAgICAgIGNvdmVyaW1nOiIiCiAgICAgICAgfQogICAgfSwKICAgIHdhdGNoOnsKICAgICAgICB0b2M6ewogICAgICAgICAgICBoYW5kbGVyOmZ1bmN0aW9uIChvbGRWYWwsbmV3VmFsKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhuZXdWYWwpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZXA6dHJ1ZQogICAgICAgIH0sCiAgICAgICAgY2hhcHRlcjpmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgICAgIGlmKHRoaXMuY2hhbmdlVHlwZT09Im1lbnUiKQogICAgICAgICAgICAgICAgcmVuZGl0aW9uLmRpc3BsYXkodmFsLmhyZWYpOwogICAgICAgIH0sCiAgICAgICAgZm9udFNpemU6ZnVuY3Rpb24gKHZhbCkgewogICAgICAgICAgICB0aGlzLm9uRm9udFNpemVDaGFuZ2UodmFsKTsKICAgICAgICB9LAogICAgICAgIGxpZ2h0OmZ1bmN0aW9uICh2YWwpIHsKICAgICAgICAgICB0aGlzLm9uTGlnaHRDaGFuZ2UodmFsKTsKICAgICAgICB9LAogICAgICAgIGJhY2tJbWFnZTpmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgICAgdGhpcy5vbkJhY2tJbWFnZUNoYW5nZSh2YWwpOwogICAgICAgIH0KICAgIH0sCiAgICBtZXRob2RzOnsKICAgICAgICBvbkNsaWNrTGVmdCgpIHsKICAgICAgICAgICAgd2luZG93Lmhpc3RvcnkuYmFjaygtMSk7CiAgICAgICAgICAgIC8vIGJvb2sKICAgICAgICB9LAogICAgICAgIG9uQ2xpY2tSaWdodCgpIHsKICAgICAgICAgICAgdGhpcy5zaG93TGVmdERyYXdlcj10cnVlOwogICAgICAgIH0sCiAgICAgICAgb25MaWdodENoYW5nZSh2YWwpewogICAgICAgICAgICB2YXIgb3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyZWFkZXItb3ZlcmxheSIpOwogICAgICAgICAgICBvdmVybGF5LnN0eWxlLmJhY2tncm91bmRDb2xvcj0icmdiYSgwLDAsMCwiKygwLjUtdmFsLzIwMCkrIikiOwogICAgICAgICAgICB0aGlzLnJlYWRlclN0eWxlLmxpZ2h0PXZhbDsKICAgICAgICB9LAogICAgICAgIG9uRm9udFNpemVDaGFuZ2UodmFsKXsKICAgICAgICAgICAgdmFyIGlmcmFtZURvYyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpZnJhbWUiKVswXS5jb250ZW50V2luZG93LmRvY3VtZW50OwogICAgICAgICAgICB2YXIgZm9udFNpemVTdHlsZSA9IGlmcmFtZURvYy5nZXRFbGVtZW50QnlJZCgiZm9udFNpemUiKTsKICAgICAgICAgICAgaWYoIWZvbnRTaXplU3R5bGUpewogICAgICAgICAgICAgICAgZm9udFNpemVTdHlsZSA9IGlmcmFtZURvYy5jcmVhdGVFbGVtZW50KCdzdHlsZScpOwogICAgICAgICAgICAgICAgZm9udFNpemVTdHlsZS5pZCA9ICJmb250U2l6ZSI7CiAgICAgICAgICAgICAgICBmb250U2l6ZVN0eWxlLnR5cGUgPSAndGV4dC9jc3MnOwogICAgICAgICAgICAgICAgZm9udFNpemVTdHlsZS5pbm5lckhUTUw9InAsZGl2eyBmb250LXNpemU6Iit2YWwrInB4IH0iOwogICAgICAgICAgICAgICAgaWZyYW1lRG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdIRUFEJykuaXRlbSgwKS5hcHBlbmRDaGlsZChmb250U2l6ZVN0eWxlKTsKICAgICAgICAgICAgfSBlbHNlewogICAgICAgICAgICAgICAgZm9udFNpemVTdHlsZS5pbm5lckhUTUw9InAsZGl2eyBmb250LXNpemU6Iit2YWwrInB4IH0iOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAoKICAgICAgICAgICAgaWYgKHRoaXMucmVhZGVyU3R5bGUuZm9udFNpemUhPXZhbCl7CiAgICAgICAgICAgICAgICB0aGlzLnJlYWRlclN0eWxlLmZvbnRTaXplPXZhbDsKICAgICAgICAgICAgICAgIC8vIHRoaXMubG9jYXRpb25Mb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIC8vIGxldCB0aGF0ID0gdGhpczsKICAgICAgICAgICAgICAgIC8vIGJvb2subG9jYXRpb25zLmdlbmVyYXRlKDY2NikudGhlbihmdW5jdGlvbihsb2NhdGlvbikgeyAvLyBUaGlzIHByb21pc2Ugd2lsbCB0YWtlIGEgbGl0dGxlIHdoaWxlIHRvIHJldHVybiAoQWJvdXQgMjAgc2Vjb25kcyBvciBzbyBmb3IgTW9ieSBEaWNrKQogICAgICAgICAgICAgICAgLy8gICAgIHRoYXQubG9jYXRpb25Mb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAvLyAgICAgdGhhdC5wYWdlVGV4dCA9ICh0aGF0LmJlZ2luQmFzZVBhZ2UgKyB0aGF0LmN1cnJlbnRQYWdlKSArICIvIiArIGJvb2subG9jYXRpb25zLnRvdGFsOwogICAgICAgICAgICAgICAgLy8gfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAKCiAgICAgICAgfSwKCiAgICAgICAgb25CYWNrSW1hZ2VDaGFuZ2UodmFsKXsKICAgICAgICAgICAgdmFyIGlmcmFtZURvYyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpZnJhbWUiKVswXS5jb250ZW50V2luZG93LmRvY3VtZW50OwogICAgICAgICAgICB2YXIgIGJkb3kgPSBpZnJhbWVEb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXTsKICAgICAgICAgICAgYmRveS5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2U9dmFsOwogICAgICAgICAgICB0aGlzLnJlYWRlclN0eWxlLmJhY2tJbWFnZT12YWw7CiAgICAgICAgfSwKCiAgICAgICAgY2hhbmdlQmFja0ltYWdlKHZhbHVlKXsKICAgICAgICAgICAgaWYodmFsdWUuYmFja0ltYWdlc3JjKQogICAgICAgICAgICAgICAgdGhpcy5iYWNrSW1hZ2U9InVybCgnIit0aGlzLnB1YmxpY1BhdGgrdmFsdWUuYmFja0ltYWdlc3JjKyInKSI7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRoaXMuYmFja0ltYWdlPSIiOwogICAgICAgIH0sCiAgICAgICAgdXBkYXRlU3R5bGUoKXsKICAgICAgICAgICAgdGhpcy5vbkxpZ2h0Q2hhbmdlKHRoaXMucmVhZGVyU3R5bGUubGlnaHQpOwogICAgICAgICAgICB0aGlzLm9uQmFja0ltYWdlQ2hhbmdlKHRoaXMucmVhZGVyU3R5bGUuYmFja0ltYWdlKTsKICAgICAgICAgICAgdGhpcy5vbkZvbnRTaXplQ2hhbmdlKHRoaXMucmVhZGVyU3R5bGUuZm9udFNpemUpOwogICAgICAgIH0sCiAgICAgICAgY2hhbmdlQ2hhcHRlcihjaGFwdGVyKXsKICAgICAgICAgICAgY29uc29sZS5sb2coImNoYW5nZUNoYXB0ZXIgYm9vayIpOwogICAgICAgICAgICB0aGlzLmNoYW5nZVR5cGU9Im1lbnUiOwogICAgICAgICAgICB0aGlzLnNob3dMZWZ0RHJhd2VyPWZhbHNlOwogICAgICAgICAgICB0aGlzLmNoYXB0ZXI9Y2hhcHRlcjsKICAgICAgICB9LAogICAgfSwKICAgIGJlZm9yZUNyZWF0ZTpmdW5jdGlvbiAoKSB7CiAgICAgICAgZG9jdW1lbnQudGl0bGUgPSAi5Zu+5Lmm6ZiF6K+7IjsKICAgICAgICB2YXIgdGhhdCA9IHRoaXM7CiAgICAgICAgdmFyIGJvb2tmaWxlID0gdGhpcy4kcm91dGUucGFyYW1zLnBhdGhNYXRjaDsKICAgICAgICB2YXIgYm9va29wdGlvbj17CgogICAgICAgIH07CgogICAgICAgIGlmKCEvLmVwdWIkLy50ZXN0KGJvb2tmaWxlKSYmYm9va2ZpbGUhPXVuZGVmaW5lZCl7CiAgICAgICAgICAgIGJvb2tvcHRpb24ub3BlbkFzPSAnZGlyZWN0b3J5JzsKICAgICAgICB9CiAgICAgICAgYm9vayA9IG5ldyBFcHViKGJvb2tmaWxlLGJvb2tvcHRpb24pOwogICAgICAgIGNvbnNvbGUubG9nKCdlUHViIGxvYWQgPSAnICArIGJvb2tmaWxlKTsKICAgICAgICBjb25zb2xlLmxvZyhib29rKTsKICAgICAgICByZW5kaXRpb24gPSBib29rLnJlbmRlclRvKCJ2aWV3ZXIiLCB7CiAgICAgICAgICAgIHdpZHRoOiAiMTAwJSIsCiAgICAgICAgICAgIC8vIHZpZXc6RXB1Yi5JbmxpbmVWaWV3CiAgICAgICAgfSk7CgogICAgICAgIGNvbnNvbGUubG9nKCdlUHViIHJlbmRlcicpOwogICAgICAgIC8vIGJvb2sucmVhZHkudGhlbihmdW5jdGlvbigpIHsKICAgICAgICAvLyAgICAgY29uc29sZS5sb2coImJvb2sgcmVhZHkiKTsKICAgICAgICAvLyB9KQoKICAgICAgICAvLyBHZW5lcmF0ZSBsb2NhdGlvbiBhbmQgcGFnaW5hdGlvbgogICAgICAgIGJvb2sucmVhZHkudGhlbihmdW5jdGlvbigpIHsKICAgICAgICAgICAgIAogICAgICAgICAgICAvLyBjb25zdCBzdG9yZWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShib29rLmtleSgpICsgJy1sb2NhdGlvbnMnKTsKICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdtZXRhZGF0YTonLCBib29rLnBhY2thZ2UubWV0YWRhdGEpOwogICAgICAgICAgICAgdGhhdC5jb3ZlcmltZyA9IGJvb2suY292ZXI7CiAgICAgICAgICAgIC8vIGlmIChzdG9yZWQpIHsKICAgICAgICAgICAgLy8gICAgIHJldHVybiBib29rLmxvY2F0aW9ucy5sb2FkKHN0b3JlZCk7CiAgICAgICAgICAgIC8vIH0gZWxzZSB7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gYm9vay5sb2NhdGlvbnMuZ2VuZXJhdGUoNzE5KTsgLy8gR2VuZXJhdGVzIENGSSBmb3IgZXZlcnkgWCBjaGFyYWN0ZXJzIChDaGFyYWN0ZXJzIHBlci9wYWdlKQogICAgICAgICAgICAvLyB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbihsb2NhdGlvbnMpIHsgLy8gVGhpcyBwcm9taXNlIHdpbGwgdGFrZSBhIGxpdHRsZSB3aGlsZSB0byByZXR1cm4gKEFib3V0IDIwIHNlY29uZHMgb3Igc28gZm9yIE1vYnkgRGljaykKICAgICAgICAgICAgLy9sb2NhbFN0b3JhZ2Uuc2V0SXRlbShib29rLmtleSgpICsgJy1sb2NhdGlvbnMnLCBib29rLmxvY2F0aW9ucy5zYXZlKCkpOwogICAgICAgICAgICBjb25zb2xlLmxvZygnbG9jYXRpb25zIGZpbmlzaGVkOicsIGJvb2subG9jYXRpb25zKTsKICAgICAgICAgICAgdGhhdC5sb2NhdGlvbkxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgLy90aGF0LmZpcnN0TG9hZGluZz1mYWxzZTsKCiAgICAgICAgICAgIGxldCBsb2NhdGlvbiA9IHZpZXdNYW5hZ2VyLmN1cnJlbnRMb2NhdGlvbigpOwogICAgICAgICAgICBjb25zb2xlLmxvZyggImN1cnJlbnRMb2NhdGlvbj0iICxsb2NhdGlvbik7CiAgICAgICAgICAgIGxldCAgcCA9IGxvY2F0aW9uWzBdLnBhZ2VzWzBdOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc29sZS5sb2coImJlZ2luQmFzZVBhZ2U9IiAsIHRoYXQuYmVnaW5CYXNlUGFnZSApOwoKICAgICAgICAgICAgdGhhdC5wYWdlVGV4dCA9IHRoYXQuYmVnaW5CYXNlUGFnZSA7CiAgICAgICAgICAgIHRoYXQucGFnZUFuaW1hdGlvbkNsYXNzID0iIjsKICAgICAgICAgICAgdGhhdC5iZWdpbkJhc2VQYWdlID0gdGhhdC5iZWdpbkJhc2VQYWdlIC0gcDsKCiAgICAgICAgfSk7CgogICAgICAgIHZhciB2aWV3TWFuYWdlcjsKCiAgICAgICAgcmVuZGl0aW9uLm9uKCJzdGFydGVkIixmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZpZXdNYW5hZ2VyID0gcmVuZGl0aW9uLm1hbmFnZXI7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJyZW5kaXRpb24gc3RhcnRlZCIpCiAgICAgICAgICAgIHZpZXdNYW5hZ2VyLm9uKCJiZWZvcmVDcmVhdGVWaWV3IixmdW5jdGlvbiAoc2VjdGlvbikgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coInZpZXdNYW5hZ2VyIGJlZm9yZUNyZWF0ZVZpZXciKTsKICAgICAgICAgICAgICAgIHRoYXQubG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgIH0pCgogICAgICAgICAgICB2aWV3TWFuYWdlci5vbigiYWZ0ZXJDcmVhdGVWaWV3IixmdW5jdGlvbiAodmlldykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coInZpZXdNYW5hZ2VyIGFmdGVyQ3JlYXRlVmlldyIpOwogICAgICAgICAgICAgICAgdmlldy5ob29rcy5jb250ZW50LnJlZ2lzdGVyKGZ1bmN0aW9uIChpZnJhbWUpIHsKICAgICAgICAgICAgICAgICAgICB0aGF0LnVwZGF0ZVN0eWxlKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coInZpZXcgdXBkYXRlU3R5bGUiKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pCgogICAgICAgIH0pCgogICAgICAgIHJlbmRpdGlvbi5vbigicmVuZGVyZWQiLCBmdW5jdGlvbihzZWN0aW9uKXsKICAgICAgICAgICAgY29uc29sZS5sb2coInJlbmRpdGlvbiByZW5kZXJlZCIgLHJlbmRpdGlvbi5jdXJyZW50TG9jYXRpb24oKSk7CiAgICAgICAgICAgIC8vIHRoYXQudXBkYXRlU3R5bGUoKTsKCgogICAgICAgICAgICAgCiAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgY29uc29sZS5sb2coImNoYXB0ZXI9IiAsIHRoYXQuY2hhcHRlciApOwogICAgICAgICAgICBjb25zb2xlLmxvZygic2VjdGlvbj0iICwgc2VjdGlvbiApOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoIXRoYXQubG9jYXRpb25Mb2FkaW5nKXsKICAgICAgICAgICAgICAgIGxldCBsb2NhdGlvbiA9IHZpZXdNYW5hZ2VyLmN1cnJlbnRMb2NhdGlvbigpOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coICJjdXJyZW50TG9jYXRpb249IiAsbG9jYXRpb24pOwogICAgICAgICAgICAgICAgbGV0ICBwID0gbG9jYXRpb25bMF0ucGFnZXNbMF07CiAgICAgICAgICAgICAgICB0aGF0LmJlZ2luQmFzZVBhZ2UgPSBib29rLmxvY2F0aW9ucy5sb2NhdGlvbkZyb21DZmkocmVuZGl0aW9uLmN1cnJlbnRMb2NhdGlvbigpLnN0YXJ0LmNmaSkgLSBwOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coImJlZ2luQmFzZVBhZ2U9IiAsIHRoYXQuYmVnaW5CYXNlUGFnZSApOwogICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9ICAKICAgICAgICAgICAgaWYgKHRoYXQuZmlyc3RMb2FkaW5nKXsKICAgICAgICAgICAgICAgIC8vbG9jYXRpb27vvIjkuLrkuobliIbpobXnmoTpobXnoIHorqHnrpfvvIkg6L+Y5Zyo6K6h566X5Lit55qE6K+d77yM56iN562J5LiA5Lya5YS/5Zyo5YWz6ZetbG9hZGluZ+mhtemdogogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKXt0aGF0LmxvYWRpbmcgPSBmYWxzZTt0aGF0LmZpcnN0TG9hZGluZz1mYWxzZX0sNDUwMCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGF0LmxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgCgogICAgICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICBsZXQgY3VycmVudCA9IGJvb2submF2aWdhdGlvbiAmJiBib29rLm5hdmlnYXRpb24uZ2V0KHNlY3Rpb24uaHJlZik7CiAgICAgICAgICAgIHRoYXQuY3VycmVudENoYXBlcklkeCA9IHNlY3Rpb24uaW5kZXg7CgogICAgICAgICAgICBpZih0aGF0LmNoYXB0ZXIuaHJlZiE9Y3VycmVudC5ocmVmKXsKICAgICAgICAgICAgICAgIHRoYXQuY2hhbmdlVHlwZT0idHVyblBhZ2UiOwogICAgICAgICAgICAgICAgdGhhdC5jaGFwdGVyPWN1cnJlbnQ7CiAgICAgICAgICAgIH0KCgogICAgICAgICAgICB2YXIgaWZyYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImlmcmFtZSIpWzBdLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQ7CiAgICAgICAgICAgIHZhciB2aWV3cG9ydCA9IGlmcmFtZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaHRtbCIpWzBdOwoKCiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmlld2VyIikuZmlyc3RFbGVtZW50Q2hpbGQ7CiAgICAgICAgICAgIHZhciBzdGFydFNjcm9sbExlZnQ7CiAgICAgICAgICAgIC8vY29uc29sZS5sb2coY29udGFpbmVyKTsKCgogICAgICAgICAgICB2YXIgcGFnZVdpZHRoID0gd2luZG93LmlubmVyV2lkdGg7IC8vIOmhtemdouWuveW6pgogICAgICAgICAgICB2YXIgbWF4V2lkdGggPSAgcGFnZVdpZHRoLzI7CiAgICAgICAgICAgIHZhciBzdGFydFgsIHN0YXJ0WTsKICAgICAgICAgICAgdmFyIGluaXRpYWxQb3MgPSAwOyAgLy8g5omL5oyH5oyJ5LiL55qE5bGP5bmV5L2N572uCiAgICAgICAgICAgIHZhciBtb3ZlTGVuZ3RoID0gMDsgIC8vIOaJi+aMh+W9k+WJjea7keWKqOeahOi3neemuwogICAgICAgICAgICB2YXIgZGlyZWN0aW9uID0gJ2xlZnQnOyAvLyDmu5HliqjnmoTmlrnlkJEKICAgICAgICAgICAgdmFyIGlzTW92ZSA9IGZhbHNlOyAvLyDmmK/lkKblj5HnlJ/lt6blj7Pmu5HliqgKICAgICAgICAgICAgdmFyIHN0YXJ0VCA9IDA7IC8vIOiusOW9leaJi+aMh+aMieS4i+WOu+eahOaXtumXtAogICAgICAgICAgICB2YXIgaXNUb3VjaEVuZCA9IHRydWU7IC8vIOagh+iusOW9k+WJjea7keWKqOaYr+WQpue7k+adnyjmiYvmjIflt7LnprvlvIDlsY/luZUpCiAgICAgICAgICAgIHZhciB0aHJvdHRsZVRpbWUgPSAwOwogICAgICAgICAgICB2YXIgbGFzdFNjcm9sbCx0b3RhbFBhZ2VzOwoKCiAgICAgICAgICAgIHRoYXQuY3VycmVudFBhZ2UgPSAwOyAKICAgICAgICAgICAgLy8gbGV0IGxvY2F0aW9uID0gdmlld01hbmFnZXIuY3VycmVudExvY2F0aW9uKCk7CiAgICAgICAgICAgIC8vIHRoYXQuY3VycmVudFBhZ2UgPSBsb2NhdGlvblswXS5wYWdlc1swXTsgCiAgICAgICAgICAgCiAgICAgICAgICAgIC8vIOaJi+aMh+aUvuWcqOWxj+W5leS4igogICAgICAgICAgICB2aWV3cG9ydC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgIHN0YXJ0U2Nyb2xsTGVmdCA9IGNvbnRhaW5lci5zY3JvbGxMZWZ0OwogICAgICAgICAgICAgICAgbGV0IGxvY2F0aW9uID0gdmlld01hbmFnZXIuY3VycmVudExvY2F0aW9uKCk7CiAgICAgICAgICAgICAgICB0b3RhbFBhZ2VzID0gbG9jYXRpb25bMF0udG90YWxQYWdlczsKICAgICAgICAgICAgICAgIC8vdGhhdC5jdXJyZW50UGFnZSA9IGxvY2F0aW9uWzBdLnBhZ2VzWzBdOyAgCgoKICAgICAgICAgICAgICAgIC8vdG91Y2hzdGFydOS4jnRvdWNoZW5k55qE5rWP6KeI5Zmo6buY6K6k6KGM5Li65LiN6IO96Zi75q2i77yMCiAgICAgICAgICAgICAgICAvLyDlpoLmnpzpmLvmraLnmoTor53liJnmtY/op4jlmajml6Dms5XorqHnrpfor6XoioLngrnlhoXnmoTngrnlh7vnrYnlhbbku5bkuovku7YKICAgICAgICAgICAgICAgIC8vZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3RvdWNoc3RhcnQnKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHN0YXJ0U2Nyb2xsTGVmdCk7CiAgICAgICAgICAgICAgICAvLyDljZXmiYvmjIfop6bmkbjmiJbogIXlpJrmiYvmjIflkIzml7bop6bmkbjvvIznpoHmraLnrKzkuozkuKrmiYvmjIflu7bov5/mk43kvZzkuovku7YKICAgICAgICAgICAgICAgIGlmIChlLnRvdWNoZXMubGVuZ3RoID09PSAxIHx8IGlzVG91Y2hFbmQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdG91Y2ggPSBlLnRvdWNoZXNbMF07CiAgICAgICAgICAgICAgICAgICAgc3RhcnRYID0gdG91Y2gucGFnZVg7CiAgICAgICAgICAgICAgICAgICAgc3RhcnRZID0gdG91Y2gucGFnZVk7CiAgICAgICAgICAgICAgICAgICAgbGFzdFNjcm9sbD0wOwogICAgICAgICAgICAgICAgICAgIHN0YXJ0VCA9ICsgbmV3IERhdGUoKTsgLy8g6K6w5b2V5omL5oyH5oyJ5LiL55qE5byA5aeL5pe26Ze0CiAgICAgICAgICAgICAgICAgICAgaXNNb3ZlID0gZmFsc2U7IC8vIOaYr+WQpuS6p+eUn+a7keWKqAogICAgICAgICAgICAgICAgICAgIGlzVG91Y2hFbmQgPSBmYWxzZTsgLy8g5b2T5YmN5ruR5Yqo5byA5aeLCgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB7IHBhc3NpdmU6IGZhbHNlfSk7CgogICAgICAgICAgICAvLyDmiYvmjIflnKjlsY/luZXkuIrmu5HliqjvvIzpobXpnaLot5/pmo/miYvmjIfnp7vliqgKICAgICAgICAgICAgdmlld3BvcnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd0b3VjaG1vdmUnKTsKCiAgICAgICAgICAgICAgICAvL+eUqOS6jumikee5gea7keWKqOmYsuaKlgogICAgICAgICAgICAgICAgLy8gdmFyIG5vdyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICAgICAgICAgICAgLy8gaWYoIXRocm90dGxlVGltZSkgdGhyb3R0bGVUaW1lPW5vdzsKICAgICAgICAgICAgICAgIC8vIGlmKG5vdy10aHJvdHRsZVRpbWU8MjApIHJldHVybjsKICAgICAgICAgICAgICAgIC8vIHRocm90dGxlVGltZSA9IG5vdzsKCiAgICAgICAgICAgICAgICAvLyDlpoLmnpzlvZPliY3mu5Hliqjlt7Lnu5PmnZ/vvIzkuI3nrqHlhbbku5bmiYvmjIfmmK/lkKblnKjlsY/luZXkuIrpg73npoHmraLor6Xkuovku7YKICAgICAgICAgICAgICAgIGlmIChpc1RvdWNoRW5kKSByZXR1cm4gOwoKICAgICAgICAgICAgICAgIHZhciB0b3VjaCA9IGUudG91Y2hlc1swXTsKICAgICAgICAgICAgICAgIC8vY29udGFpbmVyIHNjcm9sbOaUueWPmOaXtnRvdWNoLnBhZ2VY5Lmf5Lya6Lef552A5Y+Y77yM5omA5Lul6ZyA6KaB5YeP5o6J5a655Zmo5rua5Yqo55qE6Led56a76I635Y+W55yf5q2j55qE5omL5oyH56e75Yqo6Led56a744CCCiAgICAgICAgICAgICAgICB2YXIgc2Nyb2xsdGVtcCA9IGNvbnRhaW5lci5zY3JvbGxMZWZ0LXN0YXJ0U2Nyb2xsTGVmdDsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJzY3JvbGx0ZW1wOiIrc2Nyb2xsdGVtcCk7CiAgICAgICAgICAgICAgICB2YXIgZGVsdGFYID0gdG91Y2gucGFnZVggLSBzdGFydFgtc2Nyb2xsdGVtcDsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJwYWdlWDoiK3RvdWNoLnBhZ2VYICwiZGVsdGFYOiIrZGVsdGFYLCJzdGFydFg6IitzdGFydFgpOwogICAgICAgICAgICAgICAgZGlyZWN0aW9uID0gZGVsdGFYID4gMCA/ICdyaWdodCcgOiAnbGVmdCc7IC8vIOWIpOaWreaJi+aMh+a7keWKqOeahOaWueWQkQoKICAgICAgICAgICAgICAgIC8vIGlmKHRoYXQuY2hhcHRlci5ocmVmPT10aGF0LnRvY1swXS5ocmVmJiZkaXJlY3Rpb249PSdyaWdodCcmJmN1cnJlbnRQYWdlPT0xKSByZXR1cm47CgogICAgICAgICAgICAgICAgaXNNb3ZlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIG1vdmVMZW5ndGggPSBkZWx0YVg7CgogICAgICAgICAgICAgICAgc2Nyb2xsUGFnZS5jYWxsKHZpZXdwb3J0LCBtb3ZlTGVuZ3RoLGUpOwoKICAgICAgICAgICAgICAgIC8v5aaC5p6c5ruR5Yqo6Led56a76LaF6L+H5pyA5aSn6Led56a75YiZ57+76aG1CiAgICAgICAgICAgICAgICBpZihNYXRoLmFicyhtb3ZlTGVuZ3RoKT49bWF4V2lkdGgpewogICAgICAgICAgICAgICAgICAgIHRocm90dGxlVGltZSA9IDA7CiAgICAgICAgICAgICAgICAgICAgdHVyblBhZ2UuY2FsbCh2aWV3cG9ydCxtb3ZlTGVuZ3RoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0sIHsgcGFzc2l2ZTogZmFsc2V9KTsKCgoKCiAgICAgICAgICAgIC8vIOaJi+aMh+emu+W8gOWxj+W5leaXtu+8jOiuoeeul+acgOe7iOmcgOimgeWBnOeVmeWcqOWTquS4gOmhtQogICAgICAgICAgICB2aWV3cG9ydC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygndG91Y2hlbmQnKTsKCiAgICAgICAgICAgICAgICBpZighaXNNb3ZlKXsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlLnRhcmdldCk7CiAgICAgICAgICAgICAgICAgICAgaXNUb3VjaEVuZD10cnVlOwogICAgICAgICAgICAgICAgICAgIGlmKGUudGFyZ2V0LnRhZ05hbWU9PSJBInx8ZS50YXJnZXQucGFyZW50Tm9kZS50YWdOYW1lPT0iQSIpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgdGhhdC5wb3B1cFNob3c9dHJ1ZTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgoKICAgICAgICAgICAgICAgIHRocm90dGxlVGltZSA9IDA7CiAgICAgICAgICAgICAgICB2YXIgdHJhbnNsYXRlID0gMDsKICAgICAgICAgICAgICAgIC8vIOiuoeeul+aJi+aMh+WcqOWxj+W5leS4iuWBnOeVmeeahOaXtumXtAogICAgICAgICAgICAgICAgdmFyIGRlbHRhVCA9ICsgbmV3IERhdGUoKSAtIHN0YXJ0VDsKICAgICAgICAgICAgICAgIC8vIOWPkeeUn+S6hua7keWKqO+8jOW5tuS4lOW9k+WJjea7keWKqOS6i+S7tuacque7k+adnwogICAgICAgICAgICAgICAgaWYgKGlzTW92ZSAmJiAhaXNUb3VjaEVuZCkgewogICAgICAgICAgICAgICAgICAgIGlzVG91Y2hFbmQgPSB0cnVlOyAvLyDmoIforrDlvZPliY3lrozmlbTnmoTmu5Hliqjkuovku7blt7Lnu4/nu5PmnZ8KICAgICAgICAgICAgICAgICAgICAvLyDkvb/nlKjliqjnlLvov4fmuKHorqnpobXpnaLmu5HliqjliLDmnIDnu4jnmoTkvY3nva4KICAgICAgICAgICAgICAgICAgICBpZiAoZGVsdGFUIDwgMzAwKSB7IC8vIOWmguaenOWBnOeVmeaXtumXtOWwj+S6jjMwMG1zLOWImeiupOS4uuaYr+W/q+mAn+a7keWKqO+8jOaXoOiuuua7keWKqOi3neemu+aYr+WkmuWwke+8jOmDveWBnOeVmeWIsOS4i+S4gOmhtQoKICAgICAgICAgICAgICAgICAgICAgICAgdHVyblBhZ2UuY2FsbCh2aWV3cG9ydCxtb3ZlTGVuZ3RoKTsKCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8g5aaC5p6c5ruR5Yqo6Led56a75bCP5LqO5bGP5bmV55qENTAl77yM5YiZ6YCA5Zue5Yiw5LiK5LiA6aG1CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhtb3ZlTGVuZ3RoKSA8IG1heFdpZHRoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDmiafooYzmu5HliqjvvIzorqnpobXpnaLmgaLlpI0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbFBhZ2UuY2FsbCh2aWV3cG9ydCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1RvdWNoRW5kID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDlpoLmnpzmu5Hliqjot53nprvlpKfkuo7lsY/luZXnmoQ1MCXvvIzliJnnv7vpobUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR1cm5QYWdlLmNhbGwodmlld3BvcnQsbW92ZUxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfSwgeyBwYXNzaXZlOiBmYWxzZSB9KTsKCgogICAgICAgICAgICBmdW5jdGlvbiB0dXJuUGFnZShtb3ZlTGVuZ3RoKXsKICAgICAgICAgICAgICAgIGlzVG91Y2hFbmQgPSB0cnVlOwoKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGNvbnRhaW5lci5zY3JvbGxMZWZ0KTsKICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUud2Via2l0VHJhbnNmb3JtID0gJ3RyYW5zbGF0ZTNkKDAsIDAsIDApJzsKCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygibW92ZUxlbmd0aDoiK21vdmVMZW5ndGgpOwogICAgICAgICAgICAgICAgaWYoZGlyZWN0aW9uPT09ImxlZnQiKXsKICAgICAgICAgICAgICAgICAgICBpZiAoYm9vay5wYWNrYWdlLm1ldGFkYXRhLmRpcmVjdGlvbiA9PT0gInJ0bCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGl0aW9uLnByZXYobW92ZUxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vdGhhdC5jdXJyZW50UGFnZS0tOwogICAgICAgICAgICAgICAgICAgIH0gICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGl0aW9uLm5leHQobW92ZUxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vdGhhdC5jdXJyZW50UGFnZSsrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgIGlmICh0aGF0LmN1cnJlbnRQYWdlPT0xICYmIGJvb2sucGFja2FnZS5tZXRhZGF0YS5kaXJlY3Rpb24gIT0gInJ0bCIgJiYgIHRoYXQuY3VycmVudENoYXBlcklkeDw9MiAgKSByZXR1cm47IC8v56ys5LiA6aG156aB5q2i57un57ut5ZCR5YmNCiAgICAgICAgICAgICAgICAgICAgaWYgKGJvb2sucGFja2FnZS5tZXRhZGF0YS5kaXJlY3Rpb24gPT09ICJydGwiICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGl0aW9uLm5leHQobW92ZUxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3RoYXQuY3VycmVudFBhZ2UrKzsKICAgICAgICAgICAgICAgICAgICAgICAgfSAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbmRpdGlvbi5wcmV2KG1vdmVMZW5ndGgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy90aGF0LmN1cnJlbnRQYWdlLS07CiAgICAgICAgICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCgoKICAgICAgICAgICAgLy8g6aG16Z2i5bmz56e7CiAgICAgICAgICAgIGZ1bmN0aW9uIHNjcm9sbFBhZ2UodHJhbnNsYXRlLHR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCJ0b3RhbFBhZ2VzOiIrdG90YWxQYWdlcywiY3VycmVudFBhZ2U6Iit0aGF0LmN1cnJlbnRQYWdlKQogICAgICAgICAgICAgICAgICAgIGlmKHRoYXQuY3VycmVudFBhZ2U9PTEmJmRpcmVjdGlvbj09PSJyaWdodCJ8fHRoYXQuY3VycmVudFBhZ2U9PXRvdGFsUGFnZXMmJmRpcmVjdGlvbj09PSJsZWZ0Iil7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUud2Via2l0VHJhbnNmb3JtID0gJ3RyYW5zbGF0ZTNkKCcgKyB0cmFuc2xhdGUgKyAncHgsIDAsIDApJzsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIndlYmtpdFRyYW5zZm9ybSIpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLnNjcm9sbExlZnQ9c3RhcnRTY3JvbGxMZWZ0LXRyYW5zbGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coInNjcm9sbExlZnQiKTsKICAgICAgICAgICAgICAgICAgICB9CgoKICAgICAgICAgICAgfQoKCiAgICAgICAgfSk7CgogICAgICAgIHJlbmRpdGlvbi5vbigicmVsb2NhdGVkIiwgZnVuY3Rpb24obG9jYXRpb25zKXsKICAgICAgICAgICAgLy9jb25zb2xlLmxvZygicmVsb2NhdGVkIGxvY2F0aW9uIixsb2NhdGlvbnMpOwogICAgICAgICAgICAvLyBXaGVuIG5hdmlnYXRpbmcgdG8gdGhlIG5leHQvcHJldmlvdXMgcGFnZQogICAgICAgICAgICAvL2xldCBwcm9ncmVzcyA9IGJvb2subG9jYXRpb25zLnBlcmNlbnRhZ2VGcm9tQ2ZpKGxvY2F0aW9ucy5zdGFydC5jZmkpOwogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnUHJvZ3Jlc3M6JywgcHJvZ3Jlc3MpOyAvLyBUaGUgJSBvZiBob3cgZmFyIGFsb25nIGluIHRoZSBib29rIHlvdSBhcmUKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ0N1cnJlbnQgUGFnZTonLGJvb2subG9jYXRpb25zLmxvY2F0aW9uRnJvbUNmaShsb2NhdGlvbnMuc3RhcnQuY2ZpKSk7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdUb3RhbCBQYWdlczonLGJvb2subG9jYXRpb25zLnRvdGFsKTsKCiAgICAgICAgICAgIHRoYXQucGFnZUFuaW1hdGlvbkNsYXNzID0iZmFkZW91dCI7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZWxvY2F0ZWQgZXZlbnQgOiBsb2NhdGlvbnMgOicsIGJvb2subG9jYXRpb25zKTsKCgogICAgICAgICAgICBzZXRUaW1lb3V0KAogICAgICAgICAgICAgICAgZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGxvY2F0aW9uID0gdmlld01hbmFnZXIuY3VycmVudExvY2F0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuY3VycmVudFBhZ2UgPSBsb2NhdGlvblswXS5wYWdlc1swXTsgIAogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiY3VycmVudFBhZ2UiLHRoYXQuY3VycmVudFBhZ2UpOwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgdG90YWwgPSBib29rLmxvY2F0aW9ucy50b3RhbDsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGF0LmxvY2F0aW9uTG9hZGluZyAgJiYgIHRvdGFsIDwgNzAgKSB7IC8v5Yqg6L295Lit77yM5LiU5Yia5byA5aeL5Yqg6L2955qE5pe25YCZ77yM5aaC5p6c5Lyw566X5bey57uP5aSn5LqONzDpobXkuobvvIzkuZ/lsJ3or5XkuIDkuIsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQucGFnZVRleHQgPSIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5wYWdlUHJvY2VzcyA9ICAwIDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQucGFnZUFuaW1hdGlvbkNsYXNzID0iIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CgoKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHByb2dyZXNzID0gYm9vay5sb2NhdGlvbnMucGVyY2VudGFnZUZyb21DZmkobG9jYXRpb25zLnN0YXJ0LmNmaSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQucGFnZVByb2Nlc3MgPSAgcGFyc2VJbnQocHJvZ3Jlc3MgKjEwMCkgOwogICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAodG90YWw8ICB0aGF0LmJlZ2luQmFzZVBhZ2UgICtsb2NhdGlvblswXS50b3RhbFBhZ2VzKSB0b3RhbCA9IHRoYXQuYmVnaW5CYXNlUGFnZSArIGxvY2F0aW9uWzBdLnRvdGFsUGFnZXM7IAoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gbGV0IHNob3dwYWdlID0gdGhhdC5iZWdpbkJhc2VQYWdlICsgdGhhdC5jdXJyZW50UGFnZTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gbGV0IGNhbHBhZ2UgPSBib29rLmxvY2F0aW9ucy5sb2NhdGlvbkZyb21DZmkobG9jYXRpb25zLnN0YXJ0LmNmaSk7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnc2hvd3BhZ2U6Jywgc2hvd3BhZ2UpOyAgCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdjYWxwYWdlOicsIGNhbHBhZ2UpOyAKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgKGNhbHBhZ2U+dG90YWwpIHRvdGFsPWNhbHBhZ2U7CiAgICAgICAgICAgICAgICAgICAgICAgIC8v5pyJ6ZO+5o6l6Lez6L2s55qE5pe25YCZ77yM6L+Z5pivY3VycmVudFBhZ2XmmK/kuI3lr7nnmoQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgKCBNYXRoLmFicyhjYWxwYWdlIC0gc2hvd3BhZ2UpPjEgKXsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIHRoYXQuY3VycmVudFBhZ2UgPSBjYWxwYWdlIC0gc2hvd3BhZ2U7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICBzaG93cGFnZSA9IGNhbHBhZ2U7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzaG93cGFnZSA9IHRoYXQuYmVnaW5CYXNlUGFnZSArIHRoYXQuY3VycmVudFBhZ2U7CgogICAgICAgICAgICAgICAgICAgICAgICAvL2lmIChzaG93cGFnZT50b3RhbCkgc2hvd3BhZ2U9dG90YWw7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vdGhhdC5wYWdlVGV4dCA9IHNob3dwYWdlICArICAiLyIgKyB0b3RhbDsKICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5wYWdlVGV4dCA9IHNob3dwYWdlOwoKICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5wYWdlQW5pbWF0aW9uQ2xhc3MgPSIiOwogICAgICAgICAgICB9LDQwMCk7CiAgICAgICAgICAgIAoKICAgICAgICB9KTsKCiAgICAgICAgcmVuZGl0aW9uLm9uKCJsYXlvdXQiLCBmdW5jdGlvbihsYXlvdXQpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coImxheW91dCIsbGF5b3V0KTsKICAgICAgICB9KTsKCiAgICAgICAgcmVuZGl0aW9uLm9uKCJsb2NhdGlvbkNoYW5nZWQiLGZ1bmN0aW9uKG9iail7CiAgICAgICAgICAgICAgICAgICAgLy8gaW5kZXggKG51bWJlcikKICAgICAgICAgICAgICAgICAgICAvLyBocmVmIChzdHJpbmcpCiAgICAgICAgICAgICAgICAgICAgLy8gc3RhcnQgKEVwdWJDRkkpCiAgICAgICAgICAgICAgICAgICAgLy8gZW5kIChFcHViQ0ZJKQogICAgICAgICAgICAgICAgICAgIC8vIHBlcmNlbnRhZ2UgKG51bWJlcikKICAgICAgICAgICAgY29uc29sZS5sb2coImxvY2F0aW9uQ2hhbmdlZCIsb2JqKTsKCiAgICAgICAgfSk7CgogICAgICAgIGJvb2subG9hZGVkLm5hdmlnYXRpb24udGhlbihmdW5jdGlvbih0b2MpewogICAgICAgICAgICB0aGF0LmNoYXB0ZXIgPSB0b2MudG9jWzBdOwogICAgICAgICAgICB0aGF0LnRvYz10b2MudG9jOwogICAgICAgICAgICBjb25zb2xlLmxvZygibmF2aWdhdGlvbixsb2FkZWQiKQogICAgICAgIH0pOwoKICAgIH0sCiAgICBkZXN0cm95ZWQ6ZnVuY3Rpb24gKCkgewogICAgICAgIGNvbnNvbGUubG9nKCJ1bmxvYWRpbmciKTsKICAgICAgICBib29rLmRlc3Ryb3koKTsKICAgIH0KfQo="},{"version":3,"sources":["book.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8KA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;;;;;AAMA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AAOA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;;;AAGA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;;;;AAKA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;AAIA;AACA;;;AAGA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;;AAGA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"book.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div>\n      <div id=\"reader-overlay\"></div>\n    \n      <van-popup\n              v-model=\"showLeftDrawer\"\n              position=\"left\"\n              :style=\"{ width: '80%',height:'100%' }\"\n      >\n          <van-tabs type=\"card\">\n              <van-tab title=\"目录\">\n                  <bookmenu v-bind:menuList=\"toc\" v-bind:currentMenu=\"chapter\" @change=\"changeChapter\"></bookmenu>\n              </van-tab>\n          <!--    <van-tab title=\"书签\">内容 2</van-tab>\n              <van-tab title=\"笔记\">内容 3</van-tab>\n              -->\n          </van-tabs>\n\n      </van-popup>\n\n\n      <van-popup\n              v-model=\"popupShow\"\n              position=\"top\"\n              :style=\"{ height: '30%' }\"\n              class=\"reader-tool\"\n      >\n          <div>\n              <van-row class=\"tool-row\">\n                  <van-col span=\"4\">亮度</van-col>\n                  <van-col span=\"16\">\n                          <van-slider v-model=\"light\" @change=\"onLightChange\" />\n                  </van-col>\n              </van-row>\n              <van-row class=\"tool-row\">\n                  <van-col span=\"4\">字号</van-col>\n                  <van-col span=\"16\">\n                      <van-stepper v-model=\"fontSize\" @change=\"onFontSizeChange\" min=\"10\" max=\"24\" input-width=\"40px\" button-size=\"32px\" step=\"2\" disable-input/>\n                  </van-col>\n              </van-row>\n   \n          </div>\n\n\n\n      </van-popup>\n\n\n      <div v-if=\"loading\" class=\"loading-overlay\">\n        <img v-if=\"firstLoading\"  id=\"CoverImg\" :src=\"coverimg\" />\n        <div v-if=\"firstLoading\" \n        style=\"color:gray;position:absolute;bottom:12px;width:100%;text-align:center;height:20px;\">加载中...</div>\n        <van-loading color=\"#1989fa\"/>\n      </div>\n\n      \n\n      <div style=\"height: 100vh\">\n        <van-nav-bar\n                v-bind:title=\"chapter.label\"\n                left-text=\"\"\n                right-text=\"章节\"\n              \n                @click-right=\"onClickRight\"\n        ></van-nav-bar>\n      <div id=\"viewer\"></div>\n    </div>\n\n     <div id=\"page-overlay\" :class=\"pageAnimationClass\">{{ pageText }}</div> \n    <div id=\"page-overlay-bar\">\n        <div \n        id=\"page-overlay-process\"\n        :style=\"{ height:'3px', backgroundColor:'red' ,width : pageProcess + '%'}\">\n        </div>\n    </div>\n  </div>\n  \n</template>\n<style scoped>\n\n .fadeout{\n    -webkit-animation:fadeout 0.6s linear 0s normal 1 forwards;\n    animation:fadeout 0.6s linear 0s normal 1 forwards;\n }\n\n\n@-webkit-keyframes fadeout{\n    0%{opacity:1;}\n    100%{opacity:0;}\n}\n@keyframes fadeout{\n    0%{opacity:1;}\n    100%{opacity:0;}\n}\n\n\n  #page-overlay{\n      position: absolute;\n      bottom: 6px;\n      text-align:right;\n      height:12px;\n      left: 0;\n      right: 5px;\n      z-index: 1000;\n      font-size:10px;\n  }\n  #page-overlay-bar{\n      position: absolute;\n      bottom: 3px;\n      height:2px;\n      left: 0;\n      right: 0;\n      z-index: 1000;\n      background-color:gray;\n  }\n\n #CoverImg{\n      width :90%;\n      padding-top:5%;\n  }\n  .loading-overlay{\n      position: absolute;\n      top:0px;\n      bottom: 0px;\n      left: 0;\n      right: 0;\n      z-index: 10000;\n   \n    text-align:center;\n    background-color:white;\n  }\n    .tool-row{\n        /*height: 40px;*/\n        text-align: center;\n        line-height: 40px;\n    }\n    .van-popup>div{\n        padding: 10px;\n    }\n    .van-slider{\n        margin: 20px;\n    }\n    #reader-overlay{\n        position: absolute;\n        top: 0;\n        bottom: 0;\n        right: 0;\n        left: 0;\n        z-index: 10000;\n        background-color: rgba(0,0,0,0);\n        pointer-events:none;\n    }\n    .backImage{\n        display: inline-block;\n        width: 30px;\n        height: 30px;\n        border-radius: 30px;\n        margin-top: 5px;\n        border: 1px solid #DFDFDF;\n    }\n  .bg-timg4 {\n      background: url('/readerImages/css_sprites.png') -10px -10px;\n  }\n  .bg-timg3 {\n      background: url('/readerImages/css_sprites.png') -70px -10px;\n  }\n  .bg-timg1 {\n      background: url('/readerImages/css_sprites.png')  -10px -70px;\n  }\n  .bg-timg {\n      background: url('/readerImages/css_sprites.png') -70px -70px;\n  }\n</style>\n<script>\n    import { Image ,Tab, Tabs,Loading,NavBar ,CellGroup,Cell,Card,RadioGroup,Radio,Popup,Progress, Row, Col,Slider,Stepper    } from 'vant';\n    import  bookmenu from '@/components/bookmenu';\n    import Vue from 'vue';\n    import Epub from 'epubjs';\n\n\n    Vue.use(NavBar ).use(Loading ).use(Card)\n        .use(RadioGroup).use(Radio).use(CellGroup)\n        .use(Cell).use(Tabs).use(Tab).use(Popup ).use(Progress)\n        .use( Row).use( Col ).use(Slider).use(Stepper).use(Image);\n\n    var book,rendition;\n\n    export default {\n        name: 'book',\n        components:{\n            bookmenu:bookmenu\n        },\n        data(){\n            return {\n                publicPath:process.env.BASE_URL,\n                book:null,\n                beginBasePage:2,\n                pageText:\"\",\n                pageProcess:0,\n                currentPage:1,\n                currentChaperIdx:2,\n                rendition:null,\n                chapter:{},\n                changeType:\"menu\",\n                firstLoad:true,\n                loading:true,\n                popupShow:false,\n                showLeftDrawer:false,\n                light:100,\n                locationLoading:true,\n                firstLoading:true,\n                fontSize:14,\n                backImage:\"\",\n                toc:[],\n                backImageList:[\n                    {class:\"bg-timg\",backImagesrc:\"readerImages/timg_big.jpg\"},\n                    {class:\"bg-timg1\",backImagesrc:\"readerImages/timg1_big.jpg\"},\n                    {class:\"bg-timg3\",backImagesrc:\"readerImages/timg3_big.jpg\"},\n                    {class:\"bg-timg4\",backImagesrc:\"\"},\n                ],\n                readerStyle:{\n                    light:100,\n                    fontSize:14,\n                    backImage:\"\"\n                },\n                pageAnimationClass:\"\",\n                coverimg:\"\"\n            }\n        },\n        watch:{\n            toc:{\n                handler:function (oldVal,newVal) {\n                    console.log(newVal)\n                },\n                deep:true\n            },\n            chapter:function (val) {\n                if(this.changeType==\"menu\")\n                    rendition.display(val.href);\n            },\n            fontSize:function (val) {\n                this.onFontSizeChange(val);\n            },\n            light:function (val) {\n               this.onLightChange(val);\n            },\n            backImage:function (val) {\n               this.onBackImageChange(val);\n            }\n        },\n        methods:{\n            onClickLeft() {\n                window.history.back(-1);\n                // book\n            },\n            onClickRight() {\n                this.showLeftDrawer=true;\n            },\n            onLightChange(val){\n                var overlay = document.getElementById(\"reader-overlay\");\n                overlay.style.backgroundColor=\"rgba(0,0,0,\"+(0.5-val/200)+\")\";\n                this.readerStyle.light=val;\n            },\n            onFontSizeChange(val){\n                var iframeDoc = document.getElementsByTagName(\"iframe\")[0].contentWindow.document;\n                var fontSizeStyle = iframeDoc.getElementById(\"fontSize\");\n                if(!fontSizeStyle){\n                    fontSizeStyle = iframeDoc.createElement('style');\n                    fontSizeStyle.id = \"fontSize\";\n                    fontSizeStyle.type = 'text/css';\n                    fontSizeStyle.innerHTML=\"p,div{ font-size:\"+val+\"px }\";\n                    iframeDoc.getElementsByTagName('HEAD').item(0).appendChild(fontSizeStyle);\n                } else{\n                    fontSizeStyle.innerHTML=\"p,div{ font-size:\"+val+\"px }\";\n                }\n                \n\n                if (this.readerStyle.fontSize!=val){\n                    this.readerStyle.fontSize=val;\n                    // this.locationLoading = true;\n                    // let that = this;\n                    // book.locations.generate(666).then(function(location) { // This promise will take a little while to return (About 20 seconds or so for Moby Dick)\n                    //     that.locationLoading = false;\n                    //     that.pageText = (that.beginBasePage + that.currentPage) + \"/\" + book.locations.total;\n                    // });\n                }\n               \n\n            },\n\n            onBackImageChange(val){\n                var iframeDoc = document.getElementsByTagName(\"iframe\")[0].contentWindow.document;\n                var  bdoy = iframeDoc.getElementsByTagName(\"body\")[0];\n                bdoy.style.backgroundImage=val;\n                this.readerStyle.backImage=val;\n            },\n\n            changeBackImage(value){\n                if(value.backImagesrc)\n                    this.backImage=\"url('\"+this.publicPath+value.backImagesrc+\"')\";\n                else\n                    this.backImage=\"\";\n            },\n            updateStyle(){\n                this.onLightChange(this.readerStyle.light);\n                this.onBackImageChange(this.readerStyle.backImage);\n                this.onFontSizeChange(this.readerStyle.fontSize);\n            },\n            changeChapter(chapter){\n                console.log(\"changeChapter book\");\n                this.changeType=\"menu\";\n                this.showLeftDrawer=false;\n                this.chapter=chapter;\n            },\n        },\n        beforeCreate:function () {\n            document.title = \"图书阅读\";\n            var that = this;\n            var bookfile = this.$route.params.pathMatch;\n            var bookoption={\n\n            };\n\n            if(!/.epub$/.test(bookfile)&&bookfile!=undefined){\n                bookoption.openAs= 'directory';\n            }\n            book = new Epub(bookfile,bookoption);\n            console.log('ePub load = '  + bookfile);\n            console.log(book);\n            rendition = book.renderTo(\"viewer\", {\n                width: \"100%\",\n                // view:Epub.InlineView\n            });\n\n            console.log('ePub render');\n            // book.ready.then(function() {\n            //     console.log(\"book ready\");\n            // })\n\n            // Generate location and pagination\n            book.ready.then(function() {\n                 \n                // const stored = localStorage.getItem(book.key() + '-locations');\n                 console.log('metadata:', book.package.metadata);\n                 that.coverimg = book.cover;\n                // if (stored) {\n                //     return book.locations.load(stored);\n                // } else {\n                \n                return book.locations.generate(719); // Generates CFI for every X characters (Characters per/page)\n                // }\n            }).then(function(locations) { // This promise will take a little while to return (About 20 seconds or so for Moby Dick)\n                //localStorage.setItem(book.key() + '-locations', book.locations.save());\n                console.log('locations finished:', book.locations);\n                that.locationLoading = false;\n                //that.firstLoading=false;\n\n                let location = viewManager.currentLocation();\n                console.log( \"currentLocation=\" ,location);\n                let  p = location[0].pages[0];\n                \n                console.log(\"beginBasePage=\" , that.beginBasePage );\n\n                that.pageText = that.beginBasePage ;\n                that.pageAnimationClass =\"\";\n                that.beginBasePage = that.beginBasePage - p;\n\n            });\n\n            var viewManager;\n\n            rendition.on(\"started\",function () {\n                viewManager = rendition.manager;\n                console.log(\"rendition started\")\n                viewManager.on(\"beforeCreateView\",function (section) {\n                    console.log(\"viewManager beforeCreateView\");\n                    that.loading = true;\n                })\n\n                viewManager.on(\"afterCreateView\",function (view) {\n                    console.log(\"viewManager afterCreateView\");\n                    view.hooks.content.register(function (iframe) {\n                        that.updateStyle();\n                        console.log(\"view updateStyle\");\n                    })\n                })\n\n            })\n\n            rendition.on(\"rendered\", function(section){\n                console.log(\"rendition rendered\" ,rendition.currentLocation());\n                // that.updateStyle();\n\n\n                 \n             \n                \n                console.log(\"chapter=\" , that.chapter );\n                console.log(\"section=\" , section );\n\n                \n                \n                if (!that.locationLoading){\n                    let location = viewManager.currentLocation();\n                    console.log( \"currentLocation=\" ,location);\n                    let  p = location[0].pages[0];\n                    that.beginBasePage = book.locations.locationFromCfi(rendition.currentLocation().start.cfi) - p;\n                    console.log(\"beginBasePage=\" , that.beginBasePage );\n                     \n                }  \n                if (that.firstLoading){\n                    //location（为了分页的页码计算） 还在计算中的话，稍等一会儿在关闭loading页面\n                    setTimeout(function (){that.loading = false;that.firstLoading=false},4500);\n                } else {\n                    that.loading = false;\n                }\n                \n                \n\n                \n                \n                \n                let current = book.navigation && book.navigation.get(section.href);\n                that.currentChaperIdx = section.index;\n\n                if(that.chapter.href!=current.href){\n                    that.changeType=\"turnPage\";\n                    that.chapter=current;\n                }\n\n\n                var iframe = document.getElementsByTagName(\"iframe\")[0].contentWindow.document;\n                var viewport = iframe.getElementsByTagName(\"html\")[0];\n\n\n                var container = document.getElementById(\"viewer\").firstElementChild;\n                var startScrollLeft;\n                //console.log(container);\n\n\n                var pageWidth = window.innerWidth; // 页面宽度\n                var maxWidth =  pageWidth/2;\n                var startX, startY;\n                var initialPos = 0;  // 手指按下的屏幕位置\n                var moveLength = 0;  // 手指当前滑动的距离\n                var direction = 'left'; // 滑动的方向\n                var isMove = false; // 是否发生左右滑动\n                var startT = 0; // 记录手指按下去的时间\n                var isTouchEnd = true; // 标记当前滑动是否结束(手指已离开屏幕)\n                var throttleTime = 0;\n                var lastScroll,totalPages;\n\n\n                that.currentPage = 0; \n                // let location = viewManager.currentLocation();\n                // that.currentPage = location[0].pages[0]; \n               \n                // 手指放在屏幕上\n                viewport.addEventListener('touchstart', function (e) {\n                    startScrollLeft = container.scrollLeft;\n                    let location = viewManager.currentLocation();\n                    totalPages = location[0].totalPages;\n                    //that.currentPage = location[0].pages[0];  \n\n\n                    //touchstart与touchend的浏览器默认行为不能阻止，\n                    // 如果阻止的话则浏览器无法计算该节点内的点击等其他事件\n                    //e.preventDefault();\n                    console.log('touchstart');\n                    console.log(startScrollLeft);\n                    // 单手指触摸或者多手指同时触摸，禁止第二个手指延迟操作事件\n                    if (e.touches.length === 1 || isTouchEnd) {\n                        var touch = e.touches[0];\n                        startX = touch.pageX;\n                        startY = touch.pageY;\n                        lastScroll=0;\n                        startT = + new Date(); // 记录手指按下的开始时间\n                        isMove = false; // 是否产生滑动\n                        isTouchEnd = false; // 当前滑动开始\n\n                    }\n                }, { passive: false});\n\n                // 手指在屏幕上滑动，页面跟随手指移动\n                viewport.addEventListener('touchmove', function (e) {\n                    e.preventDefault();\n                    console.log('touchmove');\n\n                    //用于频繁滑动防抖\n                    // var now = new Date().getTime();\n                    // if(!throttleTime) throttleTime=now;\n                    // if(now-throttleTime<20) return;\n                    // throttleTime = now;\n\n                    // 如果当前滑动已结束，不管其他手指是否在屏幕上都禁止该事件\n                    if (isTouchEnd) return ;\n\n                    var touch = e.touches[0];\n                    //container scroll改变时touch.pageX也会跟着变，所以需要减掉容器滚动的距离获取真正的手指移动距离。\n                    var scrolltemp = container.scrollLeft-startScrollLeft;\n                    console.log(\"scrolltemp:\"+scrolltemp);\n                    var deltaX = touch.pageX - startX-scrolltemp;\n                    console.log(\"pageX:\"+touch.pageX ,\"deltaX:\"+deltaX,\"startX:\"+startX);\n                    direction = deltaX > 0 ? 'right' : 'left'; // 判断手指滑动的方向\n\n                    // if(that.chapter.href==that.toc[0].href&&direction=='right'&&currentPage==1) return;\n\n                    isMove = true;\n                    moveLength = deltaX;\n\n                    scrollPage.call(viewport, moveLength,e);\n\n                    //如果滑动距离超过最大距离则翻页\n                    if(Math.abs(moveLength)>=maxWidth){\n                        throttleTime = 0;\n                        turnPage.call(viewport,moveLength);\n                    }\n\n                }, { passive: false});\n\n\n\n\n                // 手指离开屏幕时，计算最终需要停留在哪一页\n                viewport.addEventListener('touchend', function (e) {\n                    console.log('touchend');\n\n                    if(!isMove){\n                        console.log(e.target);\n                        isTouchEnd=true;\n                        if(e.target.tagName==\"A\"||e.target.parentNode.tagName==\"A\") return;\n                        e.preventDefault();\n                        that.popupShow=true;\n                        return;\n                    }\n\n\n                    throttleTime = 0;\n                    var translate = 0;\n                    // 计算手指在屏幕上停留的时间\n                    var deltaT = + new Date() - startT;\n                    // 发生了滑动，并且当前滑动事件未结束\n                    if (isMove && !isTouchEnd) {\n                        isTouchEnd = true; // 标记当前完整的滑动事件已经结束\n                        // 使用动画过渡让页面滑动到最终的位置\n                        if (deltaT < 300) { // 如果停留时间小于300ms,则认为是快速滑动，无论滑动距离是多少，都停留到下一页\n\n                            turnPage.call(viewport,moveLength);\n\n                        } else {\n                            // 如果滑动距离小于屏幕的50%，则退回到上一页\n                            if (Math.abs(moveLength) < maxWidth) {\n                                // 执行滑动，让页面恢复\n                                scrollPage.call(viewport, 0);\n                                isTouchEnd = true;\n\n                            } else {\n                                // 如果滑动距离大于屏幕的50%，则翻页\n                                turnPage.call(viewport,moveLength);\n                            }\n                        }\n\n                    }\n\n                }, { passive: false });\n\n\n                function turnPage(moveLength){\n                    isTouchEnd = true;\n\n                    console.log(container.scrollLeft);\n                    this.style.webkitTransform = 'translate3d(0, 0, 0)';\n\n                    console.log(\"moveLength:\"+moveLength);\n                    if(direction===\"left\"){\n                        if (book.package.metadata.direction === \"rtl\") {\n                            rendition.prev(moveLength);\n                            //that.currentPage--;\n                        }   else {\n                            rendition.next(moveLength);\n                            //that.currentPage++;\n                        }\n                    }else{\n                        if (that.currentPage==1 && book.package.metadata.direction != \"rtl\" &&  that.currentChaperIdx<=2  ) return; //第一页禁止继续向前\n                        if (book.package.metadata.direction === \"rtl\" ) {\n                                rendition.next(moveLength);\n                                //that.currentPage++;\n                            }    else {\n                                rendition.prev(moveLength);\n                                //that.currentPage--;\n                            } \n                    }\n                }\n\n\n\n                // 页面平移\n                function scrollPage(translate,type) {\n                        //console.log(\"totalPages:\"+totalPages,\"currentPage:\"+that.currentPage)\n                        if(that.currentPage==1&&direction===\"right\"||that.currentPage==totalPages&&direction===\"left\"){\n                            this.style.webkitTransform = 'translate3d(' + translate + 'px, 0, 0)';\n                            console.log(\"webkitTransform\");\n                        } else{\n                            container.scrollLeft=startScrollLeft-translate;\n                            console.log(\"scrollLeft\");\n                        }\n\n\n                }\n\n\n            });\n\n            rendition.on(\"relocated\", function(locations){\n                //console.log(\"relocated location\",locations);\n                // When navigating to the next/previous page\n                //let progress = book.locations.percentageFromCfi(locations.start.cfi);\n                // console.log('Progress:', progress); // The % of how far along in the book you are\n                // console.log('Current Page:',book.locations.locationFromCfi(locations.start.cfi));\n                // console.log('Total Pages:',book.locations.total);\n\n                that.pageAnimationClass =\"fadeout\";\n                console.log('relocated event : locations :', book.locations);\n\n\n                setTimeout(\n                    function(){\n                            let location = viewManager.currentLocation();\n                            that.currentPage = location[0].pages[0];  \n                            console.log(\"currentPage\",that.currentPage);\n                            let total = book.locations.total;\n\n                            if (that.locationLoading  &&  total < 70 ) { //加载中，且刚开始加载的时候，如果估算已经大于70页了，也尝试一下\n                                that.pageText =\"\";\n                                that.pageProcess =  0 ;\n                                that.pageAnimationClass =\"\";\n                                \n                                \n\n                                return;\n                            }\n\n\n                            let progress = book.locations.percentageFromCfi(locations.start.cfi);\n                            that.pageProcess =  parseInt(progress *100) ;\n                           \n                            if (total<  that.beginBasePage  +location[0].totalPages) total = that.beginBasePage + location[0].totalPages; \n\n                            // let showpage = that.beginBasePage + that.currentPage;\n                            // let calpage = book.locations.locationFromCfi(locations.start.cfi);\n\n                            // console.log('showpage:', showpage);  \n                            // console.log('calpage:', calpage); \n\n                            //if (calpage>total) total=calpage;\n                            //有链接跳转的时候，这是currentPage是不对的\n                            // if ( Math.abs(calpage - showpage)>1 ){\n                            //     that.currentPage = calpage - showpage;\n                            //     showpage = calpage;\n                            // }\n\n                            let showpage = that.beginBasePage + that.currentPage;\n\n                            //if (showpage>total) showpage=total;\n                            //that.pageText = showpage  +  \"/\" + total;\n                            that.pageText = showpage;\n\n                            that.pageAnimationClass =\"\";\n                },400);\n                \n \n            });\n\n            rendition.on(\"layout\", function(layout) {\n                console.log(\"layout\",layout);\n            });\n\n            rendition.on(\"locationChanged\",function(obj){\n                        // index (number)\n                        // href (string)\n                        // start (EpubCFI)\n                        // end (EpubCFI)\n                        // percentage (number)\n                console.log(\"locationChanged\",obj);\n \n            });\n\n            book.loaded.navigation.then(function(toc){\n                that.chapter = toc.toc[0];\n                that.toc=toc.toc;\n                console.log(\"navigation,loaded\")\n            });\n\n        },\n        destroyed:function () {\n            console.log(\"unloading\");\n            book.destroy();\n        }\n    }\n</script>\n\n<style>\n\n.van-stepper__input[disabled] {\n    color:black;\n}\n\n</style>"]}]}