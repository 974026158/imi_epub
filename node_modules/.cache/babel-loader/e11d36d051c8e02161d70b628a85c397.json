{"remainingRequest":"/Users/zhangxinbo/Documents/epub-vue/node_modules/thread-loader/dist/cjs.js!/Users/zhangxinbo/Documents/epub-vue/node_modules/babel-loader/lib/index.js!/Users/zhangxinbo/Documents/epub-vue/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/zhangxinbo/Documents/epub-vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhangxinbo/Documents/epub-vue/src/views/book.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zhangxinbo/Documents/epub-vue/src/views/book.vue","mtime":1592918675064},{"path":"/Users/zhangxinbo/Documents/epub-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhangxinbo/Documents/epub-vue/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhangxinbo/Documents/epub-vue/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/zhangxinbo/Documents/epub-vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhangxinbo/Documents/epub-vue/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZGF0ZS50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5wYXJzZS1pbnQiOwppbXBvcnQgInZhbnQvZXMvbmF2LWJhci9zdHlsZSI7CmltcG9ydCBfTmF2QmFyIGZyb20gInZhbnQvZXMvbmF2LWJhciI7CmltcG9ydCAidmFudC9lcy9sb2FkaW5nL3N0eWxlIjsKaW1wb3J0IF9Mb2FkaW5nIGZyb20gInZhbnQvZXMvbG9hZGluZyI7CmltcG9ydCAidmFudC9lcy9jYXJkL3N0eWxlIjsKaW1wb3J0IF9DYXJkIGZyb20gInZhbnQvZXMvY2FyZCI7CmltcG9ydCAidmFudC9lcy9yYWRpby1ncm91cC9zdHlsZSI7CmltcG9ydCBfUmFkaW9Hcm91cCBmcm9tICJ2YW50L2VzL3JhZGlvLWdyb3VwIjsKaW1wb3J0ICJ2YW50L2VzL3JhZGlvL3N0eWxlIjsKaW1wb3J0IF9SYWRpbyBmcm9tICJ2YW50L2VzL3JhZGlvIjsKaW1wb3J0ICJ2YW50L2VzL2NlbGwtZ3JvdXAvc3R5bGUiOwppbXBvcnQgX0NlbGxHcm91cCBmcm9tICJ2YW50L2VzL2NlbGwtZ3JvdXAiOwppbXBvcnQgInZhbnQvZXMvY2VsbC9zdHlsZSI7CmltcG9ydCBfQ2VsbCBmcm9tICJ2YW50L2VzL2NlbGwiOwppbXBvcnQgInZhbnQvZXMvdGFicy9zdHlsZSI7CmltcG9ydCBfVGFicyBmcm9tICJ2YW50L2VzL3RhYnMiOwppbXBvcnQgInZhbnQvZXMvdGFiL3N0eWxlIjsKaW1wb3J0IF9UYWIgZnJvbSAidmFudC9lcy90YWIiOwppbXBvcnQgInZhbnQvZXMvcG9wdXAvc3R5bGUiOwppbXBvcnQgX1BvcHVwIGZyb20gInZhbnQvZXMvcG9wdXAiOwppbXBvcnQgInZhbnQvZXMvcHJvZ3Jlc3Mvc3R5bGUiOwppbXBvcnQgX1Byb2dyZXNzIGZyb20gInZhbnQvZXMvcHJvZ3Jlc3MiOwppbXBvcnQgInZhbnQvZXMvcm93L3N0eWxlIjsKaW1wb3J0IF9Sb3cgZnJvbSAidmFudC9lcy9yb3ciOwppbXBvcnQgInZhbnQvZXMvY29sL3N0eWxlIjsKaW1wb3J0IF9Db2wgZnJvbSAidmFudC9lcy9jb2wiOwppbXBvcnQgInZhbnQvZXMvc2xpZGVyL3N0eWxlIjsKaW1wb3J0IF9TbGlkZXIgZnJvbSAidmFudC9lcy9zbGlkZXIiOwppbXBvcnQgInZhbnQvZXMvc3RlcHBlci9zdHlsZSI7CmltcG9ydCBfU3RlcHBlciBmcm9tICJ2YW50L2VzL3N0ZXBwZXIiOwppbXBvcnQgInZhbnQvZXMvaW1hZ2Uvc3R5bGUiOwppbXBvcnQgX0ltYWdlIGZyb20gInZhbnQvZXMvaW1hZ2UiOwppbXBvcnQgYm9va21lbnUgZnJvbSAnQC9jb21wb25lbnRzL2Jvb2ttZW51JzsKaW1wb3J0IFZ1ZSBmcm9tICd2dWUnOwppbXBvcnQgRXB1YiBmcm9tICdlcHVianMnOwpWdWUudXNlKF9OYXZCYXIpLnVzZShfTG9hZGluZykudXNlKF9DYXJkKS51c2UoX1JhZGlvR3JvdXApLnVzZShfUmFkaW8pLnVzZShfQ2VsbEdyb3VwKS51c2UoX0NlbGwpLnVzZShfVGFicykudXNlKF9UYWIpLnVzZShfUG9wdXApLnVzZShfUHJvZ3Jlc3MpLnVzZShfUm93KS51c2UoX0NvbCkudXNlKF9TbGlkZXIpLnVzZShfU3RlcHBlcikudXNlKF9JbWFnZSk7CnZhciBib29rLCByZW5kaXRpb247CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnYm9vaycsCiAgY29tcG9uZW50czogewogICAgYm9va21lbnU6IGJvb2ttZW51CiAgfSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgcHVibGljUGF0aDogcHJvY2Vzcy5lbnYuQkFTRV9VUkwsCiAgICAgIGJvb2s6IG51bGwsCiAgICAgIGJlZ2luQmFzZVBhZ2U6IDIsCiAgICAgIHBhZ2VUZXh0OiAiIiwKICAgICAgcGFnZVByb2Nlc3M6IDAsCiAgICAgIGN1cnJlbnRQYWdlOiAxLAogICAgICBjdXJyZW50Q2hhcGVySWR4OiAyLAogICAgICByZW5kaXRpb246IG51bGwsCiAgICAgIGNoYXB0ZXI6IHt9LAogICAgICBjaGFuZ2VUeXBlOiAibWVudSIsCiAgICAgIGZpcnN0TG9hZDogdHJ1ZSwKICAgICAgbG9hZGluZzogdHJ1ZSwKICAgICAgcG9wdXBTaG93OiBmYWxzZSwKICAgICAgc2hvd0xlZnREcmF3ZXI6IGZhbHNlLAogICAgICBsaWdodDogMTAwLAogICAgICBsb2NhdGlvbkxvYWRpbmc6IHRydWUsCiAgICAgIGZpcnN0TG9hZGluZzogdHJ1ZSwKICAgICAgZm9udFNpemU6IDE0LAogICAgICBiYWNrSW1hZ2U6ICIiLAogICAgICB0b2M6IFtdLAogICAgICBiYWNrSW1hZ2VMaXN0OiBbewogICAgICAgIGNsYXNzOiAiYmctdGltZyIsCiAgICAgICAgYmFja0ltYWdlc3JjOiAicmVhZGVySW1hZ2VzL3RpbWdfYmlnLmpwZyIKICAgICAgfSwgewogICAgICAgIGNsYXNzOiAiYmctdGltZzEiLAogICAgICAgIGJhY2tJbWFnZXNyYzogInJlYWRlckltYWdlcy90aW1nMV9iaWcuanBnIgogICAgICB9LCB7CiAgICAgICAgY2xhc3M6ICJiZy10aW1nMyIsCiAgICAgICAgYmFja0ltYWdlc3JjOiAicmVhZGVySW1hZ2VzL3RpbWczX2JpZy5qcGciCiAgICAgIH0sIHsKICAgICAgICBjbGFzczogImJnLXRpbWc0IiwKICAgICAgICBiYWNrSW1hZ2VzcmM6ICIiCiAgICAgIH1dLAogICAgICByZWFkZXJTdHlsZTogewogICAgICAgIGxpZ2h0OiAxMDAsCiAgICAgICAgZm9udFNpemU6IDE0LAogICAgICAgIGJhY2tJbWFnZTogIiIKICAgICAgfSwKICAgICAgcGFnZUFuaW1hdGlvbkNsYXNzOiAiIiwKICAgICAgY292ZXJpbWc6ICIiCiAgICB9OwogIH0sCiAgd2F0Y2g6IHsKICAgIHRvYzogewogICAgICBoYW5kbGVyOiBmdW5jdGlvbiBoYW5kbGVyKG9sZFZhbCwgbmV3VmFsKSB7CiAgICAgICAgY29uc29sZS5sb2cobmV3VmFsKTsKICAgICAgfSwKICAgICAgZGVlcDogdHJ1ZQogICAgfSwKICAgIGNoYXB0ZXI6IGZ1bmN0aW9uIGNoYXB0ZXIodmFsKSB7CiAgICAgIGlmICh0aGlzLmNoYW5nZVR5cGUgPT0gIm1lbnUiKSByZW5kaXRpb24uZGlzcGxheSh2YWwuaHJlZik7CiAgICB9LAogICAgZm9udFNpemU6IGZ1bmN0aW9uIGZvbnRTaXplKHZhbCkgewogICAgICB0aGlzLm9uRm9udFNpemVDaGFuZ2UodmFsKTsKICAgIH0sCiAgICBsaWdodDogZnVuY3Rpb24gbGlnaHQodmFsKSB7CiAgICAgIHRoaXMub25MaWdodENoYW5nZSh2YWwpOwogICAgfSwKICAgIGJhY2tJbWFnZTogZnVuY3Rpb24gYmFja0ltYWdlKHZhbCkgewogICAgICB0aGlzLm9uQmFja0ltYWdlQ2hhbmdlKHZhbCk7CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBvbkNsaWNrTGVmdDogZnVuY3Rpb24gb25DbGlja0xlZnQoKSB7CiAgICAgIHdpbmRvdy5oaXN0b3J5LmJhY2soLTEpOyAvLyBib29rCiAgICB9LAogICAgb25DbGlja1JpZ2h0OiBmdW5jdGlvbiBvbkNsaWNrUmlnaHQoKSB7CiAgICAgIHRoaXMuc2hvd0xlZnREcmF3ZXIgPSB0cnVlOwogICAgfSwKICAgIG9uTGlnaHRDaGFuZ2U6IGZ1bmN0aW9uIG9uTGlnaHRDaGFuZ2UodmFsKSB7CiAgICAgIHZhciBvdmVybGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJlYWRlci1vdmVybGF5Iik7CiAgICAgIG92ZXJsYXkuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gInJnYmEoMCwwLDAsIiArICgwLjUgLSB2YWwgLyAyMDApICsgIikiOwogICAgICB0aGlzLnJlYWRlclN0eWxlLmxpZ2h0ID0gdmFsOwogICAgfSwKICAgIG9uRm9udFNpemVDaGFuZ2U6IGZ1bmN0aW9uIG9uRm9udFNpemVDaGFuZ2UodmFsKSB7CiAgICAgIHZhciBpZnJhbWVEb2MgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaWZyYW1lIilbMF0uY29udGVudFdpbmRvdy5kb2N1bWVudDsKICAgICAgdmFyIGZvbnRTaXplU3R5bGUgPSBpZnJhbWVEb2MuZ2V0RWxlbWVudEJ5SWQoImZvbnRTaXplIik7CgogICAgICBpZiAoIWZvbnRTaXplU3R5bGUpIHsKICAgICAgICBmb250U2l6ZVN0eWxlID0gaWZyYW1lRG9jLmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7CiAgICAgICAgZm9udFNpemVTdHlsZS5pZCA9ICJmb250U2l6ZSI7CiAgICAgICAgZm9udFNpemVTdHlsZS50eXBlID0gJ3RleHQvY3NzJzsKICAgICAgICBmb250U2l6ZVN0eWxlLmlubmVySFRNTCA9ICJwLGRpdnsgZm9udC1zaXplOiIgKyB2YWwgKyAicHggfSI7CiAgICAgICAgaWZyYW1lRG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdIRUFEJykuaXRlbSgwKS5hcHBlbmRDaGlsZChmb250U2l6ZVN0eWxlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmb250U2l6ZVN0eWxlLmlubmVySFRNTCA9ICJwLGRpdnsgZm9udC1zaXplOiIgKyB2YWwgKyAicHggfSI7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnJlYWRlclN0eWxlLmZvbnRTaXplICE9IHZhbCkgewogICAgICAgIHRoaXMucmVhZGVyU3R5bGUuZm9udFNpemUgPSB2YWw7IC8vIHRoaXMubG9jYXRpb25Mb2FkaW5nID0gdHJ1ZTsKICAgICAgICAvLyBsZXQgdGhhdCA9IHRoaXM7CiAgICAgICAgLy8gYm9vay5sb2NhdGlvbnMuZ2VuZXJhdGUoNjY2KS50aGVuKGZ1bmN0aW9uKGxvY2F0aW9uKSB7IC8vIFRoaXMgcHJvbWlzZSB3aWxsIHRha2UgYSBsaXR0bGUgd2hpbGUgdG8gcmV0dXJuIChBYm91dCAyMCBzZWNvbmRzIG9yIHNvIGZvciBNb2J5IERpY2spCiAgICAgICAgLy8gICAgIHRoYXQubG9jYXRpb25Mb2FkaW5nID0gZmFsc2U7CiAgICAgICAgLy8gICAgIHRoYXQucGFnZVRleHQgPSAodGhhdC5iZWdpbkJhc2VQYWdlICsgdGhhdC5jdXJyZW50UGFnZSkgKyAiLyIgKyBib29rLmxvY2F0aW9ucy50b3RhbDsKICAgICAgICAvLyB9KTsKICAgICAgfQogICAgfSwKICAgIG9uQmFja0ltYWdlQ2hhbmdlOiBmdW5jdGlvbiBvbkJhY2tJbWFnZUNoYW5nZSh2YWwpIHsKICAgICAgdmFyIGlmcmFtZURvYyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpZnJhbWUiKVswXS5jb250ZW50V2luZG93LmRvY3VtZW50OwogICAgICB2YXIgYmRveSA9IGlmcmFtZURvYy5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYm9keSIpWzBdOwogICAgICBiZG95LnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IHZhbDsKICAgICAgdGhpcy5yZWFkZXJTdHlsZS5iYWNrSW1hZ2UgPSB2YWw7CiAgICB9LAogICAgY2hhbmdlQmFja0ltYWdlOiBmdW5jdGlvbiBjaGFuZ2VCYWNrSW1hZ2UodmFsdWUpIHsKICAgICAgaWYgKHZhbHVlLmJhY2tJbWFnZXNyYykgdGhpcy5iYWNrSW1hZ2UgPSAidXJsKCciICsgdGhpcy5wdWJsaWNQYXRoICsgdmFsdWUuYmFja0ltYWdlc3JjICsgIicpIjtlbHNlIHRoaXMuYmFja0ltYWdlID0gIiI7CiAgICB9LAogICAgdXBkYXRlU3R5bGU6IGZ1bmN0aW9uIHVwZGF0ZVN0eWxlKCkgewogICAgICB0aGlzLm9uTGlnaHRDaGFuZ2UodGhpcy5yZWFkZXJTdHlsZS5saWdodCk7CiAgICAgIHRoaXMub25CYWNrSW1hZ2VDaGFuZ2UodGhpcy5yZWFkZXJTdHlsZS5iYWNrSW1hZ2UpOwogICAgICB0aGlzLm9uRm9udFNpemVDaGFuZ2UodGhpcy5yZWFkZXJTdHlsZS5mb250U2l6ZSk7CiAgICB9LAogICAgY2hhbmdlQ2hhcHRlcjogZnVuY3Rpb24gY2hhbmdlQ2hhcHRlcihjaGFwdGVyKSB7CiAgICAgIGNvbnNvbGUubG9nKCJjaGFuZ2VDaGFwdGVyIGJvb2siKTsKICAgICAgdGhpcy5jaGFuZ2VUeXBlID0gIm1lbnUiOwogICAgICB0aGlzLnNob3dMZWZ0RHJhd2VyID0gZmFsc2U7CiAgICAgIHRoaXMuY2hhcHRlciA9IGNoYXB0ZXI7CiAgICB9CiAgfSwKICBiZWZvcmVDcmVhdGU6IGZ1bmN0aW9uIGJlZm9yZUNyZWF0ZSgpIHsKICAgIGRvY3VtZW50LnRpdGxlID0gIuWbvuS5pumYheivuyI7CiAgICB2YXIgdGhhdCA9IHRoaXM7CiAgICB2YXIgYm9va2ZpbGUgPSB0aGlzLiRyb3V0ZS5wYXJhbXMucGF0aE1hdGNoOwogICAgdmFyIGJvb2tvcHRpb24gPSB7fTsKCiAgICBpZiAoIS8uZXB1YiQvLnRlc3QoYm9va2ZpbGUpICYmIGJvb2tmaWxlICE9IHVuZGVmaW5lZCkgewogICAgICBib29rb3B0aW9uLm9wZW5BcyA9ICdkaXJlY3RvcnknOwogICAgfQoKICAgIGJvb2sgPSBuZXcgRXB1Yihib29rZmlsZSwgYm9va29wdGlvbik7CiAgICBjb25zb2xlLmxvZygnZVB1YiBsb2FkID0gJyArIGJvb2tmaWxlKTsKICAgIGNvbnNvbGUubG9nKGJvb2spOwogICAgcmVuZGl0aW9uID0gYm9vay5yZW5kZXJUbygidmlld2VyIiwgewogICAgICB3aWR0aDogIjEwMCUiIC8vIHZpZXc6RXB1Yi5JbmxpbmVWaWV3CgogICAgfSk7CiAgICBjb25zb2xlLmxvZygnZVB1YiByZW5kZXInKTsgLy8gYm9vay5yZWFkeS50aGVuKGZ1bmN0aW9uKCkgewogICAgLy8gICAgIGNvbnNvbGUubG9nKCJib29rIHJlYWR5Iik7CiAgICAvLyB9KQogICAgLy8gR2VuZXJhdGUgbG9jYXRpb24gYW5kIHBhZ2luYXRpb24KCiAgICBib29rLnJlYWR5LnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAvLyBjb25zdCBzdG9yZWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShib29rLmtleSgpICsgJy1sb2NhdGlvbnMnKTsKICAgICAgY29uc29sZS5sb2coJ21ldGFkYXRhOicsIGJvb2sucGFja2FnZS5tZXRhZGF0YSk7CiAgICAgIHRoYXQuY292ZXJpbWcgPSBib29rLmNvdmVyOyAvLyBpZiAoc3RvcmVkKSB7CiAgICAgIC8vICAgICByZXR1cm4gYm9vay5sb2NhdGlvbnMubG9hZChzdG9yZWQpOwogICAgICAvLyB9IGVsc2UgewoKICAgICAgcmV0dXJuIGJvb2subG9jYXRpb25zLmdlbmVyYXRlKDcxOSk7IC8vIEdlbmVyYXRlcyBDRkkgZm9yIGV2ZXJ5IFggY2hhcmFjdGVycyAoQ2hhcmFjdGVycyBwZXIvcGFnZSkKICAgICAgLy8gfQogICAgfSkudGhlbihmdW5jdGlvbiAobG9jYXRpb25zKSB7CiAgICAgIC8vIFRoaXMgcHJvbWlzZSB3aWxsIHRha2UgYSBsaXR0bGUgd2hpbGUgdG8gcmV0dXJuIChBYm91dCAyMCBzZWNvbmRzIG9yIHNvIGZvciBNb2J5IERpY2spCiAgICAgIC8vbG9jYWxTdG9yYWdlLnNldEl0ZW0oYm9vay5rZXkoKSArICctbG9jYXRpb25zJywgYm9vay5sb2NhdGlvbnMuc2F2ZSgpKTsKICAgICAgY29uc29sZS5sb2coJ2xvY2F0aW9ucyBmaW5pc2hlZDonLCBib29rLmxvY2F0aW9ucyk7CiAgICAgIHRoYXQubG9jYXRpb25Mb2FkaW5nID0gZmFsc2U7IC8vdGhhdC5maXJzdExvYWRpbmc9ZmFsc2U7CgogICAgICB2YXIgbG9jYXRpb24gPSB2aWV3TWFuYWdlci5jdXJyZW50TG9jYXRpb24oKTsKICAgICAgY29uc29sZS5sb2coImN1cnJlbnRMb2NhdGlvbj0iLCBsb2NhdGlvbik7CiAgICAgIHZhciBwID0gbG9jYXRpb25bMF0ucGFnZXNbMF07CiAgICAgIGNvbnNvbGUubG9nKCJiZWdpbkJhc2VQYWdlPSIsIHRoYXQuYmVnaW5CYXNlUGFnZSk7CiAgICAgIHRoYXQucGFnZVRleHQgPSB0aGF0LmJlZ2luQmFzZVBhZ2U7CiAgICAgIHRoYXQucGFnZUFuaW1hdGlvbkNsYXNzID0gIiI7CiAgICAgIHRoYXQuYmVnaW5CYXNlUGFnZSA9IHRoYXQuYmVnaW5CYXNlUGFnZSAtIHA7CiAgICB9KTsKICAgIHZhciB2aWV3TWFuYWdlcjsKICAgIHJlbmRpdGlvbi5vbigic3RhcnRlZCIsIGZ1bmN0aW9uICgpIHsKICAgICAgdmlld01hbmFnZXIgPSByZW5kaXRpb24ubWFuYWdlcjsKICAgICAgY29uc29sZS5sb2coInJlbmRpdGlvbiBzdGFydGVkIik7CiAgICAgIHZpZXdNYW5hZ2VyLm9uKCJiZWZvcmVDcmVhdGVWaWV3IiwgZnVuY3Rpb24gKHNlY3Rpb24pIHsKICAgICAgICBjb25zb2xlLmxvZygidmlld01hbmFnZXIgYmVmb3JlQ3JlYXRlVmlldyIpOwogICAgICAgIHRoYXQubG9hZGluZyA9IHRydWU7CiAgICAgIH0pOwogICAgICB2aWV3TWFuYWdlci5vbigiYWZ0ZXJDcmVhdGVWaWV3IiwgZnVuY3Rpb24gKHZpZXcpIHsKICAgICAgICBjb25zb2xlLmxvZygidmlld01hbmFnZXIgYWZ0ZXJDcmVhdGVWaWV3Iik7CiAgICAgICAgdmlldy5ob29rcy5jb250ZW50LnJlZ2lzdGVyKGZ1bmN0aW9uIChpZnJhbWUpIHsKICAgICAgICAgIHRoYXQudXBkYXRlU3R5bGUoKTsKICAgICAgICAgIGNvbnNvbGUubG9nKCJ2aWV3IHVwZGF0ZVN0eWxlIik7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSk7CiAgICByZW5kaXRpb24ub24oInJlbmRlcmVkIiwgZnVuY3Rpb24gKHNlY3Rpb24pIHsKICAgICAgY29uc29sZS5sb2coInJlbmRpdGlvbiByZW5kZXJlZCIsIHJlbmRpdGlvbi5jdXJyZW50TG9jYXRpb24oKSk7IC8vIHRoYXQudXBkYXRlU3R5bGUoKTsKCiAgICAgIGNvbnNvbGUubG9nKCJjaGFwdGVyPSIsIHRoYXQuY2hhcHRlcik7CiAgICAgIGNvbnNvbGUubG9nKCJzZWN0aW9uPSIsIHNlY3Rpb24pOwoKICAgICAgaWYgKCF0aGF0LmxvY2F0aW9uTG9hZGluZykgewogICAgICAgIHZhciBsb2NhdGlvbiA9IHZpZXdNYW5hZ2VyLmN1cnJlbnRMb2NhdGlvbigpOwogICAgICAgIGNvbnNvbGUubG9nKCJjdXJyZW50TG9jYXRpb249IiwgbG9jYXRpb24pOwogICAgICAgIHZhciBwID0gbG9jYXRpb25bMF0ucGFnZXNbMF07CiAgICAgICAgdGhhdC5iZWdpbkJhc2VQYWdlID0gYm9vay5sb2NhdGlvbnMubG9jYXRpb25Gcm9tQ2ZpKHJlbmRpdGlvbi5jdXJyZW50TG9jYXRpb24oKS5zdGFydC5jZmkpIC0gcDsKICAgICAgICBjb25zb2xlLmxvZygiYmVnaW5CYXNlUGFnZT0iLCB0aGF0LmJlZ2luQmFzZVBhZ2UpOwogICAgICB9CgogICAgICBpZiAodGhhdC5maXJzdExvYWRpbmcpIHsKICAgICAgICAvL2xvY2F0aW9u77yI5Li65LqG5YiG6aG155qE6aG156CB6K6h566X77yJIOi/mOWcqOiuoeeul+S4reeahOivne+8jOeojeetieS4gOS8muWEv+WcqOWFs+mXrWxvYWRpbmfpobXpnaIKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHRoYXQubG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgdGhhdC5maXJzdExvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9LCA0NTAwKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGF0LmxvYWRpbmcgPSBmYWxzZTsKICAgICAgfQoKICAgICAgdmFyIGN1cnJlbnQgPSBib29rLm5hdmlnYXRpb24gJiYgYm9vay5uYXZpZ2F0aW9uLmdldChzZWN0aW9uLmhyZWYpOwogICAgICB0aGF0LmN1cnJlbnRDaGFwZXJJZHggPSBzZWN0aW9uLmluZGV4OwoKICAgICAgaWYgKHRoYXQuY2hhcHRlci5ocmVmICE9IGN1cnJlbnQuaHJlZikgewogICAgICAgIHRoYXQuY2hhbmdlVHlwZSA9ICJ0dXJuUGFnZSI7CiAgICAgICAgdGhhdC5jaGFwdGVyID0gY3VycmVudDsKICAgICAgfQoKICAgICAgdmFyIGlmcmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpZnJhbWUiKVswXS5jb250ZW50V2luZG93LmRvY3VtZW50OwogICAgICB2YXIgdmlld3BvcnQgPSBpZnJhbWUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImh0bWwiKVswXTsKICAgICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ2aWV3ZXIiKS5maXJzdEVsZW1lbnRDaGlsZDsKICAgICAgdmFyIHN0YXJ0U2Nyb2xsTGVmdDsgLy9jb25zb2xlLmxvZyhjb250YWluZXIpOwoKICAgICAgdmFyIHBhZ2VXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoOyAvLyDpobXpnaLlrr3luqYKCiAgICAgIHZhciBtYXhXaWR0aCA9IHBhZ2VXaWR0aCAvIDI7CiAgICAgIHZhciBzdGFydFgsIHN0YXJ0WTsKICAgICAgdmFyIGluaXRpYWxQb3MgPSAwOyAvLyDmiYvmjIfmjInkuIvnmoTlsY/luZXkvY3nva4KCiAgICAgIHZhciBtb3ZlTGVuZ3RoID0gMDsgLy8g5omL5oyH5b2T5YmN5ruR5Yqo55qE6Led56a7CgogICAgICB2YXIgZGlyZWN0aW9uID0gJ2xlZnQnOyAvLyDmu5HliqjnmoTmlrnlkJEKCiAgICAgIHZhciBpc01vdmUgPSBmYWxzZTsgLy8g5piv5ZCm5Y+R55Sf5bem5Y+z5ruR5YqoCgogICAgICB2YXIgc3RhcnRUID0gMDsgLy8g6K6w5b2V5omL5oyH5oyJ5LiL5Y6755qE5pe26Ze0CgogICAgICB2YXIgaXNUb3VjaEVuZCA9IHRydWU7IC8vIOagh+iusOW9k+WJjea7keWKqOaYr+WQpue7k+adnyjmiYvmjIflt7LnprvlvIDlsY/luZUpCgogICAgICB2YXIgdGhyb3R0bGVUaW1lID0gMDsKICAgICAgdmFyIGxhc3RTY3JvbGwsIHRvdGFsUGFnZXM7CiAgICAgIHRoYXQuY3VycmVudFBhZ2UgPSAwOyAvLyBsZXQgbG9jYXRpb24gPSB2aWV3TWFuYWdlci5jdXJyZW50TG9jYXRpb24oKTsKICAgICAgLy8gdGhhdC5jdXJyZW50UGFnZSA9IGxvY2F0aW9uWzBdLnBhZ2VzWzBdOyAKICAgICAgLy8g5omL5oyH5pS+5Zyo5bGP5bmV5LiKCgogICAgICB2aWV3cG9ydC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgZnVuY3Rpb24gKGUpIHsKICAgICAgICBzdGFydFNjcm9sbExlZnQgPSBjb250YWluZXIuc2Nyb2xsTGVmdDsKICAgICAgICB2YXIgbG9jYXRpb24gPSB2aWV3TWFuYWdlci5jdXJyZW50TG9jYXRpb24oKTsKICAgICAgICB0b3RhbFBhZ2VzID0gbG9jYXRpb25bMF0udG90YWxQYWdlczsgLy90aGF0LmN1cnJlbnRQYWdlID0gbG9jYXRpb25bMF0ucGFnZXNbMF07ICAKICAgICAgICAvL3RvdWNoc3RhcnTkuI50b3VjaGVuZOeahOa1j+iniOWZqOm7mOiupOihjOS4uuS4jeiDvemYu+atou+8jAogICAgICAgIC8vIOWmguaenOmYu+atoueahOivneWImea1j+iniOWZqOaXoOazleiuoeeul+ivpeiKgueCueWGheeahOeCueWHu+etieWFtuS7luS6i+S7tgogICAgICAgIC8vZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICBjb25zb2xlLmxvZygndG91Y2hzdGFydCcpOwogICAgICAgIGNvbnNvbGUubG9nKHN0YXJ0U2Nyb2xsTGVmdCk7IC8vIOWNleaJi+aMh+inpuaRuOaIluiAheWkmuaJi+aMh+WQjOaXtuinpuaRuO+8jOemgeatouesrOS6jOS4quaJi+aMh+W7tui/n+aTjeS9nOS6i+S7tgoKICAgICAgICBpZiAoZS50b3VjaGVzLmxlbmd0aCA9PT0gMSB8fCBpc1RvdWNoRW5kKSB7CiAgICAgICAgICB2YXIgdG91Y2ggPSBlLnRvdWNoZXNbMF07CiAgICAgICAgICBzdGFydFggPSB0b3VjaC5wYWdlWDsKICAgICAgICAgIHN0YXJ0WSA9IHRvdWNoLnBhZ2VZOwogICAgICAgICAgbGFzdFNjcm9sbCA9IDA7CiAgICAgICAgICBzdGFydFQgPSArbmV3IERhdGUoKTsgLy8g6K6w5b2V5omL5oyH5oyJ5LiL55qE5byA5aeL5pe26Ze0CgogICAgICAgICAgaXNNb3ZlID0gZmFsc2U7IC8vIOaYr+WQpuS6p+eUn+a7keWKqAoKICAgICAgICAgIGlzVG91Y2hFbmQgPSBmYWxzZTsgLy8g5b2T5YmN5ruR5Yqo5byA5aeLCiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgcGFzc2l2ZTogZmFsc2UKICAgICAgfSk7IC8vIOaJi+aMh+WcqOWxj+W5leS4iua7keWKqO+8jOmhtemdoui3n+maj+aJi+aMh+enu+WKqAoKICAgICAgdmlld3BvcnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgY29uc29sZS5sb2coJ3RvdWNobW92ZScpOyAvL+eUqOS6jumikee5gea7keWKqOmYsuaKlgogICAgICAgIC8vIHZhciBub3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgICAgICAvLyBpZighdGhyb3R0bGVUaW1lKSB0aHJvdHRsZVRpbWU9bm93OwogICAgICAgIC8vIGlmKG5vdy10aHJvdHRsZVRpbWU8MjApIHJldHVybjsKICAgICAgICAvLyB0aHJvdHRsZVRpbWUgPSBub3c7CiAgICAgICAgLy8g5aaC5p6c5b2T5YmN5ruR5Yqo5bey57uT5p2f77yM5LiN566h5YW25LuW5omL5oyH5piv5ZCm5Zyo5bGP5bmV5LiK6YO956aB5q2i6K+l5LqL5Lu2CgogICAgICAgIGlmIChpc1RvdWNoRW5kKSByZXR1cm47CiAgICAgICAgdmFyIHRvdWNoID0gZS50b3VjaGVzWzBdOyAvL2NvbnRhaW5lciBzY3JvbGzmlLnlj5jml7Z0b3VjaC5wYWdlWOS5n+S8mui3n+edgOWPmO+8jOaJgOS7pemcgOimgeWHj+aOieWuueWZqOa7muWKqOeahOi3neemu+iOt+WPluecn+ato+eahOaJi+aMh+enu+WKqOi3neemu+OAggoKICAgICAgICB2YXIgc2Nyb2xsdGVtcCA9IGNvbnRhaW5lci5zY3JvbGxMZWZ0IC0gc3RhcnRTY3JvbGxMZWZ0OwogICAgICAgIGNvbnNvbGUubG9nKCJzY3JvbGx0ZW1wOiIgKyBzY3JvbGx0ZW1wKTsKICAgICAgICB2YXIgZGVsdGFYID0gdG91Y2gucGFnZVggLSBzdGFydFggLSBzY3JvbGx0ZW1wOwogICAgICAgIGNvbnNvbGUubG9nKCJwYWdlWDoiICsgdG91Y2gucGFnZVgsICJkZWx0YVg6IiArIGRlbHRhWCwgInN0YXJ0WDoiICsgc3RhcnRYKTsKICAgICAgICBkaXJlY3Rpb24gPSBkZWx0YVggPiAwID8gJ3JpZ2h0JyA6ICdsZWZ0JzsgLy8g5Yik5pat5omL5oyH5ruR5Yqo55qE5pa55ZCRCiAgICAgICAgLy8gaWYodGhhdC5jaGFwdGVyLmhyZWY9PXRoYXQudG9jWzBdLmhyZWYmJmRpcmVjdGlvbj09J3JpZ2h0JyYmY3VycmVudFBhZ2U9PTEpIHJldHVybjsKCiAgICAgICAgaXNNb3ZlID0gdHJ1ZTsKICAgICAgICBtb3ZlTGVuZ3RoID0gZGVsdGFYOwogICAgICAgIHNjcm9sbFBhZ2UuY2FsbCh2aWV3cG9ydCwgbW92ZUxlbmd0aCwgZSk7IC8v5aaC5p6c5ruR5Yqo6Led56a76LaF6L+H5pyA5aSn6Led56a75YiZ57+76aG1CgogICAgICAgIGlmIChNYXRoLmFicyhtb3ZlTGVuZ3RoKSA+PSBtYXhXaWR0aCkgewogICAgICAgICAgdGhyb3R0bGVUaW1lID0gMDsKICAgICAgICAgIHR1cm5QYWdlLmNhbGwodmlld3BvcnQsIG1vdmVMZW5ndGgpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIHBhc3NpdmU6IGZhbHNlCiAgICAgIH0pOyAvLyDmiYvmjIfnprvlvIDlsY/luZXml7bvvIzorqHnrpfmnIDnu4jpnIDopoHlgZznlZnlnKjlk6rkuIDpobUKCiAgICAgIHZpZXdwb3J0LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICBjb25zb2xlLmxvZygndG91Y2hlbmQnKTsKCiAgICAgICAgaWYgKCFpc01vdmUpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGUudGFyZ2V0KTsKICAgICAgICAgIGlzVG91Y2hFbmQgPSB0cnVlOwogICAgICAgICAgaWYgKGUudGFyZ2V0LnRhZ05hbWUgPT0gIkEiIHx8IGUudGFyZ2V0LnBhcmVudE5vZGUudGFnTmFtZSA9PSAiQSIpIHJldHVybjsKICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgIHRoYXQucG9wdXBTaG93ID0gdHJ1ZTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHRocm90dGxlVGltZSA9IDA7CiAgICAgICAgdmFyIHRyYW5zbGF0ZSA9IDA7IC8vIOiuoeeul+aJi+aMh+WcqOWxj+W5leS4iuWBnOeVmeeahOaXtumXtAoKICAgICAgICB2YXIgZGVsdGFUID0gK25ldyBEYXRlKCkgLSBzdGFydFQ7IC8vIOWPkeeUn+S6hua7keWKqO+8jOW5tuS4lOW9k+WJjea7keWKqOS6i+S7tuacque7k+adnwoKICAgICAgICBpZiAoaXNNb3ZlICYmICFpc1RvdWNoRW5kKSB7CiAgICAgICAgICBpc1RvdWNoRW5kID0gdHJ1ZTsgLy8g5qCH6K6w5b2T5YmN5a6M5pW055qE5ruR5Yqo5LqL5Lu25bey57uP57uT5p2fCiAgICAgICAgICAvLyDkvb/nlKjliqjnlLvov4fmuKHorqnpobXpnaLmu5HliqjliLDmnIDnu4jnmoTkvY3nva4KCiAgICAgICAgICBpZiAoZGVsdGFUIDwgMzAwKSB7CiAgICAgICAgICAgIC8vIOWmguaenOWBnOeVmeaXtumXtOWwj+S6jjMwMG1zLOWImeiupOS4uuaYr+W/q+mAn+a7keWKqO+8jOaXoOiuuua7keWKqOi3neemu+aYr+WkmuWwke+8jOmDveWBnOeVmeWIsOS4i+S4gOmhtQogICAgICAgICAgICB0dXJuUGFnZS5jYWxsKHZpZXdwb3J0LCBtb3ZlTGVuZ3RoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIOWmguaenOa7keWKqOi3neemu+Wwj+S6juWxj+W5leeahDUwJe+8jOWImemAgOWbnuWIsOS4iuS4gOmhtQogICAgICAgICAgICBpZiAoTWF0aC5hYnMobW92ZUxlbmd0aCkgPCBtYXhXaWR0aCkgewogICAgICAgICAgICAgIC8vIOaJp+ihjOa7keWKqO+8jOiuqemhtemdouaBouWkjQogICAgICAgICAgICAgIHNjcm9sbFBhZ2UuY2FsbCh2aWV3cG9ydCwgMCk7CiAgICAgICAgICAgICAgaXNUb3VjaEVuZCA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8g5aaC5p6c5ruR5Yqo6Led56a75aSn5LqO5bGP5bmV55qENTAl77yM5YiZ57+76aG1CiAgICAgICAgICAgICAgdHVyblBhZ2UuY2FsbCh2aWV3cG9ydCwgbW92ZUxlbmd0aCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBwYXNzaXZlOiBmYWxzZQogICAgICB9KTsKCiAgICAgIGZ1bmN0aW9uIHR1cm5QYWdlKG1vdmVMZW5ndGgpIHsKICAgICAgICBpc1RvdWNoRW5kID0gdHJ1ZTsKICAgICAgICBjb25zb2xlLmxvZyhjb250YWluZXIuc2Nyb2xsTGVmdCk7CiAgICAgICAgdGhpcy5zdHlsZS53ZWJraXRUcmFuc2Zvcm0gPSAndHJhbnNsYXRlM2QoMCwgMCwgMCknOwogICAgICAgIGNvbnNvbGUubG9nKCJtb3ZlTGVuZ3RoOiIgKyBtb3ZlTGVuZ3RoKTsKCiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gImxlZnQiKSB7CiAgICAgICAgICBpZiAoYm9vay5wYWNrYWdlLm1ldGFkYXRhLmRpcmVjdGlvbiA9PT0gInJ0bCIpIHsKICAgICAgICAgICAgcmVuZGl0aW9uLnByZXYobW92ZUxlbmd0aCk7IC8vdGhhdC5jdXJyZW50UGFnZS0tOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVuZGl0aW9uLm5leHQobW92ZUxlbmd0aCk7IC8vdGhhdC5jdXJyZW50UGFnZSsrOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAodGhhdC5jdXJyZW50UGFnZSA9PSAxICYmIGJvb2sucGFja2FnZS5tZXRhZGF0YS5kaXJlY3Rpb24gIT0gInJ0bCIgJiYgdGhhdC5jdXJyZW50Q2hhcGVySWR4IDw9IDIpIHJldHVybjsgLy/nrKzkuIDpobXnpoHmraLnu6fnu63lkJHliY0KCiAgICAgICAgICBpZiAoYm9vay5wYWNrYWdlLm1ldGFkYXRhLmRpcmVjdGlvbiA9PT0gInJ0bCIpIHsKICAgICAgICAgICAgcmVuZGl0aW9uLm5leHQobW92ZUxlbmd0aCk7IC8vdGhhdC5jdXJyZW50UGFnZSsrOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVuZGl0aW9uLnByZXYobW92ZUxlbmd0aCk7IC8vdGhhdC5jdXJyZW50UGFnZS0tOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyDpobXpnaLlubPnp7sKCgogICAgICBmdW5jdGlvbiBzY3JvbGxQYWdlKHRyYW5zbGF0ZSwgdHlwZSkgewogICAgICAgIC8vY29uc29sZS5sb2coInRvdGFsUGFnZXM6Iit0b3RhbFBhZ2VzLCJjdXJyZW50UGFnZToiK3RoYXQuY3VycmVudFBhZ2UpCiAgICAgICAgaWYgKHRoYXQuY3VycmVudFBhZ2UgPT0gMSAmJiBkaXJlY3Rpb24gPT09ICJyaWdodCIgfHwgdGhhdC5jdXJyZW50UGFnZSA9PSB0b3RhbFBhZ2VzICYmIGRpcmVjdGlvbiA9PT0gImxlZnQiKSB7CiAgICAgICAgICB0aGlzLnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9ICd0cmFuc2xhdGUzZCgnICsgdHJhbnNsYXRlICsgJ3B4LCAwLCAwKSc7CiAgICAgICAgICBjb25zb2xlLmxvZygid2Via2l0VHJhbnNmb3JtIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnRhaW5lci5zY3JvbGxMZWZ0ID0gc3RhcnRTY3JvbGxMZWZ0IC0gdHJhbnNsYXRlOwogICAgICAgICAgY29uc29sZS5sb2coInNjcm9sbExlZnQiKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgcmVuZGl0aW9uLm9uKCJyZWxvY2F0ZWQiLCBmdW5jdGlvbiAobG9jYXRpb25zKSB7CiAgICAgIC8vY29uc29sZS5sb2coInJlbG9jYXRlZCBsb2NhdGlvbiIsbG9jYXRpb25zKTsKICAgICAgLy8gV2hlbiBuYXZpZ2F0aW5nIHRvIHRoZSBuZXh0L3ByZXZpb3VzIHBhZ2UKICAgICAgLy9sZXQgcHJvZ3Jlc3MgPSBib29rLmxvY2F0aW9ucy5wZXJjZW50YWdlRnJvbUNmaShsb2NhdGlvbnMuc3RhcnQuY2ZpKTsKICAgICAgLy8gY29uc29sZS5sb2coJ1Byb2dyZXNzOicsIHByb2dyZXNzKTsgLy8gVGhlICUgb2YgaG93IGZhciBhbG9uZyBpbiB0aGUgYm9vayB5b3UgYXJlCiAgICAgIC8vIGNvbnNvbGUubG9nKCdDdXJyZW50IFBhZ2U6Jyxib29rLmxvY2F0aW9ucy5sb2NhdGlvbkZyb21DZmkobG9jYXRpb25zLnN0YXJ0LmNmaSkpOwogICAgICAvLyBjb25zb2xlLmxvZygnVG90YWwgUGFnZXM6Jyxib29rLmxvY2F0aW9ucy50b3RhbCk7CiAgICAgIHRoYXQucGFnZUFuaW1hdGlvbkNsYXNzID0gImZhZGVvdXQiOwogICAgICBjb25zb2xlLmxvZygncmVsb2NhdGVkIGV2ZW50IDogbG9jYXRpb25zIDonLCBib29rLmxvY2F0aW9ucyk7CiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBsb2NhdGlvbiA9IHZpZXdNYW5hZ2VyLmN1cnJlbnRMb2NhdGlvbigpOwogICAgICAgIHRoYXQuY3VycmVudFBhZ2UgPSBsb2NhdGlvblswXS5wYWdlc1swXTsKICAgICAgICBjb25zb2xlLmxvZygiY3VycmVudFBhZ2UiLCB0aGF0LmN1cnJlbnRQYWdlKTsKICAgICAgICB2YXIgdG90YWwgPSBib29rLmxvY2F0aW9ucy50b3RhbDsKCiAgICAgICAgaWYgKHRoYXQubG9jYXRpb25Mb2FkaW5nICYmIHRvdGFsIDwgNzApIHsKICAgICAgICAgIC8v5Yqg6L295Lit77yM5LiU5Yia5byA5aeL5Yqg6L2955qE5pe25YCZ77yM5aaC5p6c5Lyw566X5bey57uP5aSn5LqONzDpobXkuobvvIzkuZ/lsJ3or5XkuIDkuIsKICAgICAgICAgIHRoYXQucGFnZVRleHQgPSAiIjsKICAgICAgICAgIHRoYXQucGFnZVByb2Nlc3MgPSAwOwogICAgICAgICAgdGhhdC5wYWdlQW5pbWF0aW9uQ2xhc3MgPSAiIjsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBwcm9ncmVzcyA9IGJvb2subG9jYXRpb25zLnBlcmNlbnRhZ2VGcm9tQ2ZpKGxvY2F0aW9ucy5zdGFydC5jZmkpOwogICAgICAgIHRoYXQucGFnZVByb2Nlc3MgPSBwYXJzZUludChwcm9ncmVzcyAqIDEwMCk7CiAgICAgICAgaWYgKHRvdGFsIDwgdGhhdC5iZWdpbkJhc2VQYWdlICsgbG9jYXRpb25bMF0udG90YWxQYWdlcykgdG90YWwgPSB0aGF0LmJlZ2luQmFzZVBhZ2UgKyBsb2NhdGlvblswXS50b3RhbFBhZ2VzOyAvLyBsZXQgc2hvd3BhZ2UgPSB0aGF0LmJlZ2luQmFzZVBhZ2UgKyB0aGF0LmN1cnJlbnRQYWdlOwogICAgICAgIC8vIGxldCBjYWxwYWdlID0gYm9vay5sb2NhdGlvbnMubG9jYXRpb25Gcm9tQ2ZpKGxvY2F0aW9ucy5zdGFydC5jZmkpOwogICAgICAgIC8vIGNvbnNvbGUubG9nKCdzaG93cGFnZTonLCBzaG93cGFnZSk7ICAKICAgICAgICAvLyBjb25zb2xlLmxvZygnY2FscGFnZTonLCBjYWxwYWdlKTsgCiAgICAgICAgLy9pZiAoY2FscGFnZT50b3RhbCkgdG90YWw9Y2FscGFnZTsKICAgICAgICAvL+aciemTvuaOpei3s+i9rOeahOaXtuWAme+8jOi/meaYr2N1cnJlbnRQYWdl5piv5LiN5a+555qECiAgICAgICAgLy8gaWYgKCBNYXRoLmFicyhjYWxwYWdlIC0gc2hvd3BhZ2UpPjEgKXsKICAgICAgICAvLyAgICAgdGhhdC5jdXJyZW50UGFnZSA9IGNhbHBhZ2UgLSBzaG93cGFnZTsKICAgICAgICAvLyAgICAgc2hvd3BhZ2UgPSBjYWxwYWdlOwogICAgICAgIC8vIH0KCiAgICAgICAgdmFyIHNob3dwYWdlID0gdGhhdC5iZWdpbkJhc2VQYWdlICsgdGhhdC5jdXJyZW50UGFnZTsgLy9pZiAoc2hvd3BhZ2U+dG90YWwpIHNob3dwYWdlPXRvdGFsOwogICAgICAgIC8vdGhhdC5wYWdlVGV4dCA9IHNob3dwYWdlICArICAiLyIgKyB0b3RhbDsKCiAgICAgICAgdGhhdC5wYWdlVGV4dCA9IHNob3dwYWdlOwogICAgICAgIHRoYXQucGFnZUFuaW1hdGlvbkNsYXNzID0gIiI7CiAgICAgIH0sIDQwMCk7CiAgICB9KTsKICAgIHJlbmRpdGlvbi5vbigibGF5b3V0IiwgZnVuY3Rpb24gKGxheW91dCkgewogICAgICBjb25zb2xlLmxvZygibGF5b3V0IiwgbGF5b3V0KTsKICAgIH0pOwogICAgcmVuZGl0aW9uLm9uKCJsb2NhdGlvbkNoYW5nZWQiLCBmdW5jdGlvbiAob2JqKSB7CiAgICAgIC8vIGluZGV4IChudW1iZXIpCiAgICAgIC8vIGhyZWYgKHN0cmluZykKICAgICAgLy8gc3RhcnQgKEVwdWJDRkkpCiAgICAgIC8vIGVuZCAoRXB1YkNGSSkKICAgICAgLy8gcGVyY2VudGFnZSAobnVtYmVyKQogICAgICBjb25zb2xlLmxvZygibG9jYXRpb25DaGFuZ2VkIiwgb2JqKTsKICAgIH0pOwogICAgYm9vay5sb2FkZWQubmF2aWdhdGlvbi50aGVuKGZ1bmN0aW9uICh0b2MpIHsKICAgICAgdGhhdC5jaGFwdGVyID0gdG9jLnRvY1swXTsKICAgICAgdGhhdC50b2MgPSB0b2MudG9jOwogICAgICBjb25zb2xlLmxvZygibmF2aWdhdGlvbixsb2FkZWQiKTsKICAgIH0pOwogIH0sCiAgZGVzdHJveWVkOiBmdW5jdGlvbiBkZXN0cm95ZWQoKSB7CiAgICBjb25zb2xlLmxvZygidW5sb2FkaW5nIik7CiAgICBib29rLmRlc3Ryb3koKTsKICB9Cn07"},{"version":3,"sources":["book.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div>\n      <div id=\"reader-overlay\"></div>\n    \n      <van-popup\n              v-model=\"showLeftDrawer\"\n              position=\"left\"\n              :style=\"{ width: '80%',height:'100%' }\"\n      >\n          <van-tabs type=\"card\">\n              <van-tab title=\"目录\">\n                  <bookmenu v-bind:menuList=\"toc\" v-bind:currentMenu=\"chapter\" @change=\"changeChapter\"></bookmenu>\n              </van-tab>\n          <!--    <van-tab title=\"书签\">内容 2</van-tab>\n              <van-tab title=\"笔记\">内容 3</van-tab>\n              -->\n          </van-tabs>\n\n      </van-popup>\n\n\n      <van-popup\n              v-model=\"popupShow\"\n              position=\"top\"\n              :style=\"{ height: '30%' }\"\n              class=\"reader-tool\"\n      >\n          <div>\n              <van-row class=\"tool-row\">\n                  <van-col span=\"4\">亮度</van-col>\n                  <van-col span=\"16\">\n                          <van-slider v-model=\"light\" @change=\"onLightChange\" />\n                  </van-col>\n              </van-row>\n              <van-row class=\"tool-row\">\n                  <van-col span=\"4\">字号</van-col>\n                  <van-col span=\"16\">\n                      <van-stepper v-model=\"fontSize\" @change=\"onFontSizeChange\" min=\"10\" max=\"24\" input-width=\"40px\" button-size=\"32px\" step=\"2\" disable-input/>\n                  </van-col>\n              </van-row>\n   \n          </div>\n\n\n\n      </van-popup>\n\n\n      <div v-if=\"loading\" class=\"loading-overlay\">\n        <img v-if=\"firstLoading\"  id=\"CoverImg\" :src=\"coverimg\" />\n        <div v-if=\"firstLoading\" \n        style=\"color:gray;position:absolute;bottom:12px;width:100%;text-align:center;height:20px;\">加载中...</div>\n        <van-loading color=\"#1989fa\"/>\n      </div>\n\n      \n\n      <div style=\"height: 100vh\">\n        <van-nav-bar\n                v-bind:title=\"chapter.label\"\n                left-text=\"\"\n                right-text=\"章节\"\n              \n                @click-right=\"onClickRight\"\n        ></van-nav-bar>\n      <div id=\"viewer\"></div>\n    </div>\n\n     <div id=\"page-overlay\" :class=\"pageAnimationClass\">{{ pageText }}</div> \n    <div id=\"page-overlay-bar\">\n        <div \n        id=\"page-overlay-process\"\n        :style=\"{ height:'3px', backgroundColor:'red' ,width : pageProcess + '%'}\">\n        </div>\n    </div>\n  </div>\n  \n</template>\n<style scoped>\n\n .fadeout{\n    -webkit-animation:fadeout 0.6s linear 0s normal 1 forwards;\n    animation:fadeout 0.6s linear 0s normal 1 forwards;\n }\n\n\n@-webkit-keyframes fadeout{\n    0%{opacity:1;}\n    100%{opacity:0;}\n}\n@keyframes fadeout{\n    0%{opacity:1;}\n    100%{opacity:0;}\n}\n\n\n  #page-overlay{\n      position: absolute;\n      bottom: 6px;\n      text-align:right;\n      height:12px;\n      left: 0;\n      right: 5px;\n      z-index: 1000;\n      font-size:10px;\n  }\n  #page-overlay-bar{\n      position: absolute;\n      bottom: 3px;\n      height:2px;\n      left: 0;\n      right: 0;\n      z-index: 1000;\n      background-color:gray;\n  }\n\n #CoverImg{\n      width :90%;\n      padding-top:5%;\n  }\n  .loading-overlay{\n      position: absolute;\n      top:0px;\n      bottom: 0px;\n      left: 0;\n      right: 0;\n      z-index: 10000;\n   \n    text-align:center;\n    background-color:white;\n  }\n    .tool-row{\n        /*height: 40px;*/\n        text-align: center;\n        line-height: 40px;\n    }\n    .van-popup>div{\n        padding: 10px;\n    }\n    .van-slider{\n        margin: 20px;\n    }\n    #reader-overlay{\n        position: absolute;\n        top: 0;\n        bottom: 0;\n        right: 0;\n        left: 0;\n        z-index: 10000;\n        background-color: rgba(0,0,0,0);\n        pointer-events:none;\n    }\n    .backImage{\n        display: inline-block;\n        width: 30px;\n        height: 30px;\n        border-radius: 30px;\n        margin-top: 5px;\n        border: 1px solid #DFDFDF;\n    }\n  .bg-timg4 {\n      background: url('/readerImages/css_sprites.png') -10px -10px;\n  }\n  .bg-timg3 {\n      background: url('/readerImages/css_sprites.png') -70px -10px;\n  }\n  .bg-timg1 {\n      background: url('/readerImages/css_sprites.png')  -10px -70px;\n  }\n  .bg-timg {\n      background: url('/readerImages/css_sprites.png') -70px -70px;\n  }\n</style>\n<script>\n    import { Image ,Tab, Tabs,Loading,NavBar ,CellGroup,Cell,Card,RadioGroup,Radio,Popup,Progress, Row, Col,Slider,Stepper    } from 'vant';\n    import  bookmenu from '@/components/bookmenu';\n    import Vue from 'vue';\n    import Epub from 'epubjs';\n\n\n    Vue.use(NavBar ).use(Loading ).use(Card)\n        .use(RadioGroup).use(Radio).use(CellGroup)\n        .use(Cell).use(Tabs).use(Tab).use(Popup ).use(Progress)\n        .use( Row).use( Col ).use(Slider).use(Stepper).use(Image);\n\n    var book,rendition;\n\n    export default {\n        name: 'book',\n        components:{\n            bookmenu:bookmenu\n        },\n        data(){\n            return {\n                publicPath:process.env.BASE_URL,\n                book:null,\n                beginBasePage:2,\n                pageText:\"\",\n                pageProcess:0,\n                currentPage:1,\n                currentChaperIdx:2,\n                rendition:null,\n                chapter:{},\n                changeType:\"menu\",\n                firstLoad:true,\n                loading:true,\n                popupShow:false,\n                showLeftDrawer:false,\n                light:100,\n                locationLoading:true,\n                firstLoading:true,\n                fontSize:14,\n                backImage:\"\",\n                toc:[],\n                backImageList:[\n                    {class:\"bg-timg\",backImagesrc:\"readerImages/timg_big.jpg\"},\n                    {class:\"bg-timg1\",backImagesrc:\"readerImages/timg1_big.jpg\"},\n                    {class:\"bg-timg3\",backImagesrc:\"readerImages/timg3_big.jpg\"},\n                    {class:\"bg-timg4\",backImagesrc:\"\"},\n                ],\n                readerStyle:{\n                    light:100,\n                    fontSize:14,\n                    backImage:\"\"\n                },\n                pageAnimationClass:\"\",\n                coverimg:\"\"\n            }\n        },\n        watch:{\n            toc:{\n                handler:function (oldVal,newVal) {\n                    console.log(newVal)\n                },\n                deep:true\n            },\n            chapter:function (val) {\n                if(this.changeType==\"menu\")\n                    rendition.display(val.href);\n            },\n            fontSize:function (val) {\n                this.onFontSizeChange(val);\n            },\n            light:function (val) {\n               this.onLightChange(val);\n            },\n            backImage:function (val) {\n               this.onBackImageChange(val);\n            }\n        },\n        methods:{\n            onClickLeft() {\n                window.history.back(-1);\n                // book\n            },\n            onClickRight() {\n                this.showLeftDrawer=true;\n            },\n            onLightChange(val){\n                var overlay = document.getElementById(\"reader-overlay\");\n                overlay.style.backgroundColor=\"rgba(0,0,0,\"+(0.5-val/200)+\")\";\n                this.readerStyle.light=val;\n            },\n            onFontSizeChange(val){\n                var iframeDoc = document.getElementsByTagName(\"iframe\")[0].contentWindow.document;\n                var fontSizeStyle = iframeDoc.getElementById(\"fontSize\");\n                if(!fontSizeStyle){\n                    fontSizeStyle = iframeDoc.createElement('style');\n                    fontSizeStyle.id = \"fontSize\";\n                    fontSizeStyle.type = 'text/css';\n                    fontSizeStyle.innerHTML=\"p,div{ font-size:\"+val+\"px }\";\n                    iframeDoc.getElementsByTagName('HEAD').item(0).appendChild(fontSizeStyle);\n                } else{\n                    fontSizeStyle.innerHTML=\"p,div{ font-size:\"+val+\"px }\";\n                }\n                \n\n                if (this.readerStyle.fontSize!=val){\n                    this.readerStyle.fontSize=val;\n                    // this.locationLoading = true;\n                    // let that = this;\n                    // book.locations.generate(666).then(function(location) { // This promise will take a little while to return (About 20 seconds or so for Moby Dick)\n                    //     that.locationLoading = false;\n                    //     that.pageText = (that.beginBasePage + that.currentPage) + \"/\" + book.locations.total;\n                    // });\n                }\n               \n\n            },\n\n            onBackImageChange(val){\n                var iframeDoc = document.getElementsByTagName(\"iframe\")[0].contentWindow.document;\n                var  bdoy = iframeDoc.getElementsByTagName(\"body\")[0];\n                bdoy.style.backgroundImage=val;\n                this.readerStyle.backImage=val;\n            },\n\n            changeBackImage(value){\n                if(value.backImagesrc)\n                    this.backImage=\"url('\"+this.publicPath+value.backImagesrc+\"')\";\n                else\n                    this.backImage=\"\";\n            },\n            updateStyle(){\n                this.onLightChange(this.readerStyle.light);\n                this.onBackImageChange(this.readerStyle.backImage);\n                this.onFontSizeChange(this.readerStyle.fontSize);\n            },\n            changeChapter(chapter){\n                console.log(\"changeChapter book\");\n                this.changeType=\"menu\";\n                this.showLeftDrawer=false;\n                this.chapter=chapter;\n            },\n        },\n        beforeCreate:function () {\n            document.title = \"图书阅读\";\n            var that = this;\n            var bookfile = this.$route.params.pathMatch;\n            var bookoption={\n\n            };\n\n            if(!/.epub$/.test(bookfile)&&bookfile!=undefined){\n                bookoption.openAs= 'directory';\n            }\n            book = new Epub(bookfile,bookoption);\n            console.log('ePub load = '  + bookfile);\n            console.log(book);\n            rendition = book.renderTo(\"viewer\", {\n                width: \"100%\",\n                // view:Epub.InlineView\n            });\n\n            console.log('ePub render');\n            // book.ready.then(function() {\n            //     console.log(\"book ready\");\n            // })\n\n            // Generate location and pagination\n            book.ready.then(function() {\n                 \n                // const stored = localStorage.getItem(book.key() + '-locations');\n                 console.log('metadata:', book.package.metadata);\n                 that.coverimg = book.cover;\n                // if (stored) {\n                //     return book.locations.load(stored);\n                // } else {\n                \n                return book.locations.generate(719); // Generates CFI for every X characters (Characters per/page)\n                // }\n            }).then(function(locations) { // This promise will take a little while to return (About 20 seconds or so for Moby Dick)\n                //localStorage.setItem(book.key() + '-locations', book.locations.save());\n                console.log('locations finished:', book.locations);\n                that.locationLoading = false;\n                //that.firstLoading=false;\n\n                let location = viewManager.currentLocation();\n                console.log( \"currentLocation=\" ,location);\n                let  p = location[0].pages[0];\n                \n                console.log(\"beginBasePage=\" , that.beginBasePage );\n\n                that.pageText = that.beginBasePage ;\n                that.pageAnimationClass =\"\";\n                that.beginBasePage = that.beginBasePage - p;\n\n            });\n\n            var viewManager;\n\n            rendition.on(\"started\",function () {\n                viewManager = rendition.manager;\n                console.log(\"rendition started\")\n                viewManager.on(\"beforeCreateView\",function (section) {\n                    console.log(\"viewManager beforeCreateView\");\n                    that.loading = true;\n                })\n\n                viewManager.on(\"afterCreateView\",function (view) {\n                    console.log(\"viewManager afterCreateView\");\n                    view.hooks.content.register(function (iframe) {\n                        that.updateStyle();\n                        console.log(\"view updateStyle\");\n                    })\n                })\n\n            })\n\n            rendition.on(\"rendered\", function(section){\n                console.log(\"rendition rendered\" ,rendition.currentLocation());\n                // that.updateStyle();\n\n\n                 \n             \n                \n                console.log(\"chapter=\" , that.chapter );\n                console.log(\"section=\" , section );\n\n                \n                \n                if (!that.locationLoading){\n                    let location = viewManager.currentLocation();\n                    console.log( \"currentLocation=\" ,location);\n                    let  p = location[0].pages[0];\n                    that.beginBasePage = book.locations.locationFromCfi(rendition.currentLocation().start.cfi) - p;\n                    console.log(\"beginBasePage=\" , that.beginBasePage );\n                     \n                }  \n                if (that.firstLoading){\n                    //location（为了分页的页码计算） 还在计算中的话，稍等一会儿在关闭loading页面\n                    setTimeout(function (){that.loading = false;that.firstLoading=false},4500);\n                } else {\n                    that.loading = false;\n                }\n                \n                \n\n                \n                \n                \n                let current = book.navigation && book.navigation.get(section.href);\n                that.currentChaperIdx = section.index;\n\n                if(that.chapter.href!=current.href){\n                    that.changeType=\"turnPage\";\n                    that.chapter=current;\n                }\n\n\n                var iframe = document.getElementsByTagName(\"iframe\")[0].contentWindow.document;\n                var viewport = iframe.getElementsByTagName(\"html\")[0];\n\n\n                var container = document.getElementById(\"viewer\").firstElementChild;\n                var startScrollLeft;\n                //console.log(container);\n\n\n                var pageWidth = window.innerWidth; // 页面宽度\n                var maxWidth =  pageWidth/2;\n                var startX, startY;\n                var initialPos = 0;  // 手指按下的屏幕位置\n                var moveLength = 0;  // 手指当前滑动的距离\n                var direction = 'left'; // 滑动的方向\n                var isMove = false; // 是否发生左右滑动\n                var startT = 0; // 记录手指按下去的时间\n                var isTouchEnd = true; // 标记当前滑动是否结束(手指已离开屏幕)\n                var throttleTime = 0;\n                var lastScroll,totalPages;\n\n\n                that.currentPage = 0; \n                // let location = viewManager.currentLocation();\n                // that.currentPage = location[0].pages[0]; \n               \n                // 手指放在屏幕上\n                viewport.addEventListener('touchstart', function (e) {\n                    startScrollLeft = container.scrollLeft;\n                    let location = viewManager.currentLocation();\n                    totalPages = location[0].totalPages;\n                    //that.currentPage = location[0].pages[0];  \n\n\n                    //touchstart与touchend的浏览器默认行为不能阻止，\n                    // 如果阻止的话则浏览器无法计算该节点内的点击等其他事件\n                    //e.preventDefault();\n                    console.log('touchstart');\n                    console.log(startScrollLeft);\n                    // 单手指触摸或者多手指同时触摸，禁止第二个手指延迟操作事件\n                    if (e.touches.length === 1 || isTouchEnd) {\n                        var touch = e.touches[0];\n                        startX = touch.pageX;\n                        startY = touch.pageY;\n                        lastScroll=0;\n                        startT = + new Date(); // 记录手指按下的开始时间\n                        isMove = false; // 是否产生滑动\n                        isTouchEnd = false; // 当前滑动开始\n\n                    }\n                }, { passive: false});\n\n                // 手指在屏幕上滑动，页面跟随手指移动\n                viewport.addEventListener('touchmove', function (e) {\n                    e.preventDefault();\n                    console.log('touchmove');\n\n                    //用于频繁滑动防抖\n                    // var now = new Date().getTime();\n                    // if(!throttleTime) throttleTime=now;\n                    // if(now-throttleTime<20) return;\n                    // throttleTime = now;\n\n                    // 如果当前滑动已结束，不管其他手指是否在屏幕上都禁止该事件\n                    if (isTouchEnd) return ;\n\n                    var touch = e.touches[0];\n                    //container scroll改变时touch.pageX也会跟着变，所以需要减掉容器滚动的距离获取真正的手指移动距离。\n                    var scrolltemp = container.scrollLeft-startScrollLeft;\n                    console.log(\"scrolltemp:\"+scrolltemp);\n                    var deltaX = touch.pageX - startX-scrolltemp;\n                    console.log(\"pageX:\"+touch.pageX ,\"deltaX:\"+deltaX,\"startX:\"+startX);\n                    direction = deltaX > 0 ? 'right' : 'left'; // 判断手指滑动的方向\n\n                    // if(that.chapter.href==that.toc[0].href&&direction=='right'&&currentPage==1) return;\n\n                    isMove = true;\n                    moveLength = deltaX;\n\n                    scrollPage.call(viewport, moveLength,e);\n\n                    //如果滑动距离超过最大距离则翻页\n                    if(Math.abs(moveLength)>=maxWidth){\n                        throttleTime = 0;\n                        turnPage.call(viewport,moveLength);\n                    }\n\n                }, { passive: false});\n\n\n\n\n                // 手指离开屏幕时，计算最终需要停留在哪一页\n                viewport.addEventListener('touchend', function (e) {\n                    console.log('touchend');\n\n                    if(!isMove){\n                        console.log(e.target);\n                        isTouchEnd=true;\n                        if(e.target.tagName==\"A\"||e.target.parentNode.tagName==\"A\") return;\n                        e.preventDefault();\n                        that.popupShow=true;\n                        return;\n                    }\n\n\n                    throttleTime = 0;\n                    var translate = 0;\n                    // 计算手指在屏幕上停留的时间\n                    var deltaT = + new Date() - startT;\n                    // 发生了滑动，并且当前滑动事件未结束\n                    if (isMove && !isTouchEnd) {\n                        isTouchEnd = true; // 标记当前完整的滑动事件已经结束\n                        // 使用动画过渡让页面滑动到最终的位置\n                        if (deltaT < 300) { // 如果停留时间小于300ms,则认为是快速滑动，无论滑动距离是多少，都停留到下一页\n\n                            turnPage.call(viewport,moveLength);\n\n                        } else {\n                            // 如果滑动距离小于屏幕的50%，则退回到上一页\n                            if (Math.abs(moveLength) < maxWidth) {\n                                // 执行滑动，让页面恢复\n                                scrollPage.call(viewport, 0);\n                                isTouchEnd = true;\n\n                            } else {\n                                // 如果滑动距离大于屏幕的50%，则翻页\n                                turnPage.call(viewport,moveLength);\n                            }\n                        }\n\n                    }\n\n                }, { passive: false });\n\n\n                function turnPage(moveLength){\n                    isTouchEnd = true;\n\n                    console.log(container.scrollLeft);\n                    this.style.webkitTransform = 'translate3d(0, 0, 0)';\n\n                    console.log(\"moveLength:\"+moveLength);\n                    if(direction===\"left\"){\n                        if (book.package.metadata.direction === \"rtl\") {\n                            rendition.prev(moveLength);\n                            //that.currentPage--;\n                        }   else {\n                            rendition.next(moveLength);\n                            //that.currentPage++;\n                        }\n                    }else{\n                        if (that.currentPage==1 && book.package.metadata.direction != \"rtl\" &&  that.currentChaperIdx<=2  ) return; //第一页禁止继续向前\n                        if (book.package.metadata.direction === \"rtl\" ) {\n                                rendition.next(moveLength);\n                                //that.currentPage++;\n                            }    else {\n                                rendition.prev(moveLength);\n                                //that.currentPage--;\n                            } \n                    }\n                }\n\n\n\n                // 页面平移\n                function scrollPage(translate,type) {\n                        //console.log(\"totalPages:\"+totalPages,\"currentPage:\"+that.currentPage)\n                        if(that.currentPage==1&&direction===\"right\"||that.currentPage==totalPages&&direction===\"left\"){\n                            this.style.webkitTransform = 'translate3d(' + translate + 'px, 0, 0)';\n                            console.log(\"webkitTransform\");\n                        } else{\n                            container.scrollLeft=startScrollLeft-translate;\n                            console.log(\"scrollLeft\");\n                        }\n\n\n                }\n\n\n            });\n\n            rendition.on(\"relocated\", function(locations){\n                //console.log(\"relocated location\",locations);\n                // When navigating to the next/previous page\n                //let progress = book.locations.percentageFromCfi(locations.start.cfi);\n                // console.log('Progress:', progress); // The % of how far along in the book you are\n                // console.log('Current Page:',book.locations.locationFromCfi(locations.start.cfi));\n                // console.log('Total Pages:',book.locations.total);\n\n                that.pageAnimationClass =\"fadeout\";\n                console.log('relocated event : locations :', book.locations);\n\n\n                setTimeout(\n                    function(){\n                            let location = viewManager.currentLocation();\n                            that.currentPage = location[0].pages[0];  \n                            console.log(\"currentPage\",that.currentPage);\n                            let total = book.locations.total;\n\n                            if (that.locationLoading  &&  total < 70 ) { //加载中，且刚开始加载的时候，如果估算已经大于70页了，也尝试一下\n                                that.pageText =\"\";\n                                that.pageProcess =  0 ;\n                                that.pageAnimationClass =\"\";\n                                \n                                \n\n                                return;\n                            }\n\n\n                            let progress = book.locations.percentageFromCfi(locations.start.cfi);\n                            that.pageProcess =  parseInt(progress *100) ;\n                           \n                            if (total<  that.beginBasePage  +location[0].totalPages) total = that.beginBasePage + location[0].totalPages; \n\n                            // let showpage = that.beginBasePage + that.currentPage;\n                            // let calpage = book.locations.locationFromCfi(locations.start.cfi);\n\n                            // console.log('showpage:', showpage);  \n                            // console.log('calpage:', calpage); \n\n                            //if (calpage>total) total=calpage;\n                            //有链接跳转的时候，这是currentPage是不对的\n                            // if ( Math.abs(calpage - showpage)>1 ){\n                            //     that.currentPage = calpage - showpage;\n                            //     showpage = calpage;\n                            // }\n\n                            let showpage = that.beginBasePage + that.currentPage;\n\n                            //if (showpage>total) showpage=total;\n                            //that.pageText = showpage  +  \"/\" + total;\n                            that.pageText = showpage;\n\n                            that.pageAnimationClass =\"\";\n                },400);\n                \n \n            });\n\n            rendition.on(\"layout\", function(layout) {\n                console.log(\"layout\",layout);\n            });\n\n            rendition.on(\"locationChanged\",function(obj){\n                        // index (number)\n                        // href (string)\n                        // start (EpubCFI)\n                        // end (EpubCFI)\n                        // percentage (number)\n                console.log(\"locationChanged\",obj);\n \n            });\n\n            book.loaded.navigation.then(function(toc){\n                that.chapter = toc.toc[0];\n                that.toc=toc.toc;\n                console.log(\"navigation,loaded\")\n            });\n\n        },\n        destroyed:function () {\n            console.log(\"unloading\");\n            book.destroy();\n        }\n    }\n</script>\n\n<style>\n\n.van-stepper__input[disabled] {\n    color:black;\n}\n\n</style>"],"sourceRoot":"src/views"}]}